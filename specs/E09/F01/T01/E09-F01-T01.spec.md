# Spec: E09-F01-T01 - Define Strategy Entity

---
# ============================================================================
# SPEC METADATA
# ============================================================================

# === IDENTIFICATION ===
id: E09-F01-T01
clickup_task_id: '86ew0fnzd'
title: Define Strategy Entity (Aggregate Root)
type: task

# === HIERARCHY ===
parent: E09-F01
children: []
epic: E09
feature: F01
task: T01
domain: strategy

# === WORKFLOW ===
status: draft
priority: high

# === TRACKING ===
created: '2025-12-30'
updated: '2025-12-30'
due_date: ''
estimated_hours: 4
actual_hours: 0

# === METADATA ===
tags:
  - domain
  - entity
  - aggregate-root
  - strategy
effort: medium
risk: low
---

**Status**: Draft
**Type**: Task
**Parent**: E09-F01
**Created**: 2025-12-30
**Updated**: 2025-12-30

## Executive Summary

Create the Strategy aggregate root entity that combines entry rule, exit rule, and stop-loss rule with risk configuration. Implement validation logic to ensure strategy completeness before persistence.

## Execution Flow

```
1. Create Strategy dataclass
   → Fields: id, name, description, entry_rule, exit_rule, stop_loss_rule
   → Fields: risk_config, version, is_active, created_at, updated_at
   → Not frozen (version increments on update)
2. Implement validate() method
   → Check entry_rule is present
   → Check at least one exit method exists
   → Validate risk_config constraints
   → Return list[ValidationError]
3. Create ValidationError class
   → Return: SUCCESS with Strategy entity ready
```

## User Stories

### Primary User Story
**As a** developer
**I want to** use a Strategy aggregate entity
**So that** I can compose and validate trading strategies

## Acceptance Scenarios

### Scenario 1: Valid Strategy
**Given** Strategy with entry_rule and stop_loss_rule
**When** validate() is called
**Then** empty list is returned (no errors)

### Scenario 2: Missing Entry Rule
**Given** Strategy without entry_rule
**When** validate() is called
**Then** ValidationError "Entry rule is required" is returned

### Scenario 3: No Exit Method
**Given** Strategy without exit_rule and without stop_loss_rule
**When** validate() is called
**Then** ValidationError "At least one exit method required" is returned

## Requirements

### Functional Requirements
- **FR-001**: Strategy dataclass with all required fields
- **FR-002**: validate() returns list of ValidationError
- **FR-003**: Entry rule is required
- **FR-004**: Either exit_rule or stop_loss_rule required

### Non-Functional Requirements
- **NFR-001**: Type hints on all fields
- **NFR-002**: Default factory for timestamps

### Technical Constraints
- **TC-001**: Python dataclass (not frozen)
- **TC-002**: Uses StrategyRule and RiskConfig from T02

## Dependencies

### Upstream Dependencies
- None (foundation task)

### Downstream Impact
- [ ] E09-F01-T02: StrategyRule and RiskConfig used here
- [ ] E09-F01-T03: StrategyVersion references Strategy
- [ ] E09-F02: Use cases work with Strategy

## Gate Checks

### Pre-Implementation Gates
- [x] Fields defined in E09 spec
- [x] Validation rules clear

### Quality Gates
- [ ] Unit tests for validation
- [ ] Edge case tests
- [ ] Test coverage > 80%

## Success Criteria

### Acceptance Criteria
- [ ] Strategy dataclass implemented
- [ ] validate() working correctly
- [ ] All validation rules enforced
- [ ] Tests passing

### Definition of Done
- [ ] Code reviewed
- [ ] Unit tests passing
- [ ] Documentation complete

## Risk Assessment

| Risk | Probability | Impact | Mitigation |
|------|-------------|--------|------------|
| Missing validation case | Low | Medium | Comprehensive test cases |

## Artifacts

### Input Documents
- [Parent Feature](../E09-F01.spec.md)
- [Epic Section 3.1](../../E09.spec.md)

### Output Artifacts
- `src/domain/entities/strategy.py`
- `src/domain/entities/validation.py`

---
*Template Version: 2.0.0 - Enhanced with Speckit features*
