# Spec: E09-F04-T04 - Create RuleSelectorDialog

---
# ============================================================================
# SPEC METADATA
# ============================================================================

# === IDENTIFICATION ===
id: E09-F04-T04
clickup_task_id: '86ew0fp0n'
title: Create RuleSelectorDialog
type: task

# === HIERARCHY ===
parent: E09-F04
children: []
epic: E09
feature: F04
task: T04
domain: strategy

# === WORKFLOW ===
status: draft
priority: high

# === TRACKING ===
created: '2025-12-30'
updated: '2025-12-30'
due_date: ''
estimated_hours: 4
actual_hours: 0

# === METADATA ===
tags:
  - ui
  - qt
  - dialog
  - rule
  - formula
effort: medium
risk: low
---

**Status**: Draft
**Type**: Task
**Parent**: E09-F04
**Created**: 2025-12-30
**Updated**: 2025-12-30

## Executive Summary

Create the RuleSelectorDialog for selecting rules from formula library or creating custom expressions. Features tabbed interface with library search/browse on one tab and formula editor on another. Returns StrategyRule on accept.

## Execution Flow

```
1. Create RuleSelectorDialog(QDialog)
   → Modal dialog for rule selection
2. Add tabbed interface
   → "Rule Library" tab with search and list
   → "Custom Rule" tab with formula editor
3. Library tab functionality
   → Search box filters rules
   → List shows rule name and preview
   → Double-click or OK selects
4. Custom tab functionality
   → FormulaEditorWidget (from E05)
   → Expression validation
5. Return StrategyRule
   → Accept emits rule_selected signal
   → Return: SUCCESS with dialog ready
```

## User Stories

### Primary User Story
**As a** trader
**I want to** select rules from a library
**So that** I can reuse proven patterns

### Additional Stories
- **As a** trader, **I want to** create custom rules, **So that** I can express unique conditions

## Acceptance Scenarios

### Scenario 1: Select from Library
**Given** rules in formula library
**When** user selects and clicks OK
**Then** StrategyRule with formula_id returned

### Scenario 2: Create Custom Rule
**Given** custom tab selected
**When** user enters valid expression and clicks OK
**Then** StrategyRule with expression returned

### Scenario 3: Cancel Selection
**Given** dialog open
**When** user clicks Cancel
**Then** dialog closes, no rule returned

## Requirements

### Functional Requirements
- **FR-001**: Tabbed interface (Library / Custom)
- **FR-002**: Library search and list
- **FR-003**: Custom expression editor
- **FR-004**: Return StrategyRule on accept

### Non-Functional Requirements
- **NFR-001**: Filter responsively
- **NFR-002**: Validate custom expressions

### Technical Constraints
- **TC-001**: QDialog with QTabWidget
- **TC-002**: Uses E05 FormulaEditorWidget

## Dependencies

### Upstream Dependencies
- [ ] E05: Formula library and editor widget
- [ ] E09-F04-T03: Called from editor

### Downstream Impact
- [ ] None (returns result to editor)

## Gate Checks

### Pre-Implementation Gates
- [x] Dialog layout in E09 spec Section 5.2
- [x] Tab structure clear

### Quality Gates
- [ ] Widget tests
- [ ] Selection flow tests
- [ ] Test coverage > 80%

## Success Criteria

### Acceptance Criteria
- [ ] Tabs working
- [ ] Library selection working
- [ ] Custom expression working
- [ ] Return value correct
- [ ] Tests passing

### Definition of Done
- [ ] Code reviewed
- [ ] Widget tests passing
- [ ] Documentation complete

## Risk Assessment

| Risk | Probability | Impact | Mitigation |
|------|-------------|--------|------------|
| E05 dependency not ready | Medium | High | Mock formula service |

## Artifacts

### Input Documents
- [Parent Feature](../E09-F04.spec.md)
- [Epic Section 5.2](../../E09.spec.md)

### Output Artifacts
- `src/presentation/views/strategy/rule_selector_dialog.py`

---
*Template Version: 2.0.0 - Enhanced with Speckit features*
