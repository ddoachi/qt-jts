# Spec: E09-F04 - UI Components

---
# ============================================================================
# SPEC METADATA
# ============================================================================

# === IDENTIFICATION ===
id: E09-F04
clickup_task_id: ''
title: UI Components
type: feature

# === HIERARCHY ===
parent: E09
children:
  - E09-F04-T01
  - E09-F04-T02
  - E09-F04-T03
  - E09-F04-T04
  - E09-F04-T05
epic: E09
feature: F04
task: null
domain: strategy

# === WORKFLOW ===
status: draft
priority: high

# === TRACKING ===
created: '2025-12-30'
updated: '2025-12-30'
due_date: ''
estimated_hours: 32
actual_hours: 0

# === METADATA ===
tags:
  - ui
  - qt
  - pyside6
  - strategy
  - widgets
effort: large
risk: medium
---

**Status**: Draft
**Type**: Feature
**Parent**: E09
**Created**: 2025-12-30
**Updated**: 2025-12-30

## Executive Summary

Build the Strategy Builder UI using PySide6/Qt widgets: main StrategyView layout, StrategyListWidget for strategy library navigation, StrategyEditorWidget for composing strategies with rules and risk config, RuleSelectorDialog for selecting rules from formula library, and RiskConfigWidget for position sizing configuration.

## Execution Flow

```
1. Create StrategyView main layout
   → Split layout with list and editor
   → Toolbar with action buttons
   → Connect to use cases
2. Create StrategyListWidget
   → Display strategy library
   → Search and filter capabilities
   → Selection emits signals
3. Create StrategyEditorWidget
   → Rule selection sections (entry, exit, stop-loss)
   → Embedded RiskConfigWidget
   → Save/backtest/paper-trade buttons
4. Create RuleSelectorDialog
   → Tab for library rules vs custom
   → Formula search and preview
   → Parameter configuration
5. Create RiskConfigWidget
   → Spin boxes for all risk params
   → Real-time validation
   → Return: SUCCESS with all UI components ready
```

## User Stories

### Primary User Story
**As a** trader
**I want to** compose strategies visually
**So that** I can create trading strategies without writing code

### Additional Stories
- **As a** trader, **I want to** browse my strategy library, **So that** I can manage multiple strategies
- **As a** trader, **I want to** select rules from a library, **So that** I can reuse proven patterns
- **As a** trader, **I want to** configure risk parameters, **So that** I can control position sizing

## Acceptance Scenarios

### Scenario 1: Create New Strategy
**Given** Strategy Builder view is open
**When** user clicks "New Strategy" and fills form
**Then** strategy is saved to library

### Scenario 2: Select Rule from Library
**Given** RuleSelectorDialog is open
**When** user selects a rule and clicks OK
**Then** rule is applied to current strategy section

### Scenario 3: Configure Risk Parameters
**Given** RiskConfigWidget is displayed
**When** user adjusts stop-loss to -3%
**Then** risk_config is updated in real-time

## Requirements

### Functional Requirements
- **FR-001**: StrategyView with list/editor split layout
- **FR-002**: StrategyListWidget with search and selection
- **FR-003**: StrategyEditorWidget with rule sections and risk config
- **FR-004**: RuleSelectorDialog with library and custom tabs
- **FR-005**: RiskConfigWidget with all spin boxes

### Non-Functional Requirements
- **NFR-001**: Responsive layout for different window sizes
- **NFR-002**: Input validation with visual feedback
- **NFR-003**: Consistent with E01 Qt framework patterns

### Technical Constraints
- **TC-001**: PySide6 widgets
- **TC-002**: Signal/slot pattern for communication
- **TC-003**: Depends on E01 Qt framework

## Key Entities

### Entity: StrategyView
- **Description**: Main view for Strategy Builder
- **Key Attributes**: strategy_list, strategy_editor, toolbar

### Entity: StrategyListWidget
- **Description**: List widget for strategy library
- **Key Attributes**: search_box, list_view, strategies

### Entity: StrategyEditorWidget
- **Description**: Form for editing strategy
- **Key Attributes**: name_edit, entry_rule, exit_rule, risk_config

### Entity: RuleSelectorDialog
- **Description**: Dialog for selecting rules
- **Key Attributes**: tabs, rule_list, formula_editor

### Entity: RiskConfigWidget
- **Description**: Risk parameter form
- **Key Attributes**: stop_loss_spin, take_profit_spin, position_size_spin

## Dependencies

### Upstream Dependencies
- [ ] E01: Qt Framework patterns
- [ ] E09-F01: Domain entities for display
- [ ] E09-F02: Use cases for actions
- [ ] E05: Formula library for rule selection

### Downstream Impact
- [ ] None (end of dependency chain)

## Gate Checks

### Pre-Implementation Gates
- [x] No [NEEDS CLARIFICATION] markers remain
- [x] UI mockups reviewed (in E09 spec)
- [x] Widget hierarchy defined

### Quality Gates
- [ ] Widget tests for all components
- [ ] Integration tests with use cases
- [ ] Test coverage > 80%

## Tasks Preview

| ID | Title | Effort | Wave | Dependencies |
|----|-------|--------|------|--------------|
| [E09-F04-T01](T01/E09-F04-T01.spec.md) | Create StrategyView main layout | M | 4 | E01, F02 |
| [E09-F04-T02](T02/E09-F04-T02.spec.md) | Create StrategyListWidget | M | 4 | T01 |
| [E09-F04-T03](T03/E09-F04-T03.spec.md) | Create StrategyEditorWidget | L | 4 | T01 |
| [E09-F04-T04](T04/E09-F04-T04.spec.md) | Create RuleSelectorDialog | M | 4 | T03 |
| [E09-F04-T05](T05/E09-F04-T05.spec.md) | Create RiskConfigWidget | M | 4 | T03 |

**T02, T03 can run in parallel after T01**
**T04, T05 can run in parallel after T03**

## Success Criteria

### Acceptance Criteria
- [ ] All widgets implemented
- [ ] Integration with use cases working
- [ ] Validation and feedback working
- [ ] 80% test coverage

### Definition of Done
- [ ] Code reviewed and approved
- [ ] Widget tests passing
- [ ] Integration tests passing
- [ ] Documentation updated

## Risk Assessment

| Risk | Probability | Impact | Mitigation |
|------|-------------|--------|------------|
| Complex layout issues | Medium | Low | Use Qt Designer for prototyping |
| Signal connection errors | Low | Medium | Thorough signal/slot testing |

## Notes and Clarifications

### Decisions Made
- 2025-12-30: Use QSplitter for list/editor layout
- 2025-12-30: RiskConfigWidget is reusable component
- 2025-12-30: Dialog returns StrategyRule on accept

## Artifacts

### Input Documents
- [Parent Epic](../E09.spec.md)
- [PRD Section 5.4.2-5.4.3](../../../docs/prd.md)

### Output Artifacts
- [ ] `E09-F04.pre-docs.md` - Pre-implementation documentation
- [ ] `E09-F04.post-docs.md` - Post-implementation learnings

---
*Template Version: 2.0.0 - Enhanced with Speckit features*
