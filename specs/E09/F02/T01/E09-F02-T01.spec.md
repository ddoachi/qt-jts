# Spec: E09-F02-T01 - Implement CreateStrategyUseCase

---
# ============================================================================
# SPEC METADATA
# ============================================================================

# === IDENTIFICATION ===
id: E09-F02-T01
clickup_task_id: '86ew0fnzn'
title: Implement CreateStrategyUseCase
type: task

# === HIERARCHY ===
parent: E09-F02
children: []
epic: E09
feature: F02
task: T01
domain: strategy

# === WORKFLOW ===
status: draft
priority: high

# === TRACKING ===
created: '2025-12-30'
updated: '2025-12-30'
due_date: ''
estimated_hours: 4
actual_hours: 0

# === METADATA ===
tags:
  - use-case
  - strategy
  - creation
effort: medium
risk: low
---

**Status**: Draft
**Type**: Task
**Parent**: E09-F02
**Created**: 2025-12-30
**Updated**: 2025-12-30

## Executive Summary

Implement the CreateStrategyUseCase for composing new trading strategies. Handles building rules from formula library or custom expressions, validating strategy completeness, and persisting to repository.

## Execution Flow

```
1. Receive CreateStrategyRequest
   → Contains name, description, rule configs, risk_config
2. Build strategy rules
   → Load formula from library if formula_id provided
   → Validate custom expression if no formula_id
   → Create StrategyRule objects
3. Create Strategy entity
   → Combine rules with risk_config
   → Call validate() to check completeness
4. Save to repository
   → Return saved Strategy with generated ID
   → Return: SUCCESS with created strategy
```

## User Stories

### Primary User Story
**As a** trader
**I want to** create new trading strategies
**So that** I can compose rules and configure risk management

## Acceptance Scenarios

### Scenario 1: Create from Library Rules
**Given** CreateStrategyRequest with entry_rule.formula_id=1
**When** execute() is called
**Then** Strategy is created with formula reference

### Scenario 2: Create with Custom Expression
**Given** CreateStrategyRequest with custom expression
**When** execute() is called
**Then** Expression is validated and Strategy is created

### Scenario 3: Reject Invalid Strategy
**Given** CreateStrategyRequest without entry rule
**When** execute() is called
**Then** StrategyValidationError is raised

## Requirements

### Functional Requirements
- **FR-001**: Build StrategyRule from formula_id
- **FR-002**: Build StrategyRule from custom expression
- **FR-003**: Validate strategy before saving
- **FR-004**: Create fixed percentage rules for stop-loss

### Non-Functional Requirements
- **NFR-001**: Async I/O for repository and formula service
- **NFR-002**: Descriptive validation errors

### Technical Constraints
- **TC-001**: Depends on FormulaService from E05
- **TC-002**: Use repository pattern

## Dependencies

### Upstream Dependencies
- [ ] E09-F01: Domain entities
- [ ] E09-F03-T01: IStrategyRepository interface
- [ ] E05: FormulaService

### Downstream Impact
- [ ] E09-F04: UI calls this use case

## Gate Checks

### Pre-Implementation Gates
- [x] Request/response types defined
- [x] Validation rules clear

### Quality Gates
- [ ] Unit tests for use case
- [ ] Mock repository tests
- [ ] Test coverage > 80%

## Success Criteria

### Acceptance Criteria
- [ ] Use case implemented
- [ ] Library rules working
- [ ] Custom expressions working
- [ ] Validation working
- [ ] Tests passing

### Definition of Done
- [ ] Code reviewed
- [ ] Unit tests passing
- [ ] Documentation complete

## Risk Assessment

| Risk | Probability | Impact | Mitigation |
|------|-------------|--------|------------|
| Formula not found | Medium | Low | Clear error message |

## Artifacts

### Input Documents
- [Parent Feature](../E09-F02.spec.md)
- [Epic Section 4.1](../../E09.spec.md)

### Output Artifacts
- `src/application/use_cases/create_strategy.py`

---
*Template Version: 2.0.0 - Enhanced with Speckit features*
