# Spec: E09-F02 - Use Cases

---
# ============================================================================
# SPEC METADATA
# ============================================================================

# === IDENTIFICATION ===
id: E09-F02
clickup_task_id: ''
title: Use Cases
type: feature

# === HIERARCHY ===
parent: E09
children:
  - E09-F02-T01
  - E09-F02-T02
  - E09-F02-T03
epic: E09
feature: F02
task: null
domain: strategy

# === WORKFLOW ===
status: draft
priority: high

# === TRACKING ===
created: '2025-12-30'
updated: '2025-12-30'
due_date: ''
estimated_hours: 16
actual_hours: 0

# === METADATA ===
tags:
  - use-cases
  - strategy
  - versioning
  - library
effort: medium
risk: low
---

**Status**: Draft
**Type**: Feature
**Parent**: E09
**Created**: 2025-12-30
**Updated**: 2025-12-30

## Executive Summary

Implement application use cases for strategy management: CreateStrategyUseCase for composing new strategies from rules, UpdateStrategyUseCase for modifying strategies with version tracking, and StrategyLibraryUseCase for listing, duplicating, and managing strategy collections.

## Execution Flow

```
1. Implement CreateStrategyUseCase
   → Build rules from formula library or custom expressions
   → Validate strategy completeness
   → Save to repository
2. Implement UpdateStrategyUseCase
   → Create version snapshot before update
   → Apply changes to strategy
   → Increment version and save
3. Implement StrategyLibraryUseCase
   → List all strategies with summary
   → Duplicate existing strategies
   → Activate/deactivate strategies
   → Return: SUCCESS with all use cases ready
```

## User Stories

### Primary User Story
**As a** trader
**I want to** create and manage trading strategies
**So that** I can compose rules and configure risk management

### Additional Stories
- **As a** trader, **I want to** update strategies with version history, **So that** I can track changes over time
- **As a** trader, **I want to** duplicate strategies, **So that** I can create variations without starting from scratch

## Acceptance Scenarios

### Scenario 1: Create Strategy from Library Rules
**Given** valid entry rule from formula library
**When** CreateStrategyUseCase.execute() is called
**Then** strategy is saved with formula reference

### Scenario 2: Update Strategy with Versioning
**Given** existing strategy with version=1
**When** UpdateStrategyUseCase.execute() is called
**Then** version snapshot is created and strategy.version becomes 2

### Scenario 3: Duplicate Strategy
**Given** existing strategy "RSI Momentum"
**When** StrategyLibraryUseCase.duplicate() is called with new name
**Then** new strategy is created with same rules

## Requirements

### Functional Requirements
- **FR-001**: CreateStrategyUseCase builds rules from formula library or custom
- **FR-002**: CreateStrategyUseCase validates strategy before saving
- **FR-003**: UpdateStrategyUseCase creates version snapshot before changes
- **FR-004**: StrategyLibraryUseCase lists strategies with summary preview
- **FR-005**: StrategyLibraryUseCase duplicates strategies

### Non-Functional Requirements
- **NFR-001**: Use cases are async for I/O operations
- **NFR-002**: Validation errors are descriptive
- **NFR-003**: Transaction rollback on failure

### Technical Constraints
- **TC-001**: Depends on E05 FormulaService for validation
- **TC-002**: Use repository pattern for persistence

## Key Entities

### Entity: CreateStrategyRequest
- **Description**: Input for strategy creation
- **Key Attributes**: name, description, entry_rule, exit_rule, stop_loss_rule, risk_config

### Entity: StrategyUpdate
- **Description**: Partial update for strategy
- **Key Attributes**: name?, entry_rule?, exit_rule?, stop_loss_rule?, risk_config?

### Entity: StrategySummary
- **Description**: Lightweight strategy info for listing
- **Key Attributes**: id, name, entry_rule_preview, has_exit_rule, position_size_pct, version

## Dependencies

### Upstream Dependencies
- [ ] E09-F01: Domain entities
- [ ] E09-F03: Repository interface
- [ ] E05: FormulaService for validation

### Downstream Impact
- [ ] E09-F04: UI calls these use cases

## Gate Checks

### Pre-Implementation Gates
- [x] No [NEEDS CLARIFICATION] markers remain
- [x] Input/output types defined
- [x] Error cases identified

### Quality Gates
- [ ] Unit tests for all use cases
- [ ] Integration tests with repository
- [ ] Test coverage > 80%

## Tasks Preview

| ID | Title | Effort | Wave | Dependencies |
|----|-------|--------|------|--------------|
| [E09-F02-T01](T01/E09-F02-T01.spec.md) | Implement CreateStrategyUseCase | M | 3 | F01, F03-T01 |
| [E09-F02-T02](T02/E09-F02-T02.spec.md) | Implement UpdateStrategyUseCase with versioning | M | 3 | F01, F03-T01 |
| [E09-F02-T03](T03/E09-F02-T03.spec.md) | Implement StrategyLibraryUseCase | M | 3 | F01, F03-T01 |

**All tasks in this feature can run in parallel** (Wave 3)

## Success Criteria

### Acceptance Criteria
- [ ] All use cases implemented
- [ ] Validation working correctly
- [ ] Version history working
- [ ] 80% test coverage

### Definition of Done
- [ ] Code reviewed and approved
- [ ] Unit tests passing
- [ ] Integration tests passing
- [ ] Documentation updated

## Risk Assessment

| Risk | Probability | Impact | Mitigation |
|------|-------------|--------|------------|
| Formula validation fails | Low | Medium | Clear error messages |
| Version snapshot incomplete | Low | High | Use dataclass asdict() |

## Notes and Clarifications

### Decisions Made
- 2025-12-30: Use cases are async
- 2025-12-30: Version snapshot uses dict serialization
- 2025-12-30: Preview truncates expressions to 50 chars

## Artifacts

### Input Documents
- [Parent Epic](../E09.spec.md)

### Output Artifacts
- [ ] `E09-F02.pre-docs.md` - Pre-implementation documentation
- [ ] `E09-F02.post-docs.md` - Post-implementation learnings

---
*Template Version: 2.0.0 - Enhanced with Speckit features*
