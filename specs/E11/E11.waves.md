# E11: Strategy Optimization - Wave Analysis

## Overview

This document analyzes the dependency structure and parallelization opportunities for E11 (Strategy Optimization) implementation. Tasks are organized into waves based on their dependencies - tasks within the same wave can be executed in parallel.

## Dependency Graph

```
                    ┌─────────────────────────────────────────────────────────┐
                    │                     EXTERNAL DEPS                        │
                    │              E10 (Backtesting) - Required                │
                    │              E01 (App Framework) - For UI                │
                    │              E04 (Strategy Builder) - For strategies     │
                    └─────────────────────────────────────────────────────────┘
                                              │
                                              ▼
    ┌─────────────────────────────────────────────────────────────────────────┐
    │  WAVE 1: Foundational Models (No internal dependencies)                  │
    │                                                                          │
    │  ┌────────────────┐  ┌────────────────┐                                 │
    │  │ E11-F01-T01 [P]│  │ E11-F04-T01 [P]│                                 │
    │  │ ParameterRange │  │ OptimizationView                                 │
    │  │ + Target Enum  │  │ Container      │                                 │
    │  └───────┬────────┘  └───────┬────────┘                                 │
    │          │                   │                                           │
    │  ┌────────────────┐  ┌───────┴────────┐  ┌────────────────┐             │
    │  │ E11-F04-T02 [P]│  │ E11-F04-T03 [P]│  │ E11-F04-T04 [P]│             │
    │  │ ParamConfig    │  │ ResultsTable   │  │ WalkForward    │             │
    │  │ Widget         │  │ Widget         │  │ Widget         │             │
    │  └────────────────┘  └────────────────┘  └────────────────┘             │
    └─────────────────────────────────────────────────────────────────────────┘
                                              │
                                              ▼
    ┌─────────────────────────────────────────────────────────────────────────┐
    │  WAVE 2: Config & Result Models (Depends on T01)                         │
    │                                                                          │
    │  ┌────────────────┐                                                     │
    │  │ E11-F01-T02 [P]│                                                     │
    │  │ OptimizConfig  │                                                     │
    │  │ + ParamResult  │                                                     │
    │  └───────┬────────┘                                                     │
    └─────────────────────────────────────────────────────────────────────────┘
                                              │
                                              ▼
    ┌─────────────────────────────────────────────────────────────────────────┐
    │  WAVE 3: Complete Models (Depends on T01, T02)                           │
    │                                                                          │
    │  ┌────────────────┐                                                     │
    │  │ E11-F01-T03    │                                                     │
    │  │ WalkForward +  │                                                     │
    │  │ OptimResult    │                                                     │
    │  └───────┬────────┘                                                     │
    └─────────────────────────────────────────────────────────────────────────┘
                                              │
                                              ▼
    ┌─────────────────────────────────────────────────────────────────────────┐
    │  WAVE 4: Optimizer Core (Depends on F01)                                 │
    │                                                                          │
    │  ┌────────────────┐                                                     │
    │  │ E11-F02-T01    │                                                     │
    │  │ GridSearch     │                                                     │
    │  │ Optimizer Core │                                                     │
    │  └───────┬────────┘                                                     │
    └─────────────────────────────────────────────────────────────────────────┘
                                              │
                                              ▼
    ┌─────────────────────────────────────────────────────────────────────────┐
    │  WAVE 5: Optimizer Features (Depends on T01)                             │
    │                                                                          │
    │  ┌────────────────┐  ┌────────────────┐                                 │
    │  │ E11-F02-T02 [P]│  │ E11-F02-T03 [P]│                                 │
    │  │ Parallel Exec  │  │ Result Ranking │                                 │
    │  └───────┬────────┘  └───────┬────────┘                                 │
    └─────────────────────────────────────────────────────────────────────────┘
                                              │
                                              ▼
    ┌─────────────────────────────────────────────────────────────────────────┐
    │  WAVE 6: Walk-Forward (Depends on F02)                                   │
    │                                                                          │
    │  ┌────────────────┐  ┌────────────────┐                                 │
    │  │ E11-F03-T01 [P]│  │ E11-F03-T02 [P]│                                 │
    │  │ WalkForward    │  │ Robustness     │                                 │
    │  │ Analyzer Core  │  │ Scoring        │                                 │
    │  └────────────────┘  └────────────────┘                                 │
    └─────────────────────────────────────────────────────────────────────────┘
                                              │
                                              ▼
    ┌─────────────────────────────────────────────────────────────────────────┐
    │  WAVE 7: Integration (Depends on all above)                              │
    │                                                                          │
    │  ┌────────────────┐                                                     │
    │  │ E11-F04-T05    │                                                     │
    │  │ Heatmap Widget │                                                     │
    │  │ (needs results)│                                                     │
    │  └────────────────┘                                                     │
    │                                                                          │
    │  + Full integration testing                                              │
    └─────────────────────────────────────────────────────────────────────────┘
```

## Wave Summary Table

| Wave | Tasks | Parallel? | Dependencies | Est. Hours |
|------|-------|-----------|--------------|------------|
| 1 | E11-F01-T01, E11-F04-T01, E11-F04-T02, E11-F04-T03, E11-F04-T04 | Yes | External only | 19 |
| 2 | E11-F01-T02 | N/A | Wave 1 (T01) | 2 |
| 3 | E11-F01-T03 | N/A | Wave 2 | 3 |
| 4 | E11-F02-T01 | N/A | Wave 3 (F01) | 4 |
| 5 | E11-F02-T02, E11-F02-T03 | Yes | Wave 4 | 8 |
| 6 | E11-F03-T01, E11-F03-T02 | Yes | Wave 5 | 7 |
| 7 | E11-F04-T05 | N/A | Wave 6 | 6 |

**Total Estimated Hours**: 49 hours
**Critical Path**: Waves 1→2→3→4→5→6→7

## Detailed Wave Breakdown

### Wave 1: Foundational (No Internal Dependencies)
**Can start immediately after E10 is complete**

| Task ID | Title | Hours | Notes |
|---------|-------|-------|-------|
| E11-F01-T01 | ParameterRange + OptimizationTarget | 2 | Pure data models, no deps |
| E11-F04-T01 | OptimizationView Container | 4 | UI skeleton, can start early |
| E11-F04-T02 | ParamConfigWidget | 4 | UI widget, parallel with T01 |
| E11-F04-T03 | ResultsTableWidget | 4 | UI widget, parallel with T01 |
| E11-F04-T04 | WalkForwardWidget | 5 | UI widget, parallel with T01 |

**Parallelization Opportunity**: 5 developers can work simultaneously
**Worktrees Needed**: 5

### Wave 2: Config Models
**Requires**: Wave 1 (E11-F01-T01)

| Task ID | Title | Hours | Notes |
|---------|-------|-------|-------|
| E11-F01-T02 | OptimizationConfig + ParameterResult | 2 | Uses T01 types |

### Wave 3: Complete Models
**Requires**: Wave 2

| Task ID | Title | Hours | Notes |
|---------|-------|-------|-------|
| E11-F01-T03 | WalkForwardResult + OptimizationResult | 3 | Aggregates T01, T02 |

### Wave 4: Optimizer Core
**Requires**: Wave 3 (all F01 models)

| Task ID | Title | Hours | Notes |
|---------|-------|-------|-------|
| E11-F02-T01 | GridSearchOptimizer Core | 4 | Foundation for optimizer |

### Wave 5: Optimizer Features
**Requires**: Wave 4

| Task ID | Title | Hours | Notes |
|---------|-------|-------|-------|
| E11-F02-T02 | Parallel Backtest Execution | 5 | Can parallel with T03 |
| E11-F02-T03 | Result Ranking + Walk-Forward Integration | 3 | Can parallel with T02 |

**Parallelization Opportunity**: 2 developers can work simultaneously
**Worktrees Needed**: 2

### Wave 6: Walk-Forward Analyzer
**Requires**: Wave 5 (F02 optimizer)

| Task ID | Title | Hours | Notes |
|---------|-------|-------|-------|
| E11-F03-T01 | WalkForwardAnalyzer Core | 5 | Uses optimizer |
| E11-F03-T02 | Robustness Scoring | 2 | Can parallel with T01 |

**Parallelization Opportunity**: 2 developers can work simultaneously
**Worktrees Needed**: 2

### Wave 7: Integration & Final UI
**Requires**: All previous waves

| Task ID | Title | Hours | Notes |
|---------|-------|-------|-------|
| E11-F04-T05 | ParameterHeatmapWidget | 6 | Needs result data |

## Recommended Execution Strategy

### Option A: Sequential (1 Developer)
- Follow waves 1→7 sequentially
- Total time: ~49 hours
- No worktree overhead

### Option B: Maximum Parallel (5+ Developers)
- Wave 1: 5 developers (all UI widgets + T01)
- Wave 2-3: 1 developer (domain models)
- Wave 4: 1 developer (optimizer core)
- Wave 5: 2 developers (parallel/ranking)
- Wave 6: 2 developers (walk-forward)
- Wave 7: 1 developer (heatmap)
- Total calendar time: ~15-20 hours
- Requires 5 worktrees initially

### Option C: Balanced (2-3 Developers) - Recommended
- Developer 1: F01 (all models) → F02 (optimizer)
- Developer 2: F04-T01,T02,T03 (main UI) → F04-T04,T05
- Developer 3: F03 (walk-forward) → Integration testing
- Total calendar time: ~25-30 hours
- Requires 3 worktrees

## Worktree Commands

```bash
# Create worktrees for Wave 1 parallel execution
scripts/development/create-worktree.sh -b E11-F01-T01 worktrees/E11-F01-T01
scripts/development/create-worktree.sh -b E11-F04-T01 worktrees/E11-F04-T01
scripts/development/create-worktree.sh -b E11-F04-T02 worktrees/E11-F04-T02
scripts/development/create-worktree.sh -b E11-F04-T03 worktrees/E11-F04-T03
scripts/development/create-worktree.sh -b E11-F04-T04 worktrees/E11-F04-T04

# For Wave 5 parallel execution
scripts/development/create-worktree.sh -b E11-F02-T02 worktrees/E11-F02-T02
scripts/development/create-worktree.sh -b E11-F02-T03 worktrees/E11-F02-T03
```

## Risk Considerations

1. **E10 Dependency**: E11 cannot start until E10 (Backtesting) is complete
2. **Model Changes**: If F01 models change, F02/F03/F04 may need updates
3. **ProcessPoolExecutor**: F02-T02 has multiprocessing complexity - allocate extra time
4. **Matplotlib Integration**: F04-T05 has external dependency risk

## Notes

- [P] markers indicate tasks that can run in parallel within their wave
- UI tasks (F04) can start early but won't be fully testable until engine (F02/F03) is done
- Consider mock data for UI development to enable earlier visual testing
