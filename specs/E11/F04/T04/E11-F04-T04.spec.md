# Spec: E11-F04-T04 - WalkForwardWidget

---
# ============================================================================
# SPEC METADATA
# ============================================================================

# === IDENTIFICATION ===
id: E11-F04-T04
clickup_task_id: ''
title: WalkForwardWidget
type: task

# === HIERARCHY ===
parent: E11-F04
children: []
epic: E11
feature: F04
task: T04
domain: presentation

# === WORKFLOW ===
status: draft
priority: high

# === TRACKING ===
created: '2025-12-30'
updated: '2025-12-30'
due_date: ''
estimated_hours: 5
actual_hours: 0

# === METADATA ===
tags: [ui, pyside6, widget, walk-forward, visualization]
effort: medium
risk: low
wave: 4
parallel: true
---

**Status**: Draft
**Type**: Task
**Parent**: E11-F04 (Optimization UI Components)
**Wave**: 4 (Can run in parallel with other F04 tasks)

## Executive Summary

Create the WalkForwardWidget for visualizing walk-forward analysis results. Displays robustness score with pass/fail indicator, timeline showing train/test periods for each split, and per-split metrics comparison. Matches PRD Section 5.6.3 mockup.

## User Stories

**As a** trader
**I want to** see walk-forward analysis visually
**So that** I can quickly understand if my optimization is robust

## Acceptance Scenarios

### Scenario 1: Display Robustness Score
**Given** WalkForwardResult with robustness=0.72, is_robust=True
**When** widget displays
**Then** shows "Robustness Score: 0.72 ✓ (Robust)"
**And** indicator is green

### Scenario 2: Display Overfitted Warning
**Given** WalkForwardResult with robustness=0.35, is_robust=False
**When** widget displays
**Then** shows "Robustness Score: 0.35 ✗ (Overfitted)"
**And** indicator is red

### Scenario 3: Display Split Timeline
**Given** 5 walk-forward splits
**When** widget displays
**Then** shows 5 split rows
**And** each row shows train period, test period, in/out Sharpe, ratio

### Scenario 4: Display Averages
**Given** walk-forward results
**When** widget displays
**Then** shows "Average: In-Sample: 1.85 Out-Sample: 1.35 Ratio: 0.73"

## Requirements

### Functional Requirements
- **FR-001**: MUST display robustness score with pass/fail indicator
- **FR-002**: MUST show each split's train/test date ranges
- **FR-003**: MUST show in-sample and out-sample Sharpe for each split
- **FR-004**: MUST calculate and display ratio for each split
- **FR-005**: MUST show aggregate averages

### Technical Constraints
- **TC-001**: Use custom painting or QGraphicsView for timeline
- **TC-002**: Use green/red colors for robust/overfitted
- **TC-003**: Match PRD 5.6.3 visual layout

## Implementation Details

### File Location
`src/presentation/views/optimization/walk_forward_widget.py`

### Code Structure
```python
from PySide6.QtWidgets import QWidget, QVBoxLayout, QLabel, QTableWidget, QTableWidgetItem
from PySide6.QtCore import Qt
from PySide6.QtGui import QColor

class WalkForwardWidget(QWidget):
    """Walk-forward analysis visualization"""

    def __init__(self, parent=None):
        super().__init__(parent)
        self._setup_ui()

    def _setup_ui(self):
        layout = QVBoxLayout(self)

        # Robustness score header
        self._score_label = QLabel()
        self._score_label.setStyleSheet("font-size: 18px; font-weight: bold;")
        layout.addWidget(self._score_label)

        # Train/Test diagram label
        self._diagram_label = QLabel(
            "Training (70%) │ Testing (30%)\n"
            "══════════════ │ ═══════════"
        )
        layout.addWidget(self._diagram_label)

        # Split results table
        self._splits_table = QTableWidget()
        self._splits_table.setColumnCount(5)
        self._splits_table.setHorizontalHeaderLabels([
            "Split", "Train Period", "Test Period", "In-Sample", "Out-Sample"
        ])
        layout.addWidget(self._splits_table)

        # Average summary
        self._avg_label = QLabel()
        layout.addWidget(self._avg_label)

    def set_result(self, result: 'WalkForwardResult'):
        """Display walk-forward results"""
        # Robustness score with indicator
        if result.is_robust:
            self._score_label.setText(f"Robustness Score: {result.robustness_score:.2f} ✓ (Robust)")
            self._score_label.setStyleSheet("font-size: 18px; font-weight: bold; color: green;")
        else:
            self._score_label.setText(f"Robustness Score: {result.robustness_score:.2f} ✗ (Overfitted)")
            self._score_label.setStyleSheet("font-size: 18px; font-weight: bold; color: red;")

        # Populate splits table
        self._splits_table.setRowCount(len(result.splits))
        for i, split in enumerate(result.splits):
            self._splits_table.setItem(i, 0, QTableWidgetItem(f"Split {split.split_index + 1}"))
            self._splits_table.setItem(i, 1, QTableWidgetItem(
                f"{split.train_start} to {split.train_end}"
            ))
            self._splits_table.setItem(i, 2, QTableWidgetItem(
                f"{split.test_start} to {split.test_end}"
            ))
            self._splits_table.setItem(i, 3, QTableWidgetItem(
                f"{split.in_sample_metrics.sharpe_ratio:.2f}"
            ))
            self._splits_table.setItem(i, 4, QTableWidgetItem(
                f"{split.out_sample_metrics.sharpe_ratio:.2f}"
            ))

        # Average summary
        self._avg_label.setText(
            f"Average: In-Sample: {result.avg_in_sample_sharpe:.2f}  "
            f"Out-Sample: {result.avg_out_sample_sharpe:.2f}  "
            f"Ratio: {result.robustness_score:.2f}"
        )

    def clear(self):
        """Clear all displayed data"""
        self._score_label.setText("")
        self._splits_table.setRowCount(0)
        self._avg_label.setText("")
```

## Dependencies

### Upstream
- E11-F01: WalkForwardResult, WalkForwardSplit dataclasses

### Downstream
- E11-F04-T01: Integrated into OptimizationView

## Success Criteria

- [ ] Robustness score displays with correct indicator
- [ ] Green color for robust (>0.5), red for overfitted
- [ ] All splits show in table with correct data
- [ ] Date ranges formatted correctly
- [ ] Average summary accurate
- [ ] Matches PRD 5.6.3 layout

---
*Template Version: 2.0.0*
