# Spec: E11-F04-T01 - OptimizationView Container

---
# ============================================================================
# SPEC METADATA
# ============================================================================

# === IDENTIFICATION ===
id: E11-F04-T01
clickup_task_id: ''
title: OptimizationView Container
type: task

# === HIERARCHY ===
parent: E11-F04
children: []
epic: E11
feature: F04
task: T01
domain: presentation

# === WORKFLOW ===
status: draft
priority: high

# === TRACKING ===
created: '2025-12-30'
updated: '2025-12-30'
due_date: ''
estimated_hours: 4
actual_hours: 0

# === METADATA ===
tags: [ui, pyside6, view, container, layout]
effort: medium
risk: low
wave: 4
parallel: true
---

**Status**: Draft
**Type**: Task
**Parent**: E11-F04 (Optimization UI Components)
**Wave**: 4 (Can run in parallel with F01 tasks)

## Executive Summary

Create the main OptimizationView container widget that houses all optimization UI components. Implements layout with configuration panel (top), progress display (middle), and results area (bottom). Coordinates workflow between configuration, execution, and results display.

## User Stories

**As a** trader
**I want to** access all optimization features from one screen
**So that** I can efficiently configure, run, and analyze optimizations

## Acceptance Scenarios

### Scenario 1: Initial State
**Given** user navigates to Optimization view
**When** view loads
**Then** configuration panel is visible
**And** progress widget is hidden
**And** results area is empty

### Scenario 2: Start Optimization
**Given** valid configuration entered
**When** user clicks "Start Optimization"
**Then** configuration widgets become disabled
**And** progress widget becomes visible
**And** cancel button is enabled

### Scenario 3: Optimization Complete
**Given** optimization running
**When** all combinations tested
**Then** progress widget hides
**And** results populate in table
**And** configuration widgets re-enable

## Requirements

### Functional Requirements
- **FR-001**: View MUST contain configuration panel, progress area, results area
- **FR-002**: MUST provide start_optimization() method
- **FR-003**: MUST provide cancel_optimization() method
- **FR-004**: MUST disable config widgets during optimization
- **FR-005**: MUST update progress via on_progress(completed, total) slot

### Non-Functional Requirements
- **NFR-001**: UI MUST remain responsive during optimization
- **NFR-002**: Layout MUST be resizable

### Technical Constraints
- **TC-001**: Use PySide6 QWidget as base
- **TC-002**: Use QVBoxLayout for main layout
- **TC-003**: Run optimization in QThread for responsiveness

## Implementation Details

### File Location
`src/presentation/views/optimization/optimization_view.py`

### Code Structure
```python
from PySide6.QtWidgets import QWidget, QVBoxLayout, QPushButton, QMessageBox
from PySide6.QtCore import Signal, Slot, QThread

class OptimizationView(QWidget):
    """Main optimization workflow container"""

    optimization_started = Signal()
    optimization_completed = Signal(object)  # OptimizationResult
    optimization_cancelled = Signal()

    def __init__(self, parent=None):
        super().__init__(parent)
        self._setup_ui()
        self._optimization_thread: Optional[QThread] = None

    def _setup_ui(self):
        layout = QVBoxLayout(self)

        # Configuration panel (top)
        self._config_panel = QWidget()
        # ... strategy selector, param config, target selector
        layout.addWidget(self._config_panel)

        # Progress area (middle) - initially hidden
        self._progress_widget = OptimizationProgressWidget()
        self._progress_widget.hide()
        layout.addWidget(self._progress_widget)

        # Results area (bottom)
        self._results_widget = ResultsTableWidget()
        layout.addWidget(self._results_widget)

        # Action buttons
        self._start_button = QPushButton("Start Optimization")
        self._start_button.clicked.connect(self.start_optimization)

        self._cancel_button = QPushButton("Cancel")
        self._cancel_button.clicked.connect(self.cancel_optimization)
        self._cancel_button.setEnabled(False)

    def start_optimization(self):
        """Start optimization in background thread"""
        # Validate config
        config = self._build_config()
        if not config:
            return

        # Disable config, show progress
        self._set_running_state(True)

        # Start background thread
        self._optimization_thread = OptimizationThread(config)
        self._optimization_thread.progress.connect(self._on_progress)
        self._optimization_thread.completed.connect(self._on_completed)
        self._optimization_thread.start()

    def cancel_optimization(self):
        """Cancel running optimization"""
        if self._optimization_thread:
            self._optimization_thread.cancel()
            self._set_running_state(False)

    @Slot(int, int)
    def _on_progress(self, completed: int, total: int):
        self._progress_widget.update_progress(completed, total)

    @Slot(object)
    def _on_completed(self, result: 'OptimizationResult'):
        self._set_running_state(False)
        self._results_widget.set_results(result.results)
        # Show walk-forward if available
        if result.walk_forward_results:
            self._walk_forward_widget.set_result(result.walk_forward_results)
```

## Dependencies

### Upstream
- E01: Application Framework (view registration)
- E11-F01: Domain models for display

### Downstream
- E11-F04-T02: ParamConfigWidget integrated here
- E11-F04-T03: ResultsTableWidget integrated here
- E11-F04-T04: WalkForwardWidget integrated here
- E11-F04-T05: ParameterHeatmapWidget integrated here

## Success Criteria

- [ ] View layout correctly organized
- [ ] Start/cancel buttons work correctly
- [ ] Config widgets disable during optimization
- [ ] Progress updates display correctly
- [ ] Results populate after completion
- [ ] UI remains responsive (QThread used)

---
*Template Version: 2.0.0*
