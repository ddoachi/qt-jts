# Spec: E11-F04-T02 - ParamConfigWidget

---
# ============================================================================
# SPEC METADATA
# ============================================================================

# === IDENTIFICATION ===
id: E11-F04-T02
clickup_task_id: ''
title: ParamConfigWidget
type: task

# === HIERARCHY ===
parent: E11-F04
children: []
epic: E11
feature: F04
task: T02
domain: presentation

# === WORKFLOW ===
status: draft
priority: high

# === TRACKING ===
created: '2025-12-30'
updated: '2025-12-30'
due_date: ''
estimated_hours: 4
actual_hours: 0

# === METADATA ===
tags: [ui, pyside6, widget, table, parameter-config]
effort: medium
risk: low
wave: 4
parallel: true
---

**Status**: Draft
**Type**: Task
**Parent**: E11-F04 (Optimization UI Components)
**Wave**: 4 (Can run in parallel with other F04 tasks)

## Executive Summary

Create the ParamConfigWidget for configuring parameter ranges in a table format. Each row represents one parameter with editable min, max, step values and a calculated "Values" count. Automatically calculates total combinations and estimated time.

## User Stories

**As a** trader
**I want to** easily configure parameter ranges in a table
**So that** I can quickly set up optimization without coding

## Acceptance Scenarios

### Scenario 1: Display Strategy Parameters
**Given** "RSI Momentum Strategy" selected
**When** ParamConfigWidget updates
**Then** rows show: RSI Period, RSI Oversold, SMA Period
**And** default min/max/step values are populated

### Scenario 2: Edit Parameter Range
**Given** RSI Period row displayed
**When** user changes min=10, max=30, step=5
**Then** "Values" column shows 5
**And** total combinations updates

### Scenario 3: Calculate Combinations
**Given** 3 parameters with [5, 4, 5] values each
**When** table is filled
**Then** "Total Combinations: 100" displayed
**And** "Estimated Time: ~5 minutes" shown

### Scenario 4: Validation
**Given** invalid input (step=0)
**When** validation runs
**Then** error indicator shows on cell
**And** start button disabled

## Requirements

### Functional Requirements
- **FR-001**: Table MUST have columns: Parameter, Min, Max, Step, Values
- **FR-002**: set_strategy() MUST populate rows from strategy parameters
- **FR-003**: get_parameter_ranges() MUST return list of ParameterRange
- **FR-004**: calculate_combinations() MUST return total count
- **FR-005**: MUST update values and total on any cell change

### Technical Constraints
- **TC-001**: Use QTableWidget for editable table
- **TC-002**: Use QSpinBox/QDoubleSpinBox for numeric input
- **TC-003**: Emit signal on configuration change

## Implementation Details

### File Location
`src/presentation/views/optimization/param_config_widget.py`

### Code Structure
```python
from PySide6.QtWidgets import QWidget, QTableWidget, QTableWidgetItem, QLabel, QVBoxLayout
from PySide6.QtCore import Signal

class ParamConfigWidget(QWidget):
    """Table widget for parameter range configuration"""

    config_changed = Signal()  # Emitted when any value changes

    COLUMNS = ["Parameter", "Min", "Max", "Step", "Values"]

    def __init__(self, parent=None):
        super().__init__(parent)
        self._setup_ui()
        self._parameter_rows: list[str] = []

    def _setup_ui(self):
        layout = QVBoxLayout(self)

        self._table = QTableWidget()
        self._table.setColumnCount(len(self.COLUMNS))
        self._table.setHorizontalHeaderLabels(self.COLUMNS)
        self._table.cellChanged.connect(self._on_cell_changed)
        layout.addWidget(self._table)

        # Summary labels
        self._total_label = QLabel("Total Combinations: 0")
        self._time_label = QLabel("Estimated Time: --")
        layout.addWidget(self._total_label)
        layout.addWidget(self._time_label)

    def set_strategy(self, strategy: 'Strategy'):
        """Populate table with strategy parameters"""
        self._table.setRowCount(0)
        self._parameter_rows = []

        for param in strategy.parameters:
            row = self._table.rowCount()
            self._table.insertRow(row)
            self._parameter_rows.append(param.name)

            # Parameter name (read-only)
            name_item = QTableWidgetItem(param.name)
            name_item.setFlags(name_item.flags() & ~Qt.ItemIsEditable)
            self._table.setItem(row, 0, name_item)

            # Min, Max, Step (editable)
            self._table.setItem(row, 1, QTableWidgetItem(str(param.default_value * 0.5)))
            self._table.setItem(row, 2, QTableWidgetItem(str(param.default_value * 1.5)))
            self._table.setItem(row, 3, QTableWidgetItem(str(param.step or 1)))

            # Values (calculated, read-only)
            values_item = QTableWidgetItem("0")
            values_item.setFlags(values_item.flags() & ~Qt.ItemIsEditable)
            self._table.setItem(row, 4, values_item)

        self._update_calculations()

    def get_parameter_ranges(self) -> list['ParameterRange']:
        """Extract ParameterRange list from table"""
        ranges = []
        for row in range(self._table.rowCount()):
            name = self._table.item(row, 0).text()
            min_val = float(self._table.item(row, 1).text())
            max_val = float(self._table.item(row, 2).text())
            step = float(self._table.item(row, 3).text())
            ranges.append(ParameterRange(name, min_val, max_val, step))
        return ranges

    def calculate_combinations(self) -> int:
        """Calculate total parameter combinations"""
        ranges = self.get_parameter_ranges()
        if not ranges:
            return 0
        total = 1
        for r in ranges:
            total *= r.num_values
        return total
```

## Dependencies

### Upstream
- E11-F01: ParameterRange dataclass
- E04: Strategy model with parameters

### Downstream
- E11-F04-T01: Integrated into OptimizationView

## Success Criteria

- [ ] Table displays with correct columns
- [ ] set_strategy() populates rows correctly
- [ ] Editing cells updates values count
- [ ] Total combinations calculated correctly
- [ ] get_parameter_ranges() returns correct data
- [ ] Validation prevents invalid input

---
*Template Version: 2.0.0*
