# Spec: E11-F04 - Optimization UI Components

---
# ============================================================================
# SPEC METADATA
# ============================================================================

# === IDENTIFICATION ===
id: E11-F04
clickup_task_id: ''    # REQUIRED - Empty string if not yet created in ClickUp
title: Optimization UI Components
type: feature

# === HIERARCHY ===
parent: E11
children: [E11-F04-T01, E11-F04-T02, E11-F04-T03, E11-F04-T04, E11-F04-T05]
epic: E11
feature: F04
domain: presentation

# === WORKFLOW ===
status: draft
priority: high

# === TRACKING ===
created: '2025-12-30'
updated: '2025-12-30'
due_date: ''
estimated_hours: 24
actual_hours: 0

# === METADATA ===
tags: [ui, pyside6, optimization, widget, visualization]
effort: large
risk: medium
---

**Status**: Draft
**Type**: Feature
**Parent**: E11 (Strategy Optimization)
**Created**: 2025-12-30
**Updated**: 2025-12-30

## Executive Summary

Implement the UI components for strategy optimization, including the main OptimizationView container, ParamConfigWidget for parameter range configuration, OptimizationProgressWidget for progress display, ResultsTableWidget for ranking results, WalkForwardWidget for robustness visualization, and ParameterHeatmapWidget for parameter performance analysis. These components integrate with the optimization engine to provide a complete optimization workflow.

## Execution Flow

```
1. User opens Optimization view
   → OptimizationView initializes with empty state
   → Strategy selector populated from available strategies
   → ParamConfigWidget shows editable parameter table

2. User configures optimization
   a. Select strategy from dropdown
      → ParamConfigWidget updates with strategy's parameters
      → Default min/max/step values populated

   b. Configure parameter ranges
      → User edits min, max, step for each parameter
      → Total combinations calculated and displayed
      → Estimated time shown based on combination count

   c. Select optimization target
      → Dropdown: Sharpe Ratio, Total Return, Profit Factor, Win Rate, Calmar

   d. Configure walk-forward settings
      → Number of splits (default: 5)
      → Train ratio slider (default: 70%)

3. User clicks "Start Optimization" button
   → Validate all configuration
   → If invalid: Show error message, highlight invalid fields
   → Disable configuration widgets
   → Show OptimizationProgressWidget

4. Optimization runs with progress updates
   → Progress bar updates with completed/total
   → Current combination parameters displayed
   → Elapsed time and estimated remaining time shown
   → Cancel button allows early termination

5. Optimization completes
   → Hide progress widget
   → Populate ResultsTableWidget with ranked results
   → Show top 10-20 results with key metrics
   → If walk-forward ran: Populate WalkForwardWidget

6. User explores results
   → Click row in ResultsTableWidget to see details
   → ParameterHeatmapWidget shows parameter sensitivity
   → WalkForwardWidget shows robustness analysis
   → Export results button saves to CSV
```

## User Stories

### Primary User Story
**As a** trader
**I want to** configure and run strategy optimization through a visual interface
**So that** I can find optimal parameters without coding

### Additional Stories
- **As a** trader, **I want to** see optimization progress in real-time, **So that** I know how long to wait
- **As a** trader, **I want to** view results in a sortable table, **So that** I can compare different parameter combinations
- **As a** trader, **I want to** see walk-forward analysis visually, **So that** I understand robustness at a glance
- **As a** trader, **I want to** export results to CSV, **So that** I can analyze further in Excel

## Acceptance Scenarios

### Scenario 1: Parameter Configuration (PRD 5.6.1)
**Given** user selects "RSI Momentum Strategy"
**When** the ParamConfigWidget updates
**Then** it should show RSI Period, RSI Oversold, SMA Period rows
**And** each row should have Min, Max, Step columns
**And** "Total Combinations" should calculate correctly (e.g., 100)

### Scenario 2: Progress Display
**Given** optimization is running with 100 combinations
**When** 52 combinations complete
**Then** progress bar should show 52%
**And** text should show "52 / 100 combinations"
**And** estimated remaining time should update

### Scenario 3: Results Table (PRD 5.6.2)
**Given** optimization completes with 36 results
**When** ResultsTableWidget populates
**Then** results should be sorted by rank (best first)
**And** columns should include: Rank, param values, Sharpe, Return
**And** clicking a column header should sort by that column

### Scenario 4: Walk-Forward Visualization (PRD 5.6.3)
**Given** walk-forward analysis completed with robustness 0.72
**When** WalkForwardWidget displays
**Then** robustness score should show "0.72 ✓ (Robust)"
**And** split-by-split results should be visible
**And** training/testing periods should be clearly distinguished

## Requirements

### Functional Requirements
- **FR-001**: OptimizationView MUST allow strategy selection from dropdown
- **FR-002**: ParamConfigWidget MUST display editable parameter ranges table
- **FR-003**: System MUST calculate and display total combinations
- **FR-004**: System MUST provide optimization target selection dropdown
- **FR-005**: OptimizationProgressWidget MUST show progress bar and timing
- **FR-006**: System MUST allow cancellation of running optimization
- **FR-007**: ResultsTableWidget MUST display sorted results with all metrics
- **FR-008**: ResultsTableWidget MUST support column-based sorting
- **FR-009**: WalkForwardWidget MUST visualize train/test splits
- **FR-010**: WalkForwardWidget MUST display robustness score with pass/fail indicator
- **FR-011**: ParameterHeatmapWidget MUST show parameter performance visualization
- **FR-012**: System MUST support exporting results to CSV

### Non-Functional Requirements
- **NFR-001**: Performance: UI MUST remain responsive during optimization (async)
- **NFR-002**: Usability: Configuration widgets disabled while optimization runs
- **NFR-003**: Accessibility: All controls keyboard accessible
- **NFR-004**: Internationalization: Korean UI labels where appropriate

### Technical Constraints
- **TC-001**: Must use PySide6 widgets
- **TC-002**: Must use QTableWidget or QTableView for results
- **TC-003**: Must integrate with E11-F02 GridSearchOptimizer via signals/slots
- **TC-004**: Must run optimization in background thread to maintain UI responsiveness

## Key Entities

### Entity: OptimizationView
- **Description**: Main container view for optimization workflow
- **Key Attributes**: `_strategy_selector`, `_param_config`, `_progress`, `_results_table`, `_walk_forward`, `_heatmap`
- **Key Methods**: `start_optimization()`, `cancel_optimization()`, `on_progress()`, `on_complete()`
- **Relationships**: Contains all other widgets, coordinates workflow

### Entity: ParamConfigWidget
- **Description**: Table widget for parameter range configuration
- **Key Attributes**: QTableWidget with columns: Parameter, Min, Max, Step, Values
- **Key Methods**: `set_strategy()`, `get_parameter_ranges()`, `calculate_combinations()`

### Entity: OptimizationProgressWidget
- **Description**: Progress display with bar and timing
- **Key Attributes**: QProgressBar, labels for current/total, elapsed/remaining time
- **Key Methods**: `update_progress()`, `set_current_params()`

### Entity: ResultsTableWidget
- **Description**: Sortable table of optimization results
- **Key Attributes**: QTableView with custom model, column headers
- **Key Methods**: `set_results()`, `export_to_csv()`, `on_row_selected()`

### Entity: WalkForwardWidget
- **Description**: Walk-forward analysis visualization
- **Key Attributes**: Split timeline, per-split metrics, robustness indicator
- **Key Methods**: `set_result()`, `show_split_details()`

### Entity: ParameterHeatmapWidget
- **Description**: Parameter sensitivity visualization
- **Key Attributes**: 2D heatmap grid, color scale
- **Key Methods**: `set_results()`, `set_parameters()`

## Dependencies

### Upstream Dependencies
- [ ] E11-F01: Optimization Domain Models (for data display)
- [ ] E11-F02: GridSearchOptimizer (for running optimization)
- [ ] E11-F03: WalkForwardAnalyzer (results displayed)
- [ ] E01: Application Framework (MainWindow, view registration)
- [ ] E04: Strategy Builder (strategy list)

### Downstream Impact
- [ ] None - UI is end-user facing

## Gate Checks

### Pre-Implementation Gates
- [x] No [NEEDS CLARIFICATION] markers remain
- [x] Performance requirements specified (responsive UI)
- [x] Security requirements defined (N/A)
- [x] Scale requirements clear (display up to 1000 results)
- [x] PRD compliance verified (Section 5.6)

### Quality Gates
- [ ] Complexity justified
- [ ] All requirements testable
- [ ] Dependencies identified and documented
- [ ] Risk assessment complete

## Tasks Preview

### Implementation Tasks
- [ ] T01 [P] Create OptimizationView skeleton with layout
- [ ] T02 [P] Implement ParamConfigWidget with editable table
- [ ] T03 Implement strategy selector and parameter loading (depends on T01, T02)
- [ ] T04 [P] Implement OptimizationProgressWidget
- [ ] T05 Implement optimization execution with background thread (depends on T01, T04)
- [ ] T06 [P] Implement ResultsTableWidget with sorting
- [ ] T07 [P] Implement WalkForwardWidget visualization
- [ ] T08 Implement ParameterHeatmapWidget (depends on T06)
- [ ] T09 Implement CSV export functionality (depends on T06)
- [ ] T10 Wire all components together and test workflow (depends on all)

**[P]** = Can be executed in parallel

## Success Criteria

### Acceptance Criteria
- [ ] User can select strategy and configure parameter ranges
- [ ] Total combinations calculated and displayed correctly
- [ ] Optimization runs with progress updates
- [ ] Results displayed in sortable table
- [ ] Walk-forward results visualized with robustness score
- [ ] Parameter heatmap shows sensitivity analysis
- [ ] CSV export works correctly
- [ ] UI remains responsive during optimization

### Definition of Done
- [ ] Code reviewed and approved
- [ ] Tests passing
  - [ ] Unit tests for ParamConfigWidget calculations
  - [ ] UI tests for widget interactions
  - [ ] Integration test for full optimization workflow
- [ ] Documentation updated
- [ ] Cross-platform testing complete (Linux, macOS, Windows)
- [ ] 75% test coverage achieved

## Risk Assessment

| Risk | Probability | Impact | Mitigation |
|------|------------|--------|------------|
| UI freezing during optimization | High | High | Use QThread for background execution |
| Memory issues with large result sets | Medium | Medium | Paginate results, limit display count |
| Heatmap rendering performance | Medium | Low | Use efficient rendering, limit resolution |
| Complex widget layout issues | Medium | Medium | Use Qt Designer for initial layout |

## Notes and Clarifications

### Decisions Made
- 2025-12-30: Use QTableView with custom model for results (better performance)
- 2025-12-30: Run optimization in QThread to maintain responsiveness
- 2025-12-30: Show top 20 results by default, with pagination for more

### File Locations
```
src/presentation/views/optimization/
├── optimization_view.py
├── param_config_widget.py
├── optimization_progress_widget.py
├── results_table_widget.py
├── walk_forward_widget.py
└── param_heatmap_widget.py
```

---
*Template Version: 2.0.0 - Enhanced with Speckit features*
