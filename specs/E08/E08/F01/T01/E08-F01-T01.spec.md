# Spec: E08-F01-T01 - Define DiscoveryConfig and LabeledEvent

---
# ============================================================================
# SPEC METADATA
# ============================================================================

# === IDENTIFICATION ===
id: E08-F01-T01
clickup_task_id: '86ew02150'
title: Define DiscoveryConfig and LabeledEvent
type: task

# === HIERARCHY ===
parent: E08-F01
children: []
epic: E08
feature: F01
task: T01
domain: discovery

# === WORKFLOW ===
status: draft
priority: high

# === TRACKING ===
created: '2025-12-28'
updated: '2025-12-28'
due_date: ''
estimated_hours: 2
actual_hours: 0

# === METADATA ===
tags: [domain-model, entities, value-objects, config]
effort: medium
risk: low
---

**Status**: Draft
**Type**: Task
**Parent**: [E08-F01](../E08-F01.spec.md)
**Created**: 2025-12-28
**Updated**: 2025-12-28

## Executive Summary

Define the core configuration and event entities for pattern discovery: `DiscoveryType` enum, `DiscoveryConfig` dataclass, `OutcomeLabel` enum, and `LabeledEvent` dataclass. These are the foundational types used throughout the discovery workflow.

## Execution Flow

```
1. Create DiscoveryType enum
   → Define ENTRY, EXIT, STOP_LOSS values
   → Inherit from str, Enum for JSON serialization

2. Create DiscoveryConfig dataclass
   → Add discovery_type, lookahead_period, success_threshold, failure_threshold, min_samples
   → Implement __post_init__ validation
   → If lookahead_period < 1: ERROR "Invalid lookahead"
   → If success_threshold <= 0: ERROR "Invalid threshold"
   → If failure_threshold >= 0: ERROR "Invalid threshold"
   → If min_samples < 10: ERROR "Invalid min_samples"

3. Create OutcomeLabel enum
   → Define SUCCESS, FAILURE, NEUTRAL values
   → Inherit from str, Enum

4. Create LabeledEvent dataclass
   → Add all required fields (frozen=True)
   → Include: symbol, timestamp, candle, indicator_values, outcome, forward_return, exit_timestamp, exit_reason
   → Return: SUCCESS with all entities defined
```

## User Stories

### Primary User Story
**As a** developer
**I want to** have well-defined configuration and event entities
**So that** I can implement outcome labeling with type safety

### Additional Stories
- **As a** developer, **I want to** validated configuration, **So that** invalid parameters are caught early
- **As a** developer, **I want to** immutable entities, **So that** data integrity is maintained

## Acceptance Scenarios

### Scenario 1: Create Valid DiscoveryConfig
**Given** valid parameters (lookahead=5, success=0.03, failure=-0.02, min_samples=30)
**When** I create a DiscoveryConfig
**Then** the dataclass is created successfully

### Scenario 2: Invalid Lookahead Period
**Given** lookahead_period = 0 (invalid)
**When** I try to create DiscoveryConfig
**Then** ValueError is raised with message "lookahead_period must be >= 1"

### Scenario 3: Invalid Success Threshold
**Given** success_threshold = -0.01 (negative)
**When** I try to create DiscoveryConfig
**Then** ValueError is raised with message "success_threshold must be positive"

### Scenario 4: Invalid Failure Threshold
**Given** failure_threshold = 0.01 (positive)
**When** I try to create DiscoveryConfig
**Then** ValueError is raised with message "failure_threshold must be negative"

### Scenario 5: Create LabeledEvent
**Given** all required fields provided
**When** I create a LabeledEvent
**Then** the frozen dataclass is created successfully

## Requirements

### Functional Requirements
- **FR-001**: `DiscoveryType` MUST have three values: ENTRY, EXIT, STOP_LOSS
- **FR-002**: `DiscoveryConfig` MUST validate all parameters in `__post_init__`
- **FR-003**: `OutcomeLabel` MUST have three values: SUCCESS, FAILURE, NEUTRAL
- **FR-004**: `LabeledEvent` MUST be immutable (frozen dataclass)
- **FR-005**: All enums MUST have string values for JSON serialization

### Non-Functional Requirements
- **NFR-001**: All types MUST pass mypy strict mode
- **NFR-002**: Test coverage MUST be > 90%

### Technical Constraints
- **TC-001**: Must use Python dataclasses with frozen=True
- **TC-002**: Must use Python Enum with str inheritance
- **TC-003**: Must be JSON serializable

## Key Entities

### Entity: DiscoveryType
- **Description**: Enum for discovery types
- **Values**: ENTRY="entry", EXIT="exit", STOP_LOSS="stop_loss"

### Entity: DiscoveryConfig
- **Description**: Configuration for pattern discovery
- **Attributes**: discovery_type, lookahead_period, success_threshold, failure_threshold, min_samples
- **Validation**: All parameters validated in __post_init__

### Entity: OutcomeLabel
- **Description**: Enum for outcome labels
- **Values**: SUCCESS="success", FAILURE="failure", NEUTRAL="neutral"

### Entity: LabeledEvent
- **Description**: Event with forward-looking outcome
- **Attributes**: symbol, timestamp, candle, indicator_values, outcome, forward_return, exit_timestamp, exit_reason

## Dependencies

### Upstream Dependencies
- [x] E07: Candle entity for LabeledEvent

### Downstream Impact
- [ ] E08-F01-T02: Uses entities for DiscoveredRule
- [ ] E08-F02: Uses DiscoveryConfig, LabeledEvent

## Gate Checks

### Pre-Implementation Gates
- [x] No [NEEDS CLARIFICATION] markers remain
- [x] All entity attributes defined
- [x] Validation rules specified

### Quality Gates
- [ ] All entities implemented
- [ ] Unit tests written
- [ ] mypy passes

## Success Criteria

### Acceptance Criteria
- [ ] `DiscoveryType` enum with 3 values (ENTRY, EXIT, STOP_LOSS)
- [ ] `DiscoveryConfig` dataclass with validation in `__post_init__`
- [ ] `OutcomeLabel` enum with 3 values (SUCCESS, FAILURE, NEUTRAL)
- [ ] `LabeledEvent` dataclass with all required fields
- [ ] All types are JSON serializable
- [ ] All dataclasses are frozen (immutable)

### Definition of Done
- [ ] Type hints pass mypy strict mode
- [ ] Unit tests for validation logic
- [ ] Test coverage > 90%

## Risk Assessment

| Risk | Probability | Impact | Mitigation |
|------|------------|--------|------------|
| Type incompatibility | Low | Medium | Use strict typing, test serialization |
| Validation edge cases | Low | Low | Comprehensive test cases |

## Artifacts

### Input Documents
- [E08-F01 Domain Model](../E08-F01.spec.md)
- PRD Section 5.3.2: Discovery Types

### Output Artifacts
- [ ] `src/domain/discovery/value_objects.py`
- [ ] `src/domain/discovery/entities.py`

---
*Template Version: 2.0.0*
