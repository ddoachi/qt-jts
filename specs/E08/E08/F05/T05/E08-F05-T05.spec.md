# Spec: E08-F05-T05 - Create RuleReviewWidget

---
# ============================================================================
# SPEC METADATA
# ============================================================================

# === IDENTIFICATION ===
id: E08-F05-T05
clickup_task_id: '86ew021dz'
title: Create RuleReviewWidget
type: task

# === HIERARCHY ===
parent: E08-F05
children: []
epic: E08
feature: F05
task: T05
domain: discovery

# === WORKFLOW ===
status: draft
priority: high

# === TRACKING ===
created: '2025-12-28'
updated: '2025-12-28'
due_date: ''
estimated_hours: 3
actual_hours: 0

# === METADATA ===
tags: [ui, pyqt, dialog, review, statistics]
effort: medium
risk: low
---

**Status**: Draft
**Type**: Task
**Parent**: [E08-F05](../E08-F05.spec.md)
**Created**: 2025-12-28
**Updated**: 2025-12-28

## Executive Summary

Create a detailed review dialog for examining a single discovered rule with all sample matches and complete statistics. The dialog shows the formula prominently, a statistics grid, and a table of all sample matches.

## Execution Flow

```
1. Initialize RuleReviewWidget with DiscoveredRule
   → Store rule reference
   → Set window title with formula preview
   → Call _setup_ui()

2. _setup_ui() creates dialog layout
   → Create Formula section with monospace styling
   → Create Performance Statistics section with grid layout
   → Create Sample Matches section with QTableWidget
   → Add action buttons ("전략에 추가", "닫기")

3. _populate_samples_table() fills the table
   → Set columns: Symbol, Date, Outcome, Return, Exit Reason
   → For each sample: add row with formatted values
   → Apply color coding (green for success, red for failure)

4. _on_add_to_strategy() handler
   → Emit add_to_strategy_requested signal
   → Close dialog with accept()
```

## User Stories

### Primary User Story
**As a** trader
**I want to** review a rule in detail
**So that** I can fully evaluate its quality before using

### Additional Stories
- **As a** trader, **I want to** see all sample matches, **So that** I can validate the pattern
- **As a** trader, **I want to** add to strategy from review, **So that** workflow is smooth

## Acceptance Scenarios

### Scenario 1: Dialog Creation
**Given** a DiscoveredRule
**When** RuleReviewWidget is created
**Then** dialog opens with rule data displayed

### Scenario 2: Formula Display
**Given** rule with formula "rsi(14) < 25 AND volume > 15000000"
**When** dialog is shown
**Then** formula is prominently displayed in monospace

### Scenario 3: Statistics Display
**Given** rule with statistics
**When** looking at Performance Statistics section
**Then** all metrics are displayed with proper formatting

### Scenario 4: Sample Matches Table
**Given** rule with 10 sample matches
**When** dialog is shown
**Then** table shows all 10 samples with outcome colors

### Scenario 5: Add to Strategy
**Given** dialog is open
**When** I click "전략에 추가"
**Then** add_to_strategy_requested is emitted and dialog closes

### Scenario 6: Close Button
**Given** dialog is open
**When** I click "닫기"
**Then** dialog closes without emitting signals

## Requirements

### Functional Requirements
- **FR-001**: Dialog MUST show formula prominently
- **FR-002**: Dialog MUST display all statistics
- **FR-003**: Dialog MUST show table of all sample matches
- **FR-004**: Dialog MUST have add to strategy button

### Non-Functional Requirements
- **NFR-001**: Resizable dialog
- **NFR-002**: Color coding for outcomes

### Technical Constraints
- **TC-001**: Must use PyQt6/PySide6 QDialog
- **TC-002**: Must use QTableWidget for samples

## Key Entities

### Widget: RuleReviewWidget (QDialog)
- **Description**: Detailed rule review with statistics table
- **Signals**: add_to_strategy_requested(DiscoveredRule)

## Dependencies

### Upstream Dependencies
- [x] E08-F05-T04: DiscoveryResultsWidget (opens this dialog)
- [x] E08-F01: DiscoveredRule, LabeledEvent, OutcomeLabel

### Downstream Impact
- None (leaf dialog)

## Gate Checks

### Pre-Implementation Gates
- [x] No [NEEDS CLARIFICATION] markers remain
- [x] Dialog layout designed
- [x] Table columns defined

### Quality Gates
- [ ] Dialog implemented
- [ ] Color coding applied
- [ ] Unit tests written

## Success Criteria

### Acceptance Criteria
- [ ] `RuleReviewWidget` dialog implemented
- [ ] Shows formula prominently
- [ ] Displays all statistics with formatting
- [ ] Color coding for outcomes
- [ ] Table with all sample matches
- [ ] "전략에 추가" button emits signal
- [ ] "닫기" button closes dialog

### Definition of Done
- [ ] Resizable dialog
- [ ] Unit tests for widget
- [ ] Korean language buttons

## Risk Assessment

| Risk | Probability | Impact | Mitigation |
|------|------------|--------|------------|
| Table performance | Low | Low | Limit to 10 samples (already limited) |
| Layout issues | Low | Low | Use proper Qt layouts |

## Artifacts

### Input Documents
- [E08-F05-T04 DiscoveryResultsWidget](../T04/E08-F05-T04.spec.md)
- [E08-F01 Domain Model](../../F01/E08-F01.spec.md)

### Output Artifacts
- [ ] `src/presentation/views/discovery/rule_review_widget.py`

---
*Template Version: 2.0.0*
