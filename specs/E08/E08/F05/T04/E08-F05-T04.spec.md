# Spec: E08-F05-T04 - Create DiscoveryResultsWidget

---
# ============================================================================
# SPEC METADATA
# ============================================================================

# === IDENTIFICATION ===
id: E08-F05-T04
clickup_task_id: '86ew021d5'
title: Create DiscoveryResultsWidget
type: task

# === HIERARCHY ===
parent: E08-F05
children: []
epic: E08
feature: F05
task: T04
domain: discovery

# === WORKFLOW ===
status: draft
priority: high

# === TRACKING ===
created: '2025-12-28'
updated: '2025-12-28'
due_date: ''
estimated_hours: 4
actual_hours: 0

# === METADATA ===
tags: [ui, pyqt, widget, results, cards]
effort: large
risk: low
---

**Status**: Draft
**Type**: Task
**Parent**: [E08-F05](../E08-F05.spec.md)
**Created**: 2025-12-28
**Updated**: 2025-12-28

## Executive Summary

Create a widget that displays discovered rules with statistics and sample matches in a ranked list format. Each rule is displayed as a card showing formula, statistics grid, sample matches, and action buttons.

## Execution Flow

```
1. Initialize DiscoveryResultsWidget
   → Call _setup_ui()

2. _setup_ui() creates layout
   → Add header label "Discovered {Type} Rules"
   → Create QScrollArea for rule cards
   → Create container widget for cards layout

3. set_results() displays discovered rules
   → Update header with discovery type
   → Clear existing cards
   → For each rule: call _create_rule_card(rule, rank)
   → Add stretch at end

4. _create_rule_card() builds card widget
   → Create QFrame with styling
   → Add rank and title (⭐ for rank 1)
   → Add formula in monospace style
   → Add statistics grid (hit_rate, avg_return, profit_factor, max_consec)
   → Add top 3 sample matches with outcome icons
   → Add "자세히 보기" and "전략에 추가" buttons
   → Connect buttons to signals
   → Return: card widget
```

## User Stories

### Primary User Story
**As a** trader
**I want to** see discovered rules with statistics
**So that** I can evaluate their quality

### Additional Stories
- **As a** trader, **I want to** see sample matches, **So that** I can validate the pattern
- **As a** trader, **I want to** add rules to strategy, **So that** I can use them in trading

## Acceptance Scenarios

### Scenario 1: Empty Results
**Given** no rules discovered
**When** set_results([]) is called
**Then** empty state is shown

### Scenario 2: Multiple Rules Display
**Given** 5 discovered rules
**When** set_results(rules) is called
**Then** 5 rule cards are displayed in ranked order

### Scenario 3: Statistics Grid
**Given** a rule with hit_rate=0.68, profit_factor=2.3
**When** card is displayed
**Then** statistics show "68.0%" and "2.3"

### Scenario 4: Sample Matches
**Given** a rule with sample matches
**When** card is displayed
**Then** top 3 samples with outcome icons are shown

### Scenario 5: View Details Button
**Given** a rule card is displayed
**When** I click "자세히 보기"
**Then** rule_selected signal is emitted with the rule

### Scenario 6: Add to Strategy Button
**Given** a rule card is displayed
**When** I click "전략에 추가"
**Then** add_to_strategy_requested signal is emitted with the rule

## Requirements

### Functional Requirements
- **FR-001**: Widget MUST display rules in ranked card format
- **FR-002**: Widget MUST show formula, statistics, sample matches
- **FR-003**: Widget MUST show ⭐ indicator for rank 1
- **FR-004**: Widget MUST be scrollable for many rules

### Non-Functional Requirements
- **NFR-001**: Cards should have clear visual hierarchy
- **NFR-002**: Statistics should be formatted nicely

### Technical Constraints
- **TC-001**: Must use PyQt6/PySide6 widgets
- **TC-002**: Must handle empty results gracefully

## Key Entities

### Widget: DiscoveryResultsWidget
- **Description**: Scrollable list of rule cards
- **Signals**: rule_selected(DiscoveredRule), add_to_strategy_requested(DiscoveredRule)
- **Methods**: set_results(rules, discovery_type)

## Dependencies

### Upstream Dependencies
- [x] E08-F05-T01: DiscoveryView (parent integration)
- [x] E08-F01: DiscoveredRule, RuleStatistics, OutcomeLabel

### Downstream Impact
- [ ] E08-F05-T05: Opens RuleReviewWidget on detail click

## Gate Checks

### Pre-Implementation Gates
- [x] No [NEEDS CLARIFICATION] markers remain
- [x] Card layout designed
- [x] Statistics format specified

### Quality Gates
- [ ] Widget implemented
- [ ] Card styling applied
- [ ] Unit tests written

## Success Criteria

### Acceptance Criteria
- [ ] `DiscoveryResultsWidget` class implemented
- [ ] Displays rules in ranked card format
- [ ] Shows formula, statistics, sample matches
- [ ] First place gets star indicator
- [ ] Scrollable list for many rules
- [ ] "자세히 보기" and "전략에 추가" buttons
- [ ] Signals for rule selection/add

### Definition of Done
- [ ] Handles empty results
- [ ] Unit tests for widget
- [ ] Korean language buttons

## Risk Assessment

| Risk | Probability | Impact | Mitigation |
|------|------------|--------|------------|
| Layout issues | Low | Low | Use proper Qt layouts |
| Performance with many rules | Low | Low | Lazy loading if needed |

## Artifacts

### Input Documents
- [E08-F05-T01 DiscoveryView](../T01/E08-F05-T01.spec.md)
- [E08-F01 Domain Model](../../F01/E08-F01.spec.md)
- PRD Section 5.3.4: Discovered Rules Output

### Output Artifacts
- [ ] `src/presentation/views/discovery/discovery_results_widget.py`

---
*Template Version: 2.0.0*
