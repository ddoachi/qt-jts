---
# ============================================================================
# SPEC METADATA
# ============================================================================

# === IDENTIFICATION ===
id: E07-F05-T02
clickup_task_id: '86ew020u4'
title: Implement Excel Export
type: task

# === HIERARCHY ===
parent: E07-F05
children: []
epic: E07
feature: F05
task: T02
domain: scanner

# === WORKFLOW ===
status: draft
priority: medium

# === TRACKING ===
created: '2025-12-28'
updated: '2025-12-28'
due_date: ''
estimated_hours: 4
actual_hours: 0

# === METADATA ===
tags:
  - export
  - excel
  - openpyxl
effort: medium
risk: low
wave: 2
---

# Spec: E07-F05-T02 - Implement Excel Export

**Status**: Draft
**Type**: Task
**Parent**: [E07-F05](../E07-F05.spec.md)
**Created**: 2025-12-28
**Updated**: 2025-12-28

## Executive Summary

Implement Excel (XLSX) export using openpyxl with styled headers, auto-width columns, number formatting, and frozen header row.

## Execution Flow

```
1. Create workbook
   → Create Workbook()
   → Get active worksheet
   → Set sheet name

2. Write styled header
   → Bold white text on blue background
   → Center alignment
   → Apply to first row

3. Write data rows
   → Set cell values
   → Apply number formats (currency, percent)
   → Right-align numeric columns

4. Apply column widths
   → Calculate max width per column
   → Set column widths with padding

5. Freeze header
   → Set freeze_panes = "A2"
   → Save file
   → Return: SUCCESS with file
```

## User Stories

### Primary User Story
**As a** trader
**I want to** export to Excel with formatting
**So that** the file is ready to use

## Acceptance Scenarios

### Scenario 1: Styled Header
**Given** export to Excel
**When** file opened
**Then** header row has blue background and bold text

### Scenario 2: Number Formatting
**Given** close price 72500
**When** viewed in Excel
**Then** shows as 72,500 (with number format)

### Scenario 3: Auto-width Columns
**Given** Korean stock names of varying length
**When** exported
**Then** columns fit content

### Scenario 4: Frozen Header
**Given** Excel file opened
**When** scrolling down
**Then** header row remains visible

## Requirements

### Functional Requirements
- **FR-001**: MUST create valid XLSX file
- **FR-002**: MUST have styled header
- **FR-003**: MUST auto-width columns
- **FR-004**: MUST freeze header row
- **FR-005**: MUST apply number formats

### Non-Functional Requirements
- **NFR-001**: 10,000 rows in < 5 seconds

### Technical Constraints
- **TC-001**: Use openpyxl
- **TC-002**: Number format: #,##0 for currency

## Key Entities

### Class: ScanExportService (Extended)
```python
class ScanExportService:
    HEADER_FONT = Font(bold=True, color="FFFFFF")
    HEADER_FILL = PatternFill(start_color="4472C4", fill_type="solid")
    CURRENCY_FORMAT = '#,##0'
    PERCENT_FORMAT = '0.00%'

    def export_to_excel(
        self,
        matches: list[ScanMatch],
        file_path: Path,
        columns: Optional[list[ExportColumn]] = None,
        sheet_name: str = "Scan Results"
    ) -> None

    def export_to_excel_bytes(
        self,
        matches: list[ScanMatch],
        columns: Optional[list[ExportColumn]] = None
    ) -> bytes
```

## Dependencies

### Upstream Dependencies
- [ ] E07-F05-T01: CSV export (same column definitions)

### Downstream Impact
- [ ] E07-F04-T03: Uses export service

## Gate Checks

### Pre-Implementation Gates
- [ ] openpyxl installed
- [ ] E07-F05-T01 complete

### Quality Gates
- [ ] Styling tested
- [ ] Performance tested
- [ ] 90% test coverage

## Success Criteria

### Acceptance Criteria
- [ ] Valid XLSX file
- [ ] Header styled correctly
- [ ] Columns auto-width
- [ ] Header frozen
- [ ] Numbers formatted

### Definition of Done
- [ ] Code reviewed
- [ ] Unit tests passing
- [ ] Tested in Excel

## Artifacts

### Input Documents
- [Feature Spec](../E07-F05.spec.md)
- [T01 Spec](../T01/E07-F05-T01.spec.md)

### Output Artifacts
- [ ] Extended `src/application/services/scan_export_service.py`

---
*Template Version: 2.0.0*
