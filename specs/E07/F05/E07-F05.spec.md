---
# ============================================================================
# SPEC METADATA
# ============================================================================

# === IDENTIFICATION ===
id: E07-F05
clickup_task_id: ''
title: Export
type: feature

# === HIERARCHY ===
parent: E07
children:
  - E07-F05-T01
  - E07-F05-T02
epic: E07
feature: F05
domain: scanner

# === WORKFLOW ===
status: draft
priority: medium

# === TRACKING ===
created: '2025-12-28'
updated: '2025-12-28'
due_date: ''
estimated_hours: 8
actual_hours: 0

# === METADATA ===
tags:
  - export
  - csv
  - excel
effort: medium
risk: low
wave: 2
---

# Spec: E07-F05 - Export

**Status**: Draft
**Type**: Feature
**Parent**: [E07](../E07.spec.md)
**Created**: 2025-12-28
**Updated**: 2025-12-28

## Executive Summary

Implement export functionality for scan results in CSV and Excel formats. CSV export uses UTF-8 with BOM for Excel compatibility with Korean characters. Excel export uses openpyxl with formatted headers, auto-width columns, and number formatting.

## Execution Flow

```
1. User requests export
   → Select format (CSV or Excel)
   → Select columns (optional, default all)
   → Choose file path

2. For CSV export
   → Write UTF-8 BOM
   → Write header row with Korean labels
   → Format each cell value
   → Write data rows
   → Return: SUCCESS with file path

3. For Excel export
   → Create workbook with styled header
   → Apply number formats to cells
   → Auto-fit column widths
   → Freeze header row
   → Save file
   → Return: SUCCESS with file path
```

## User Stories

### Primary User Story
**As a** trader
**I want to** export scan results to CSV or Excel
**So that** I can analyze them in spreadsheet software

### Additional Stories
- **As a** trader, **I want to** Korean characters to display correctly in Excel, **So that** I can read stock names
- **As a** trader, **I want to** formatted Excel output, **So that** it's ready to use without manual formatting

## Acceptance Scenarios

### Scenario 1: CSV Export with Korean
**Given** scan results with Korean stock names
**When** I export to CSV and open in Excel
**Then** Korean characters display correctly

### Scenario 2: Excel Formatting
**Given** scan results exported to Excel
**When** I open the file
**Then** headers are styled, columns auto-fit, and numbers formatted

### Scenario 3: Large Export Performance
**Given** 10,000 scan results
**When** I export to CSV or Excel
**Then** export completes in less than 5 seconds

## Requirements

### Functional Requirements
- **FR-001**: System MUST export to CSV with UTF-8 BOM encoding
- **FR-002**: System MUST export to Excel (XLSX) format
- **FR-003**: System MUST support configurable column selection
- **FR-004**: System MUST format currency with comma separators
- **FR-005**: Excel MUST have styled headers and auto-width columns

### Non-Functional Requirements
- **NFR-001**: Performance: 10,000 rows exported in < 5 seconds
- **NFR-002**: File Size: CSV < 1MB per 10,000 rows

### Technical Constraints
- **TC-001**: Must use UTF-8 with BOM for CSV
- **TC-002**: Must use openpyxl for Excel generation
- **TC-003**: Must properly escape special characters in CSV

## Key Entities

### Service: ScanExportService
- **Description**: Service for exporting scan results
- **Methods**: export_to_csv(), export_to_excel(), export_to_csv_string(), export_to_excel_bytes()

### Value Object: ExportColumn
- **Description**: Definition of exportable column
- **Attributes**: key, label, formatter

## Dependencies

### Upstream Dependencies
- [ ] E07-F01-T02: ScanMatch entity for data structure

### Downstream Impact
- [ ] E07-F04-T03: ScanResultsWidget uses export service

## Gate Checks

### Pre-Implementation Gates
- [ ] E07-F01-T02 complete (ScanMatch)
- [ ] Column definitions finalized
- [ ] Format requirements clear

### Quality Gates
- [ ] Korean character tests pass
- [ ] Performance test for 10,000 rows
- [ ] Excel file validates

## Tasks Preview

### Implementation Tasks
- [ ] T01 Implement CSV export
- [ ] T02 Implement Excel export (depends on T01)

## Success Criteria

### Acceptance Criteria
- [ ] CSV opens correctly in Excel with Korean
- [ ] Excel has styled headers
- [ ] Export completes in < 5 seconds for 10,000 rows
- [ ] All column types format correctly
- [ ] 90% test coverage

### Definition of Done
- [ ] Code reviewed and approved
- [ ] Unit tests passing
- [ ] Manual testing in Excel completed
- [ ] Documentation updated

## Risk Assessment

| Risk | Probability | Impact | Mitigation |
|------|------------|--------|------------|
| Excel compatibility issues | Low | Medium | Test with multiple Excel versions |
| Memory issues with large exports | Low | Medium | Streaming approach if needed |

## Notes and Clarifications

### Default Columns
| Key | Label (Korean) | Format |
|-----|----------------|--------|
| symbol | 종목코드 | Text |
| symbol_name | 종목명 | Text |
| match_time | 매칭시간 | DateTime |
| close | 종가 | Currency |
| volume | 거래량 | Number |
| volume_ratio | 거래량비율 | Decimal |
| change_pct | 등락률 | Percent |

### File Structure
```
src/application/
└── services/
    └── scan_export_service.py

src/domain/
└── value_objects/
    └── export_column.py
```

## Artifacts

### Input Documents
- [Product Requirements](../../../docs/prd.md)
- [Parent Spec](../E07.spec.md)

### Output Artifacts
- [ ] `E07-F05.context.md` - Implementation context
- [ ] `E07-F05.pre-docs.md` - Pre-implementation documentation
- [ ] `E07-F05.post-docs.md` - Post-implementation learnings

---
*Template Version: 2.0.0*
