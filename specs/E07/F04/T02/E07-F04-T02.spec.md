---
# ============================================================================
# SPEC METADATA
# ============================================================================

# === IDENTIFICATION ===
id: E07-F04-T02
clickup_task_id: '86ew020t1'
title: Create FormulaLibraryWidget
type: task

# === HIERARCHY ===
parent: E07-F04
children: []
epic: E07
feature: F04
task: T02
domain: scanner

# === WORKFLOW ===
status: draft
priority: high

# === TRACKING ===
created: '2025-12-28'
updated: '2025-12-28'
due_date: ''
estimated_hours: 8
actual_hours: 0

# === METADATA ===
tags:
  - ui
  - widget
  - formula
effort: large
risk: medium
wave: 3
---

# Spec: E07-F04-T02 - Create FormulaLibraryWidget

**Status**: Draft
**Type**: Task
**Parent**: [E07-F04](../E07-F04.spec.md)
**Created**: 2025-12-28
**Updated**: 2025-12-28

## Executive Summary

Create sidebar widget for formula library with search, category filter, formula list, context menu for edit/delete, and new formula button.

## Execution Flow

```
1. Create widget layout
   → Search input with clear button
   → Category dropdown
   → Formula list (QListWidget)
   → New formula button

2. Load formulas
   → Call FormulaLibraryUseCase.get_all()
   → Filter by search/category
   → Display in list

3. Handle user interactions
   → Search: debounce and reload
   → Category: reload filtered
   → Click: emit formula_selected
   → Double-click: emit edit_formula_requested
   → Right-click: show context menu

4. Context menu
   → Edit option
   → Delete option with confirmation
   → Return: SUCCESS with widget
```

## User Stories

### Primary User Story
**As a** trader
**I want to** browse and select formulas
**So that** I can use them for scanning

## Acceptance Scenarios

### Scenario 1: Search Filter
**Given** formulas in library
**When** I type "volume" in search
**Then** only matching formulas shown

### Scenario 2: Category Filter
**Given** formulas in multiple categories
**When** I select "Scan" category
**Then** only scan formulas shown

### Scenario 3: Select Formula
**Given** formula list displayed
**When** I click a formula
**Then** formula_selected signal is emitted

### Scenario 4: Context Menu
**Given** formula in list
**When** I right-click
**Then** menu with Edit/Delete shown

## Requirements

### Functional Requirements
- **FR-001**: MUST have search input
- **FR-002**: MUST have category filter dropdown
- **FR-003**: MUST display formulas in list
- **FR-004**: MUST emit signals on selection
- **FR-005**: MUST have context menu for edit/delete

### Non-Functional Requirements
- **NFR-001**: Search debounce 300ms
- **NFR-002**: List updates < 100ms

### Technical Constraints
- **TC-001**: Use FormulaLibraryUseCase
- **TC-002**: Async formula loading

## Key Entities

### Class: FormulaLibraryWidget
```python
class FormulaLibraryWidget(QWidget):
    formula_selected = Signal(object)
    new_formula_requested = Signal()
    edit_formula_requested = Signal(object)
    delete_formula_requested = Signal(object)

    def __init__(self, formula_use_case: FormulaLibraryUseCase): ...
    def refresh(self) -> None
    def get_selected_formula(self) -> Optional[Formula]
```

## Dependencies

### Upstream Dependencies
- [ ] E07-F03-T01: FormulaLibraryUseCase
- [ ] E07-F04-T01: ScannerView container

### Downstream Impact
- [ ] None - UI component

## Gate Checks

### Pre-Implementation Gates
- [ ] E07-F04-T01 complete
- [ ] E07-F03-T01 complete

### Quality Gates
- [ ] All interactions tested
- [ ] Async loading tested
- [ ] 80% test coverage

## Success Criteria

### Acceptance Criteria
- [ ] Search filters correctly
- [ ] Category filters correctly
- [ ] Selection signals work
- [ ] Context menu works

### Definition of Done
- [ ] Code reviewed
- [ ] UI tests passing
- [ ] Manual testing done

## Artifacts

### Input Documents
- [Feature Spec](../E07-F04.spec.md)

### Output Artifacts
- [ ] `src/presentation/views/scanner/formula_library_widget.py`

---
*Template Version: 2.0.0*
