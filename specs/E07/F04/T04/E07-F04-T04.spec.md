---
# ============================================================================
# SPEC METADATA
# ============================================================================

# === IDENTIFICATION ===
id: E07-F04-T04
clickup_task_id: '86ew020tc'
title: Create ChartPreviewWidget
type: task

# === HIERARCHY ===
parent: E07-F04
children: []
epic: E07
feature: F04
task: T04
domain: scanner

# === WORKFLOW ===
status: draft
priority: high

# === TRACKING ===
created: '2025-12-28'
updated: '2025-12-28'
due_date: ''
estimated_hours: 8
actual_hours: 0

# === METADATA ===
tags:
  - ui
  - chart
  - pyqtgraph
effort: large
risk: medium
wave: 3
---

# Spec: E07-F04-T04 - Create ChartPreviewWidget

**Status**: Draft
**Type**: Task
**Parent**: [E07-F04](../E07-F04.spec.md)
**Created**: 2025-12-28
**Updated**: 2025-12-28

## Executive Summary

Create candlestick chart widget using PyQtGraph with volume bars and match point highlighting. Includes MatchDetailsWidget for showing match information.

## Execution Flow

```
1. Create chart layout
   → PyQtGraph GraphicsLayoutWidget
   → Price plot (top, larger)
   → Volume plot (bottom, smaller)
   → Link X axes

2. Create CandlestickItem
   → Custom GraphicsObject
   → Draw body rectangles
   → Draw wick lines
   → Color: green for up, red for down

3. Load and display candles
   → Fetch from ICandleRepository
   → 60 days before, 10 days after match
   → Draw candlesticks
   → Draw volume bars

4. Mark match point
   → Add vertical line at match time
   → Add "Match" annotation
   → Return: SUCCESS with chart

5. Create MatchDetailsWidget
   → Form layout with key-value pairs
   → Update on match selection
```

## User Stories

### Primary User Story
**As a** trader
**I want to** see a chart of the match point
**So that** I can visually validate the signal

## Acceptance Scenarios

### Scenario 1: Display Candlesticks
**Given** a match is selected
**When** show_match() called
**Then** candlestick chart shows surrounding data

### Scenario 2: Candlestick Colors
**Given** candles are displayed
**When** viewing
**Then** up days are green, down days are red

### Scenario 3: Match Marker
**Given** chart is displayed
**When** viewing match point
**Then** vertical line and annotation visible

### Scenario 4: Match Details
**Given** match is selected
**When** details widget updated
**Then** symbol, price, volume shown

## Requirements

### Functional Requirements
- **FR-001**: MUST display candlestick chart
- **FR-002**: MUST display volume bars
- **FR-003**: MUST highlight match point
- **FR-004**: MUST show match details
- **FR-005**: MUST support zoom/pan

### Non-Functional Requirements
- **NFR-001**: Render 70 candles < 100ms
- **NFR-002**: 60 FPS during zoom/pan

### Technical Constraints
- **TC-001**: Use PyQtGraph
- **TC-002**: Custom CandlestickItem

## Key Entities

### Class: ChartPreviewWidget
```python
class ChartPreviewWidget(QWidget):
    match_chart_loaded = Signal()

    def __init__(self, candle_repo: ICandleRepository): ...
    async def show_match(self, match: ScanMatch, formula: Formula = None) -> None
    def clear(self) -> None
```

### Class: CandlestickItem
```python
class CandlestickItem(pg.GraphicsObject):
    def __init__(self, data: list[tuple]): ...
    def paint(self, painter, *args): ...
    def boundingRect(self) -> QRectF: ...
```

### Class: MatchDetailsWidget
```python
class MatchDetailsWidget(QWidget):
    def set_match(self, match: ScanMatch) -> None
    def clear(self) -> None
```

## Dependencies

### Upstream Dependencies
- [ ] E04: ICandleRepository for candle data
- [ ] E07-F04-T01: ScannerView container

### Downstream Impact
- [ ] None - UI component

## Gate Checks

### Pre-Implementation Gates
- [ ] PyQtGraph installed
- [ ] E07-F04-T01 complete

### Quality Gates
- [ ] Candlesticks render correctly
- [ ] Performance verified
- [ ] 80% test coverage

## Success Criteria

### Acceptance Criteria
- [ ] Candlesticks display correctly
- [ ] Colors are correct
- [ ] Match marker visible
- [ ] Zoom/pan works

### Definition of Done
- [ ] Code reviewed
- [ ] Visual testing done
- [ ] Performance verified

## Artifacts

### Input Documents
- [Feature Spec](../E07-F04.spec.md)

### Output Artifacts
- [ ] `src/presentation/views/scanner/chart_preview_widget.py`
- [ ] `src/presentation/views/scanner/match_details_widget.py`

---
*Template Version: 2.0.0*
