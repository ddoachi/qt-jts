---
# ============================================================================
# SPEC METADATA
# ============================================================================

# === IDENTIFICATION ===
id: E07-F04
clickup_task_id: ''
title: UI Components
type: feature

# === HIERARCHY ===
parent: E07
children:
  - E07-F04-T01
  - E07-F04-T02
  - E07-F04-T03
  - E07-F04-T04
  - E07-F04-T05
epic: E07
feature: F04
domain: scanner

# === WORKFLOW ===
status: draft
priority: high

# === TRACKING ===
created: '2025-12-28'
updated: '2025-12-28'
due_date: ''
estimated_hours: 32
actual_hours: 0

# === METADATA ===
tags:
  - ui
  - qt
  - widgets
effort: epic
risk: medium
wave: 3
---

# Spec: E07-F04 - UI Components

**Status**: Draft
**Type**: Feature
**Parent**: [E07](../E07.spec.md)
**Created**: 2025-12-28
**Updated**: 2025-12-28

## Executive Summary

Implement the Qt-based Scanner view and all associated widgets. This includes the main ScannerView with 3-column layout, FormulaLibraryWidget for formula selection, ScanResultsWidget for displaying results, ChartPreviewWidget for candlestick visualization, and FormulaEditorDialog for formula creation/editing.

## Execution Flow

```
1. Initialize ScannerView
   → Create 3-column splitter layout
   → Add placeholder widgets
   → Setup signal connections

2. User selects formula from library
   → FormulaLibraryWidget emits formula_selected
   → ScanConfigWidget receives formula

3. User configures and runs scan
   → ScanConfigWidget emits scan_requested
   → Progress shown in ScanResultsWidget
   → Results displayed on completion

4. User selects result row
   → ScanResultsWidget emits match_selected
   → ChartPreviewWidget loads candle data
   → MatchDetailsWidget shows details

5. Export or continue
   → User can export via menu
   → Or select another formula
```

## User Stories

### Primary User Story
**As a** trader
**I want to** use an intuitive scanner interface
**So that** I can find and analyze market patterns efficiently

### Additional Stories
- **As a** trader, **I want to** preview charts of matches, **So that** I can validate signals visually
- **As a** trader, **I want to** sort and filter results, **So that** I can focus on best matches
- **As a** trader, **I want to** create formulas with syntax highlighting, **So that** I can write correct expressions

## Acceptance Scenarios

### Scenario 1: Complete Scan Workflow
**Given** I have formulas in my library
**When** I select a formula, configure markets, and run scan
**Then** I see results in the table and can click to preview charts

### Scenario 2: Responsive During Scan
**Given** a scan is running
**When** processing 500 symbols
**Then** the UI remains responsive with progress indicator

### Scenario 3: Column Sorting
**Given** scan results are displayed
**When** I click a column header
**Then** results are sorted by that column

### Scenario 4: Formula Editor Validation
**Given** I'm editing a formula expression
**When** I type an invalid expression
**Then** I see validation error immediately

## Requirements

### Functional Requirements
- **FR-001**: ScannerView MUST have 3-column resizable layout
- **FR-002**: FormulaLibraryWidget MUST support search and category filtering
- **FR-003**: ScanResultsWidget MUST support sorting by all columns
- **FR-004**: ChartPreviewWidget MUST display candlestick chart with match marker
- **FR-005**: FormulaEditorDialog MUST validate expressions in real-time
- **FR-006**: UI MUST remain responsive during scan execution

### Non-Functional Requirements
- **NFR-001**: UI Update: < 16ms frame time (60 FPS)
- **NFR-002**: Memory: < 100MB for UI components
- **NFR-003**: Startup: Scanner view loads in < 500ms

### Technical Constraints
- **TC-001**: Must use PySide6/Qt6
- **TC-002**: Must use PyQtGraph for charting
- **TC-003**: Must use async operations for data loading

## Key Entities

### Widget: ScannerView
- **Description**: Main scanner view with 3-column layout
- **Children**: FormulaLibraryWidget, ScanConfigWidget, ScanResultsWidget, ChartPreviewWidget

### Widget: FormulaLibraryWidget
- **Description**: Sidebar with formula selection
- **Signals**: formula_selected, new_formula_requested, edit_formula_requested

### Widget: ScanResultsWidget
- **Description**: Results table with sorting
- **Signals**: match_selected, export_csv_requested, export_excel_requested

### Widget: ChartPreviewWidget
- **Description**: Candlestick chart with PyQtGraph
- **Features**: Candlesticks, volume bars, match marker

### Dialog: FormulaEditorDialog
- **Description**: Modal for formula create/edit
- **Features**: Syntax highlighting, real-time validation

## Dependencies

### Upstream Dependencies
- [ ] E07-F01: Domain Model for data types
- [ ] E07-F02: Scan Execution for running scans
- [ ] E07-F03: Formula Library for formula management
- [ ] E01: Application Framework for Qt base classes

### Downstream Impact
- [ ] None - UI is top of dependency chain

## Gate Checks

### Pre-Implementation Gates
- [ ] F01, F02, F03 complete
- [ ] E01 application framework available
- [ ] PyQtGraph available

### Quality Gates
- [ ] All widgets have UI tests
- [ ] Accessibility verified
- [ ] Performance validated (60 FPS)

## Tasks Preview

### Implementation Tasks
- [ ] T01 Create ScannerView main layout
- [ ] T02 [P] Create FormulaLibraryWidget (after T01)
- [ ] T03 [P] Create ScanResultsWidget (after T01)
- [ ] T04 [P] Create ChartPreviewWidget (after T01)
- [ ] T05 [P] Create FormulaEditorDialog (after T01)

**[P]** = Can be executed in parallel (after T01 foundation)

## Success Criteria

### Acceptance Criteria
- [ ] All widgets render correctly
- [ ] Signals/slots work properly
- [ ] Sorting and filtering functional
- [ ] Chart displays correctly
- [ ] UI remains responsive during scan
- [ ] 80% test coverage

### Definition of Done
- [ ] Code reviewed and approved
- [ ] UI tests passing with pytest-qt
- [ ] Manual testing completed
- [ ] Documentation updated

## Risk Assessment

| Risk | Probability | Impact | Mitigation |
|------|------------|--------|------------|
| PyQtGraph performance | Medium | Medium | Profile and optimize |
| Complex signal wiring | Medium | Low | Clear documentation |
| Memory leaks in widgets | Low | Medium | Use Qt parent-child for cleanup |

## Notes and Clarifications

### UI Layout
```
┌─────────────────────────────────────────────────────────────────────────┐
│ Scanner                                                                  │
├──────────────┬──────────────────────────────────────┬───────────────────┤
│ Formula      │ Configuration                        │ Chart Preview     │
│ Library      │ ├─ Markets                           │                   │
│              │ ├─ Timeframe                         │ [Candlestick]     │
│ [List]       │ └─ [Run Scan]                        │                   │
│              │                                      │ Match Details     │
│ [+New]       │ Results Table                        │ [Details Panel]   │
└──────────────┴──────────────────────────────────────┴───────────────────┘
```

### File Structure
```
src/presentation/views/scanner/
├── scanner_view.py
├── formula_library_widget.py
├── scan_config_widget.py
├── scan_results_widget.py
├── chart_preview_widget.py
├── match_details_widget.py
└── formula_editor_dialog.py
```

## Artifacts

### Input Documents
- [Product Requirements](../../../docs/prd.md)
- [Parent Spec](../E07.spec.md)

### Output Artifacts
- [ ] `E07-F04.context.md` - Implementation context
- [ ] `E07-F04.pre-docs.md` - Pre-implementation documentation
- [ ] `E07-F04.post-docs.md` - Post-implementation learnings

---
*Template Version: 2.0.0*
