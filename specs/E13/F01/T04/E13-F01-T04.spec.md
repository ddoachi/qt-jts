# Spec: E13-F01-T04 - Define PreRequisiteCheck Entity

---
id: E13-F01-T04
clickup_task_id: '86ew0fphj'
title: Define PreRequisiteCheck Entity
type: task
parent: E13-F01
epic: E13
feature: F01
domain: live-trading
status: draft
priority: high
created: '2025-12-30'
updated: '2025-12-30'
estimated_hours: 1
actual_hours: 0
tags: [entity, prerequisites, validation, domain]
effort: small
risk: low
parallel: false
---

**Status**: Draft | **Type**: Task | **Parent**: E13-F01 | **Parallel**: No

## Summary

Define the `PreRequisiteCheck` entity that validates all safety prerequisites before allowing live trading. This includes backtest validation, paper trading history, risk configuration, and broker connectivity checks.

## Implementation Details

### File Location
`src/domain/live_trading/prerequisites.py`

### PreRequisiteCheck Entity

```python
from dataclasses import dataclass
from typing import Optional

@dataclass(frozen=True)
class PreRequisiteCheck:
    """
    Pre-requisites validation for live trading.

    Immutable snapshot of prerequisite check results.
    All prerequisites must pass before live trading can begin.
    """
    strategy_id: int

    # Backtest requirements
    backtest_passed: bool = False
    backtest_sharpe: Optional[float] = None
    backtest_total_trades: Optional[int] = None

    # Paper trading requirements
    paper_trading_passed: bool = False
    paper_trading_days: Optional[int] = None
    paper_trading_pnl: Optional[float] = None

    # Configuration requirements
    risk_parameters_set: bool = False

    # Broker requirements
    broker_connected: bool = False
    account_verified: bool = False
    account_balance: Optional[float] = None

    @property
    def all_passed(self) -> bool:
        """
        Check if all prerequisites are met.

        Returns True only if ALL of:
        - backtest_passed is True
        - paper_trading_passed is True
        - risk_parameters_set is True
        - broker_connected is True
        - account_verified is True
        """
        return all([
            self.backtest_passed,
            self.paper_trading_passed,
            self.risk_parameters_set,
            self.broker_connected,
            self.account_verified
        ])

    @property
    def failed_checks(self) -> list[str]:
        """Return list of failed prerequisite names"""
        failed = []
        if not self.backtest_passed:
            failed.append("backtest")
        if not self.paper_trading_passed:
            failed.append("paper_trading")
        if not self.risk_parameters_set:
            failed.append("risk_parameters")
        if not self.broker_connected:
            failed.append("broker_connection")
        if not self.account_verified:
            failed.append("account_verification")
        return failed

    @property
    def summary(self) -> str:
        """Human-readable summary of check results"""
        if self.all_passed:
            return "All prerequisites passed"

        failed = self.failed_checks
        return f"Failed prerequisites: {', '.join(failed)}"


class PreRequisiteNotMetError(Exception):
    """Raised when live trading prerequisites are not met"""

    def __init__(self, check: PreRequisiteCheck):
        self.check = check
        super().__init__(
            f"Live trading prerequisites not met: {check.summary}"
        )
```

## Acceptance Criteria

- [ ] PreRequisiteCheck dataclass is frozen (immutable)
- [ ] all_passed property checks all 5 prerequisites
- [ ] failed_checks property returns list of failures
- [ ] summary property provides human-readable message
- [ ] PreRequisiteNotMetError exception defined
- [ ] Optional fields for diagnostic info (sharpe, pnl, etc.)
- [ ] Unit tests for all scenarios

## Dependencies

- **Upstream**: E13-F01-T01 (enums)
- **Downstream**: E13-F02-T02 (prerequisite checking)

## Testing

```python
def test_all_passed_true():
    check = PreRequisiteCheck(
        strategy_id=1,
        backtest_passed=True,
        paper_trading_passed=True,
        risk_parameters_set=True,
        broker_connected=True,
        account_verified=True
    )
    assert check.all_passed == True
    assert len(check.failed_checks) == 0

def test_all_passed_false():
    check = PreRequisiteCheck(
        strategy_id=1,
        backtest_passed=True,
        paper_trading_passed=False,  # Failed
        risk_parameters_set=True,
        broker_connected=True,
        account_verified=True
    )
    assert check.all_passed == False
    assert "paper_trading" in check.failed_checks

def test_prerequisite_not_met_error():
    check = PreRequisiteCheck(strategy_id=1, backtest_passed=False)
    with pytest.raises(PreRequisiteNotMetError) as exc_info:
        raise PreRequisiteNotMetError(check)
    assert "backtest" in str(exc_info.value)
```

---
*Estimated: 1 hour | Risk: Low*
