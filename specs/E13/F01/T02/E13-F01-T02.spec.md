# Spec: E13-F01-T02 - Define RiskControls Dataclass

---
id: E13-F01-T02
clickup_task_id: '86ew0fph2'
title: Define RiskControls Dataclass
type: task
parent: E13-F01
epic: E13
feature: F01
domain: live-trading
status: draft
priority: high
created: '2025-12-30'
updated: '2025-12-30'
estimated_hours: 2
actual_hours: 0
tags: [dataclass, risk-controls, domain]
effort: small
risk: low
parallel: true
---

**Status**: Draft | **Type**: Task | **Parent**: E13-F01 | **Parallel**: Yes [P]

## Summary

Define the `RiskControls` dataclass that encapsulates all risk management configuration for a live trading session. This includes position limits, daily loss limits, and trading hours restrictions.

## Implementation Details

### File Location
`src/domain/live_trading/risk_controls.py`

### RiskControls Dataclass

```python
from dataclasses import dataclass, field
from datetime import time
from decimal import Decimal
from typing import Optional

@dataclass(frozen=True)
class RiskControls:
    """
    Risk control configuration for live trading.

    Immutable to prevent accidental modification during trading.
    All percentage values are expressed as floats (e.g., 10.0 = 10%).
    """

    # Position size limits
    max_position_size_pct: float = 10.0  # Max % of portfolio per trade
    max_positions: int = 5  # Max concurrent positions

    # Loss limits
    max_daily_loss_pct: float = 5.0  # Stop trading if reached
    max_daily_loss_amount: Optional[Decimal] = None  # Absolute limit (optional)

    # Trading hours (KRX default: 09:00 - 15:30)
    trading_hours_start: Optional[time] = field(default_factory=lambda: time(9, 0))
    trading_hours_end: Optional[time] = field(default_factory=lambda: time(15, 30))

    # Prerequisites thresholds
    require_backtest_sharpe: Optional[float] = 1.0
    require_paper_trading_days: Optional[int] = 5

    def __post_init__(self):
        """Validate risk control values"""
        if self.max_position_size_pct <= 0 or self.max_position_size_pct > 100:
            raise ValueError("max_position_size_pct must be between 0 and 100")
        if self.max_positions <= 0:
            raise ValueError("max_positions must be positive")
        if self.max_daily_loss_pct <= 0 or self.max_daily_loss_pct > 100:
            raise ValueError("max_daily_loss_pct must be between 0 and 100")

    def is_within_trading_hours(self, current_time: time) -> bool:
        """Check if current time is within trading hours"""
        if not self.trading_hours_start or not self.trading_hours_end:
            return True
        return self.trading_hours_start <= current_time <= self.trading_hours_end
```

## Acceptance Criteria

- [ ] RiskControls dataclass is frozen (immutable)
- [ ] Sensible defaults for all fields
- [ ] __post_init__ validation for invalid values
- [ ] is_within_trading_hours helper method
- [ ] All percentage values documented as percentages
- [ ] Comprehensive unit tests

## Dependencies

- **Upstream**: None (foundational)
- **Downstream**: E13-F01-T03, E13-F02 (Live Trading Engine)

## Testing

```python
def test_risk_controls_defaults():
    rc = RiskControls()
    assert rc.max_position_size_pct == 10.0
    assert rc.max_positions == 5
    assert rc.trading_hours_start == time(9, 0)

def test_risk_controls_validation():
    with pytest.raises(ValueError):
        RiskControls(max_position_size_pct=-5)
    with pytest.raises(ValueError):
        RiskControls(max_positions=0)

def test_trading_hours_check():
    rc = RiskControls()
    assert rc.is_within_trading_hours(time(10, 0)) == True
    assert rc.is_within_trading_hours(time(16, 0)) == False
```

---
*Estimated: 2 hours | Risk: Low*
