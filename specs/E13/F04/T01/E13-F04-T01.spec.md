# Spec: E13-F04-T01 - Create LiveTradingSetupView Layout

---
id: E13-F04-T01
clickup_task_id: '86ew0fpkc'
title: Create LiveTradingSetupView Layout
type: task
parent: E13-F04
epic: E13
feature: F04
domain: live-trading
status: draft
priority: high
created: '2025-12-30'
updated: '2025-12-30'
estimated_hours: 3
actual_hours: 0
tags: [ui, setup-view, pyside6]
effort: medium
risk: low
parallel: true
---

**Status**: Draft | **Type**: Task | **Parent**: E13-F04 | **Parallel**: Yes [P]

## Summary

Create the main layout for `LiveTradingSetupView`, the setup wizard for starting live trading. This includes the header with strategy info, account selection area, prerequisites checklist, and action buttons.

## Implementation Details

### File Location
`src/presentation/live_trading/setup_view.py`

### LiveTradingSetupView Implementation

```python
from PySide6.QtWidgets import (
    QWidget, QVBoxLayout, QHBoxLayout, QLabel,
    QPushButton, QGroupBox, QFrame
)
from PySide6.QtCore import Signal

class LiveTradingSetupView(QWidget):
    """
    Setup wizard for starting live trading.

    Layout:
    ┌─────────────────────────────────────────────┐
    │ Live Trading Setup                          │
    │ Strategy: [Strategy Name]                   │
    ├─────────────────────────────────────────────┤
    │ Select Broker & Account:                    │
    │ ┌─────────────────────────────────────────┐ │
    │ │ AccountSelectionWidget                  │ │
    │ └─────────────────────────────────────────┘ │
    │                                             │
    │ Prerequisites:                              │
    │ ┌─────────────────────────────────────────┐ │
    │ │ PreRequisiteWidget                      │ │
    │ └─────────────────────────────────────────┘ │
    │                                             │
    │                    [Cancel] [▶ 실전 매매 시작] │
    └─────────────────────────────────────────────┘
    """

    # Signals
    start_trading_requested = Signal(object)  # Emits config
    cancelled = Signal()

    def __init__(
        self,
        session_manager: LiveTradingSessionManager,
        strategy: Strategy,
        parent=None
    ):
        super().__init__(parent)
        self._session_manager = session_manager
        self._strategy = strategy

        self._setup_ui()
        self._connect_signals()
        self._load_prerequisites()

    def _setup_ui(self):
        """Set up the UI layout"""
        layout = QVBoxLayout(self)
        layout.setSpacing(16)

        # Header
        header = self._create_header()
        layout.addWidget(header)

        # Account selection group
        account_group = QGroupBox("Select Broker & Account")
        account_layout = QVBoxLayout(account_group)
        self._account_widget = AccountSelectionWidget(
            broker_registry=self._session_manager._broker_registry
        )
        account_layout.addWidget(self._account_widget)
        layout.addWidget(account_group)

        # Prerequisites group
        prereq_group = QGroupBox("Prerequisites")
        prereq_layout = QVBoxLayout(prereq_group)
        self._prereq_widget = PreRequisiteWidget()
        prereq_layout.addWidget(self._prereq_widget)
        layout.addWidget(prereq_group)

        # Spacer
        layout.addStretch()

        # Action buttons
        button_layout = QHBoxLayout()
        button_layout.addStretch()

        self._cancel_btn = QPushButton("Cancel")
        self._cancel_btn.clicked.connect(self.cancelled.emit)
        button_layout.addWidget(self._cancel_btn)

        self._start_btn = QPushButton("▶ 실전 매매 시작")
        self._start_btn.setEnabled(False)
        self._start_btn.setStyleSheet("""
            QPushButton {
                background-color: #c0392b;
                color: white;
                font-weight: bold;
                padding: 10px 20px;
                border-radius: 4px;
            }
            QPushButton:disabled {
                background-color: #7f8c8d;
            }
            QPushButton:hover:!disabled {
                background-color: #e74c3c;
            }
        """)
        self._start_btn.clicked.connect(self._on_start_clicked)
        button_layout.addWidget(self._start_btn)

        layout.addLayout(button_layout)

    def _create_header(self) -> QFrame:
        """Create header section with strategy info"""
        header = QFrame()
        header.setStyleSheet("""
            QFrame {
                background-color: #2c3e50;
                border-radius: 4px;
                padding: 8px;
            }
            QLabel {
                color: white;
            }
        """)

        layout = QVBoxLayout(header)

        title = QLabel("Live Trading Setup")
        title.setStyleSheet("font-size: 18px; font-weight: bold;")
        layout.addWidget(title)

        strategy_label = QLabel(f"Strategy: {self._strategy.name}")
        strategy_label.setStyleSheet("font-size: 14px;")
        layout.addWidget(strategy_label)

        return header

    def _connect_signals(self):
        """Connect widget signals"""
        self._account_widget.selection_changed.connect(self._update_start_button)
        self._prereq_widget.status_changed.connect(self._update_start_button)

    async def _load_prerequisites(self):
        """Load prerequisite check results"""
        check = await self._session_manager.check_prerequisites(self._strategy)
        self._prereq_widget.set_check(check)
        self._update_start_button()

    def _update_start_button(self):
        """Update start button enabled state"""
        has_account = self._account_widget.has_selection()
        prereqs_passed = self._prereq_widget.all_passed()
        self._start_btn.setEnabled(has_account and prereqs_passed)

    def _on_start_clicked(self):
        """Handle start button click"""
        config = LiveSessionConfig(
            strategy=self._strategy,
            broker_id=self._account_widget.selected_broker_id,
            account_id=self._account_widget.selected_account_id,
            symbols=self._strategy.symbols,
            risk_controls=self._strategy.risk_config or RiskControls(),
            execution_mode=ExecutionMode.MANUAL
        )
        self.start_trading_requested.emit(config)
```

## Acceptance Criteria

- [ ] LiveTradingSetupView layout matches wireframe
- [ ] Header shows strategy name
- [ ] Account selection area with AccountSelectionWidget
- [ ] Prerequisites area with PreRequisiteWidget
- [ ] Cancel button emits cancelled signal
- [ ] Start button styled with red background (live trading indicator)
- [ ] Start button disabled until prerequisites pass and account selected
- [ ] start_trading_requested signal emits config
- [ ] Korean text displays correctly

## Dependencies

- **Upstream**: E13-F02 (SessionManager), E13-F04-T02, E13-F04-T03
- **Downstream**: E13-F04-T04 (navigates to dashboard)

## Testing

```python
def test_setup_view_start_disabled_initially(qtbot):
    view = create_setup_view()
    assert view._start_btn.isEnabled() == False

def test_setup_view_start_enabled_when_ready(qtbot):
    view = create_setup_view()
    view._prereq_widget.set_check(all_passed_check)
    view._account_widget.select_account("broker1", "account1")
    assert view._start_btn.isEnabled() == True

def test_setup_view_emits_config(qtbot):
    view = create_setup_view(prereqs_passed=True, account_selected=True)
    with qtbot.waitSignal(view.start_trading_requested) as blocker:
        view._start_btn.click()
    assert blocker.args[0].strategy == view._strategy
```

---
*Estimated: 3 hours | Risk: Low*
