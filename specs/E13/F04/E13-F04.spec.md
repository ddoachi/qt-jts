# Spec: E13-F04 - Live Trading UI Components

---
# ============================================================================
# SPEC METADATA
# ============================================================================

# === IDENTIFICATION ===
id: E13-F04
clickup_task_id: ''    # REQUIRED - Empty string if not yet created in ClickUp
title: Live Trading UI Components
type: feature

# === HIERARCHY ===
parent: E13
children: [E13-F04-T01, E13-F04-T02, E13-F04-T03, E13-F04-T04, E13-F04-T05, E13-F04-T06]
epic: E13
feature: F04
domain: live-trading

# === WORKFLOW ===
status: draft
priority: high

# === TRACKING ===
created: '2025-12-30'
updated: '2025-12-30'
due_date: ''
estimated_hours: 16
actual_hours: 0

# === METADATA ===
tags: [ui, pyside6, dashboard, order-confirmation, account-selection]
effort: large
risk: medium
---

**Status**: Draft
**Type**: Feature
**Parent**: E13 (Live Trading)
**Created**: 2025-12-30
**Updated**: 2025-12-30

## Executive Summary

Implement the user interface components for live trading, including the setup view for broker/account selection, the live trading dashboard for monitoring positions and orders, the order confirmation dialog for manual approval, and supporting widgets. These components provide traders with a safe, intuitive interface for managing real-money trading operations with clear visual feedback and multiple confirmation steps.

## Execution Flow

```
1. LiveTradingSetupView initialization
   -> Load available brokers from registry
   -> Display account list with balances
   -> Show rate limit status per broker
   -> Display prerequisites checklist
   -> Enable/disable start button based on prerequisites

2. Account selection flow
   -> User selects broker from list
   -> Load accounts for selected broker
   -> Display account details (balance, type)
   -> Update prerequisites based on selection
   -> If all prerequisites pass: Enable start button

3. Start live trading
   -> User clicks "Start Trading" button
   -> Display confirmation dialog with warnings
   -> If user confirms: Call SessionManager.start_session()
   -> Navigate to LiveTradingDashboard
   -> If error: Display error dialog with details

4. LiveTradingDashboard updates
   -> Subscribe to session signals
   -> Update account summary (balance, P&L)
   -> Update positions table (price, P&L per position)
   -> Update pending signals list
   -> Update order history table
   -> Refresh rate limit indicator

5. Order confirmation dialog (MANUAL mode)
   -> Signal received from engine
   -> Display order details (symbol, quantity, price, total)
   -> Show portfolio impact (position %, risk check)
   -> Display warning for large orders (> 10% portfolio)
   -> User clicks Confirm or Cancel
   -> If confirmed: Execute order
   -> If cancelled: Log cancellation

6. Position close from UI
   -> User clicks "Close" on position row
   -> Display confirmation dialog
   -> If confirmed: Generate SELL signal for full quantity
   -> Execute close order
   -> Update positions table
```

## User Stories

### Primary User Story
**As a** trader
**I want to** see a clear dashboard with all my live trading information
**So that** I can monitor and manage my positions effectively

### Additional Stories
- **As a** trader, **I want to** select which broker account to use for trading, **So that** I can choose between paper and live accounts
- **As a** trader, **I want to** see a prerequisites checklist before starting, **So that** I'm confident the strategy is ready
- **As a** trader, **I want to** confirm each order before execution (in MANUAL mode), **So that** I have final control over every trade
- **As a** trader, **I want to** see real-time P&L on my positions, **So that** I can make informed decisions about exits
- **As a** trader, **I want to** see order history with status, **So that** I can review what trades were executed

## Acceptance Scenarios

### Scenario 1: Account Selection with Prerequisites
**Given** the LiveTradingSetupView is displayed
**And** the strategy has passed backtesting and paper trading
**When** the user selects a connected broker account
**Then** all prerequisites should show green checkmarks
**And** the "Start Trading" button should be enabled
**And** account balance should be displayed

### Scenario 2: Prerequisites Not Met
**Given** the LiveTradingSetupView is displayed
**And** the strategy has NOT completed paper trading
**When** the user views prerequisites
**Then** paper trading checkbox should show red X
**And** "Start Trading" button should be disabled
**And** tooltip should explain what's missing

### Scenario 3: Order Confirmation Dialog
**Given** a live trading session in MANUAL mode
**When** an entry signal is generated
**Then** OrderConfirmationDialog should appear
**And** it should show symbol, quantity, price, total value
**And** it should show warning if order > 10% of balance
**And** Confirm and Cancel buttons should be visible

### Scenario 4: Dashboard Position Updates
**Given** an active live trading session with 3 positions
**When** market prices update
**Then** current prices should refresh in positions table
**And** unrealized P&L should recalculate
**And** P&L percentage should update with color coding (green/red)

### Scenario 5: Order History Display
**Given** an active session with completed orders
**When** viewing the order history section
**Then** orders should be sorted by time (newest first)
**And** each order should show: time, symbol, side, quantity, price, status
**And** filled orders should show checkmark
**And** rejected orders should show X with error tooltip

### Scenario 6: Close Position from UI
**Given** an open position of 100 shares of 005930
**When** user clicks the "Close" button
**Then** confirmation dialog should appear
**And** dialog should show expected proceeds
**And** if confirmed, SELL order should be placed
**And** position should be removed after fill

## Requirements

### Functional Requirements
- **FR-001**: System MUST provide broker/account selection UI
- **FR-002**: System MUST display prerequisites checklist with pass/fail status
- **FR-003**: System MUST show rate limit status per broker
- **FR-004**: System MUST provide order confirmation dialog for MANUAL mode
- **FR-005**: System MUST display live trading dashboard with positions, orders, signals
- **FR-006**: System MUST update positions with real-time prices
- **FR-007**: System MUST display P&L with color coding (green=profit, red=loss)
- **FR-008**: System MUST provide UI to close positions
- **FR-009**: System MUST display order history with status

### Non-Functional Requirements
- **NFR-001**: UI updates MUST reflect within 1 second of data change
- **NFR-002**: Dashboard MUST remain responsive during updates
- **NFR-003**: Large orders (> 10% portfolio) MUST show visual warning
- **NFR-004**: Live trading UI MUST be visually distinct from paper trading
- **NFR-005**: All monetary values MUST be formatted with thousands separator

### Technical Constraints
- **TC-001**: Must use PySide6 for all UI components
- **TC-002**: Must use Qt Signal/Slot for event handling
- **TC-003**: Must use Model-View pattern for tables
- **TC-004**: Must integrate with existing theme system
- **TC-005**: Must support Korean language display (종목명, 원 currency)

## Key Entities

### Entity: LiveTradingSetupView
- **Description**: Setup wizard for starting live trading
- **Key Attributes**: Broker selector, account list, prerequisites, start button
- **Relationships**: Uses SessionManager to start session

### Entity: LiveTradingDashboard
- **Description**: Main dashboard for active live trading
- **Key Attributes**: Account summary, positions table, signals list, order history
- **Relationships**: Subscribes to session signals, displays data from entities

### Entity: OrderConfirmationDialog
- **Description**: Modal dialog for order confirmation
- **Key Attributes**: Order details, portfolio impact, warning label, buttons
- **Relationships**: Triggered by signals, returns user decision

### Entity: AccountSelectionWidget
- **Description**: Widget for broker/account selection
- **Key Attributes**: Broker list, account list, balance display, rate limit indicator
- **Relationships**: Part of LiveTradingSetupView

### Entity: PreRequisiteWidget
- **Description**: Checklist showing prerequisites status
- **Key Attributes**: Checklist items with icons (pass/fail)
- **Relationships**: Part of LiveTradingSetupView

### Entity: OrderHistoryWidget
- **Description**: Table showing order history
- **Key Attributes**: Order list with status, time, symbol, price
- **Relationships**: Part of LiveTradingDashboard

## Dependencies

### Upstream Dependencies
- [ ] E13-F01: Domain Models (for data display)
- [ ] E13-F02: Live Trading Engine (signals, session)
- [ ] E13-F03: Order Execution (order status updates)
- [ ] E01: Application Framework (MainWindow, navigation)
- [ ] E03: Broker Integration (account info, rate limits)

### Downstream Impact
- [ ] None - UI is the final layer

## Gate Checks

### Pre-Implementation Gates
- [x] No [NEEDS CLARIFICATION] markers remain
- [x] Performance requirements specified (< 1s UI updates)
- [x] Security requirements defined (no credentials displayed)
- [x] Scale requirements clear (< 20 positions, < 100 orders displayed)
- [x] PRD compliance verified (Section 5.8, wireframes)

### Quality Gates
- [ ] Complexity justified (optimal granularity per auto-split analysis)
- [ ] All requirements testable
- [ ] Dependencies identified and documented
- [ ] Risk assessment complete

## Tasks Preview

### Implementation Tasks
- [ ] T01 [P] Create LiveTradingSetupView layout
- [ ] T02 [P] Create AccountSelectionWidget with broker/account list
- [ ] T03 [P] Create PreRequisiteWidget with checklist
- [ ] T04 Create LiveTradingDashboard with sections (depends on F02, F03)
- [ ] T05 [P] Create OrderConfirmationDialog
- [ ] T06 Create OrderHistoryWidget with table model (depends on T04)

**[P]** = Can be executed in parallel

## Success Criteria

### Acceptance Criteria
- [ ] Setup view displays broker/account selection
- [ ] Prerequisites checklist shows pass/fail correctly
- [ ] Rate limit status is visible
- [ ] Start button enabled only when prerequisites pass
- [ ] Order confirmation dialog appears in MANUAL mode
- [ ] Large order warnings are displayed
- [ ] Dashboard shows positions with real-time prices
- [ ] Dashboard shows pending signals
- [ ] Dashboard shows order history with status
- [ ] P&L is color coded (green/red)
- [ ] Close position from UI works correctly
- [ ] UI is visually distinct from paper trading
- [ ] Korean text displays correctly

### Definition of Done
- [ ] Code reviewed and approved
- [ ] Tests passing (unit, UI tests)
  - [ ] Unit tests for widget logic
  - [ ] UI tests for user interactions
  - [ ] Integration tests with mock data
- [ ] Documentation updated (pre-docs, post-docs)
- [ ] 80% test coverage achieved
- [ ] Cross-platform appearance verified
- [ ] Korean language display verified

## Risk Assessment

| Risk | Probability | Impact | Mitigation |
|------|------------|--------|------------|
| UI freezes during updates | Medium | High | Use background threads, async updates |
| User clicks confirm accidentally | Low | High | Require explicit confirmation, show warnings |
| Incorrect P&L display | Low | High | Thorough testing, Decimal precision |
| Platform-specific rendering issues | Medium | Medium | Test on all platforms, use Qt-native widgets |
| Korean text truncation | Low | Low | Test with Korean content, allow text wrapping |

## Notes and Clarifications

### Open Questions
None - UI requirements clear from PRD wireframes

### Decisions Made
- 2025-12-30: Use red for live trading to distinguish from paper trading
- 2025-12-30: Large order threshold is 10% of portfolio value
- 2025-12-30: Order history limited to last 100 orders for performance
- 2025-12-30: Korean currency format: ₩1,234,567
- 2025-12-30: Use QTableView with custom model for positions and orders

### Research Needed
- Qt table performance with frequent updates
- Best practices for real-time financial UI

## Artifacts

### Input Documents
- [Product Requirements Document](../../../docs/product-requirements-document.md) (Section 5.8, wireframes)
- [Parent Spec](../E13.spec.md) (Epic E13)

### Output Artifacts (to be generated)
- [ ] `E13-F04.context.md` - Implementation context and progress
- [ ] `E13-F04.pre-docs.md` - Pre-implementation documentation
- [ ] `E13-F04.post-docs.md` - Post-implementation learnings
- [ ] Unit tests: `tests/unit/presentation/test_live_trading_ui.py`
- [ ] UI tests: `tests/ui/test_live_trading_views.py`

---
*Template Version: 2.0.0 - Enhanced with Speckit features*
