# Spec: E13-F04-T05 - Create OrderConfirmationDialog

---
id: E13-F04-T05
clickup_task_id: '86ew0fpkt'
title: Create OrderConfirmationDialog
type: task
parent: E13-F04
epic: E13
feature: F04
domain: live-trading
status: draft
priority: high
created: '2025-12-30'
updated: '2025-12-30'
estimated_hours: 2
actual_hours: 0
tags: [ui, dialog, confirmation, pyside6]
effort: small
risk: low
parallel: true
---

**Status**: Draft | **Type**: Task | **Parent**: E13-F04 | **Parallel**: Yes [P]

## Summary

Create the `OrderConfirmationDialog` that displays order details and requires user confirmation before execution in MANUAL mode. Includes warnings for large orders.

## Implementation Details

### File Location
`src/presentation/live_trading/dialogs/order_confirmation.py`

### OrderConfirmationDialog Implementation

```python
from PySide6.QtWidgets import (
    QDialog, QVBoxLayout, QFormLayout, QLabel,
    QPushButton, QGroupBox, QDialogButtonBox
)
from decimal import Decimal

class OrderConfirmationDialog(QDialog):
    """
    Confirm order before execution.

    Layout:
    ┌─────────────────────────────────────────────┐
    │ Order Confirmation                          │
    ├─────────────────────────────────────────────┤
    │ Order Details                               │
    │ ┌─────────────────────────────────────────┐ │
    │ │ Symbol:     005930 삼성전자              │ │
    │ │ Direction:  BUY                         │ │
    │ │ Quantity:   100                         │ │
    │ │ Price:      ₩72,000                     │ │
    │ │ Total:      ₩7,200,000                  │ │
    │ └─────────────────────────────────────────┘ │
    │                                             │
    │ ⚠️ This order is more than 10% of balance  │
    │                                             │
    │              [Cancel] [Confirm Order]       │
    └─────────────────────────────────────────────┘
    """

    def __init__(
        self,
        signal: TradingSignal,
        account_balance: Decimal,
        parent=None
    ):
        super().__init__(parent)
        self._signal = signal
        self._balance = account_balance

        self.setWindowTitle("Order Confirmation")
        self.setModal(True)
        self.setMinimumWidth(400)

        self._setup_ui()

    def _setup_ui(self):
        """Set up the dialog UI"""
        layout = QVBoxLayout(self)
        layout.setSpacing(16)

        # Order details group
        details_group = QGroupBox("Order Details")
        details_layout = QFormLayout(details_group)

        # Symbol
        symbol_label = QLabel(f"{self._signal.symbol} {self._signal.symbol_name}")
        symbol_label.setStyleSheet("font-weight: bold;")
        details_layout.addRow("Symbol:", symbol_label)

        # Direction
        direction = self._signal.direction.value.upper()
        direction_label = QLabel(direction)
        direction_color = "#27ae60" if direction == "BUY" else "#c0392b"
        direction_label.setStyleSheet(f"color: {direction_color}; font-weight: bold;")
        details_layout.addRow("Direction:", direction_label)

        # Quantity
        details_layout.addRow("Quantity:", QLabel(f"{self._signal.quantity:,}"))

        # Price
        details_layout.addRow("Price:", QLabel(f"₩{self._signal.price:,.0f}"))

        # Total value
        total_value = self._signal.price * self._signal.quantity
        total_label = QLabel(f"₩{total_value:,.0f}")
        total_label.setStyleSheet("font-weight: bold; font-size: 14px;")
        details_layout.addRow("Total Value:", total_label)

        layout.addWidget(details_group)

        # Warning for large orders
        if self._is_large_order():
            warning = QLabel("⚠️ This order is more than 10% of your balance")
            warning.setStyleSheet("""
                QLabel {
                    color: #e67e22;
                    font-weight: bold;
                    padding: 8px;
                    background-color: #fdf3e7;
                    border-radius: 4px;
                }
            """)
            layout.addWidget(warning)

        # Buttons
        buttons = QDialogButtonBox()

        self._confirm_btn = QPushButton("Confirm Order")
        self._confirm_btn.setStyleSheet("""
            QPushButton {
                background-color: #27ae60;
                color: white;
                padding: 10px 20px;
                border-radius: 4px;
                font-weight: bold;
            }
            QPushButton:hover {
                background-color: #2ecc71;
            }
        """)
        self._confirm_btn.clicked.connect(self.accept)
        buttons.addButton(self._confirm_btn, QDialogButtonBox.AcceptRole)

        self._cancel_btn = QPushButton("Cancel")
        self._cancel_btn.setStyleSheet("""
            QPushButton {
                padding: 10px 20px;
                border-radius: 4px;
            }
        """)
        self._cancel_btn.clicked.connect(self.reject)
        buttons.addButton(self._cancel_btn, QDialogButtonBox.RejectRole)

        layout.addWidget(buttons)

    def _is_large_order(self) -> bool:
        """Check if order exceeds 10% of balance"""
        if self._balance <= 0:
            return False

        total_value = self._signal.price * self._signal.quantity
        return total_value > self._balance * Decimal("0.1")

    @property
    def signal(self) -> TradingSignal:
        return self._signal


def confirm_order(
    signal: TradingSignal,
    account_balance: Decimal,
    parent=None
) -> bool:
    """
    Show order confirmation dialog and return user decision.

    Returns True if user confirmed, False if cancelled.
    """
    dialog = OrderConfirmationDialog(signal, account_balance, parent)
    result = dialog.exec()
    return result == QDialog.Accepted
```

## Acceptance Criteria

- [ ] Dialog shows all order details (symbol, direction, quantity, price, total)
- [ ] BUY direction shown in green
- [ ] SELL direction shown in red
- [ ] Total value formatted with currency symbol
- [ ] Warning shown for orders > 10% of balance
- [ ] Confirm button is green
- [ ] Cancel button closes dialog with rejection
- [ ] Confirm button closes dialog with acceptance
- [ ] Dialog is modal
- [ ] Korean text displays correctly

## Dependencies

- **Upstream**: E13-F01 (TradingSignal entity)
- **Downstream**: Used by Dashboard when signal received in MANUAL mode

## Testing

```python
def test_confirmation_dialog_shows_details(qtbot):
    signal = create_signal(symbol="005930", quantity=100, price=72000)
    dialog = OrderConfirmationDialog(signal, Decimal(50000000))
    assert "005930" in dialog._signal.symbol
    assert "7,200,000" in dialog.findChild(QLabel).text()  # Total

def test_confirmation_dialog_shows_warning(qtbot):
    signal = create_signal(price=10000000, quantity=1)  # > 10%
    dialog = OrderConfirmationDialog(signal, Decimal(50000000))
    assert dialog._is_large_order() == True

def test_confirm_order_returns_true(qtbot):
    signal = create_signal()
    with qtbot.waitCallback() as callback:
        # Simulate user clicking confirm
        result = confirm_order(signal, Decimal(50000000))
    assert result == True
```

---
*Estimated: 2 hours | Risk: Low*
