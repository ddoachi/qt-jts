# Spec: E13-F04-T03 - Create PreRequisiteWidget

---
id: E13-F04-T03
clickup_task_id: '86ew0fpkj'
title: Create PreRequisiteWidget
type: task
parent: E13-F04
epic: E13
feature: F04
domain: live-trading
status: draft
priority: high
created: '2025-12-30'
updated: '2025-12-30'
estimated_hours: 2
actual_hours: 0
tags: [ui, prerequisites, checklist, pyside6]
effort: small
risk: low
parallel: true
---

**Status**: Draft | **Type**: Task | **Parent**: E13-F04 | **Parallel**: Yes [P]

## Summary

Create the `PreRequisiteWidget` that displays a checklist of prerequisites for live trading with pass/fail icons and detailed information on hover.

## Implementation Details

### File Location
`src/presentation/live_trading/widgets/prerequisite_widget.py`

### PreRequisiteWidget Implementation

```python
from PySide6.QtWidgets import (
    QWidget, QVBoxLayout, QHBoxLayout, QLabel
)
from PySide6.QtCore import Signal

class PreRequisiteWidget(QWidget):
    """
    Checklist showing prerequisites status.

    Layout:
    ├─ [✓] Strategy backtested (Sharpe: 1.85)
    ├─ [✓] Paper trading (7 days)
    ├─ [✓] Risk parameters configured
    └─ [✓] Broker connected
    """

    status_changed = Signal()

    def __init__(self, parent=None):
        super().__init__(parent)
        self._check: PreRequisiteCheck = None
        self._items: list[PreRequisiteItem] = []
        self._setup_ui()

    def _setup_ui(self):
        """Set up the UI layout"""
        layout = QVBoxLayout(self)
        layout.setContentsMargins(0, 0, 0, 0)
        layout.setSpacing(8)

        # Create check items
        self._backtest_item = PreRequisiteItem("Strategy backtested")
        layout.addWidget(self._backtest_item)
        self._items.append(self._backtest_item)

        self._paper_trading_item = PreRequisiteItem("Paper trading")
        layout.addWidget(self._paper_trading_item)
        self._items.append(self._paper_trading_item)

        self._risk_item = PreRequisiteItem("Risk parameters configured")
        layout.addWidget(self._risk_item)
        self._items.append(self._risk_item)

        self._broker_item = PreRequisiteItem("Broker connected")
        layout.addWidget(self._broker_item)
        self._items.append(self._broker_item)

    def set_check(self, check: PreRequisiteCheck):
        """Update with prerequisite check results"""
        self._check = check

        # Update backtest item
        if check.backtest_passed:
            detail = f"Sharpe: {check.backtest_sharpe:.2f}" if check.backtest_sharpe else ""
            self._backtest_item.set_passed(detail)
        else:
            reason = "No backtest found" if not check.backtest_sharpe else f"Sharpe {check.backtest_sharpe:.2f} < 1.0"
            self._backtest_item.set_failed(reason)

        # Update paper trading item
        if check.paper_trading_passed:
            self._paper_trading_item.set_passed(f"{check.paper_trading_days} days")
        else:
            days = check.paper_trading_days or 0
            self._paper_trading_item.set_failed(f"{days}/5 days required")

        # Update risk parameters item
        if check.risk_parameters_set:
            self._risk_item.set_passed()
        else:
            self._risk_item.set_failed("Not configured")

        # Update broker item
        if check.broker_connected and check.account_verified:
            balance = f"₩{check.account_balance:,.0f}" if check.account_balance else ""
            self._broker_item.set_passed(balance)
        else:
            self._broker_item.set_failed("Not connected")

        self.status_changed.emit()

    def all_passed(self) -> bool:
        """Check if all prerequisites are passed"""
        return self._check.all_passed if self._check else False


class PreRequisiteItem(QWidget):
    """Single prerequisite item with icon and text"""

    def __init__(self, text: str, parent=None):
        super().__init__(parent)
        self._text = text
        self._setup_ui()

    def _setup_ui(self):
        layout = QHBoxLayout(self)
        layout.setContentsMargins(0, 0, 0, 0)
        layout.setSpacing(8)

        # Icon (├─ prefix)
        self._prefix = QLabel("├─")
        self._prefix.setStyleSheet("font-family: monospace;")
        layout.addWidget(self._prefix)

        # Status icon
        self._icon = QLabel("[ ]")
        self._icon.setFixedWidth(24)
        layout.addWidget(self._icon)

        # Text
        self._label = QLabel(self._text)
        layout.addWidget(self._label)

        # Detail (optional)
        self._detail = QLabel()
        self._detail.setStyleSheet("color: #7f8c8d;")
        layout.addWidget(self._detail)

        layout.addStretch()

    def set_passed(self, detail: str = ""):
        """Mark as passed"""
        self._icon.setText("[✓]")
        self._icon.setStyleSheet("color: #27ae60; font-weight: bold;")
        self._label.setStyleSheet("color: #27ae60;")
        self._detail.setText(f"({detail})" if detail else "")

    def set_failed(self, reason: str = ""):
        """Mark as failed"""
        self._icon.setText("[✗]")
        self._icon.setStyleSheet("color: #c0392b; font-weight: bold;")
        self._label.setStyleSheet("color: #c0392b;")
        self._detail.setText(f"({reason})" if reason else "")
        self._detail.setStyleSheet("color: #c0392b;")
        self.setToolTip(reason)

    def set_pending(self):
        """Mark as pending/checking"""
        self._icon.setText("[○]")
        self._icon.setStyleSheet("color: #7f8c8d;")
        self._label.setStyleSheet("color: #7f8c8d;")
        self._detail.setText("(checking...)")
```

## Acceptance Criteria

- [ ] Shows 4 prerequisite items in checklist format
- [ ] Pass items show green checkmark [✓]
- [ ] Failed items show red X [✗]
- [ ] Detail text shows relevant info (Sharpe ratio, days, balance)
- [ ] Failed items show reason in parentheses
- [ ] Tooltip shows full reason on hover for failed items
- [ ] status_changed signal emitted when updated
- [ ] all_passed() returns correct result

## Dependencies

- **Upstream**: E13-F01-T04 (PreRequisiteCheck entity)
- **Downstream**: E13-F04-T01 (used in SetupView)

## Testing

```python
def test_prereq_widget_all_passed(qtbot):
    widget = PreRequisiteWidget()
    check = create_all_passed_check()
    widget.set_check(check)
    assert widget.all_passed() == True

def test_prereq_widget_shows_failed(qtbot):
    widget = PreRequisiteWidget()
    check = create_check(backtest_passed=False)
    widget.set_check(check)
    assert widget.all_passed() == False
    assert "✗" in widget._backtest_item._icon.text()

def test_prereq_widget_shows_details(qtbot):
    widget = PreRequisiteWidget()
    check = create_check(backtest_sharpe=1.85)
    widget.set_check(check)
    assert "1.85" in widget._backtest_item._detail.text()
```

---
*Estimated: 2 hours | Risk: Low*
