# Epic E13: Live Trading

## Metadata

| Field | Value |
|-------|-------|
| Epic ID | E13 |
| Title | Live Trading |
| Status | Draft |
| Platform | Cross-platform (via gRPC to Windows) |
| Dependencies | E03 (Broker), E09 (Strategy), E12 (Paper Trading) |
| PRD Sections | 5.8 |

---

## 1. Overview

### 1.1 Purpose

Execute validated strategies with real money:
- Real order placement through brokers
- Risk controls and safety limits
- User confirmation workflow
- Position and order tracking

### 1.2 Goals

1. **Safe**: Multiple confirmations, risk limits
2. **Reliable**: Order execution with retry logic
3. **Transparent**: Clear order status and history
4. **Controlled**: Manual and auto-execution modes

---

## 2. Architecture

### 2.1 Live Trading Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Live Trading Flow                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Signal     â”‚â”€â”€â”€â–ºâ”‚  Risk       â”‚â”€â”€â”€â–ºâ”‚  User       â”‚â”€â”€â”€â–ºâ”‚  Order   â”‚ â”‚
â”‚  â”‚  Generator  â”‚    â”‚  Check      â”‚    â”‚  Confirm    â”‚    â”‚  Execute â”‚ â”‚
â”‚  â”‚             â”‚    â”‚             â”‚    â”‚             â”‚    â”‚          â”‚ â”‚
â”‚  â”‚  Strategy   â”‚    â”‚  Limits &   â”‚    â”‚  Display &  â”‚    â”‚  Submit  â”‚ â”‚
â”‚  â”‚  evaluation â”‚    â”‚  Validation â”‚    â”‚  Approve    â”‚    â”‚  to API  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                            â”‚                                     â”‚      â”‚
â”‚                            â–¼                                     â–¼      â”‚
â”‚                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚                     â”‚  Alert      â”‚                      â”‚  Order   â”‚  â”‚
â”‚                     â”‚  (if fail)  â”‚                      â”‚  Status  â”‚  â”‚
â”‚                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 Safety Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Safety Layers                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  Layer 1: Pre-Requisites                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ [x] Strategy backtested with acceptable metrics                      â”‚â”‚
â”‚  â”‚ [x] Paper trading completed for minimum period                       â”‚â”‚
â”‚  â”‚ [x] Risk parameters configured                                       â”‚â”‚
â”‚  â”‚ [x] Broker account connected and verified                            â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                          â”‚
â”‚  Layer 2: Per-Trade Risk Check                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ - Position size within limit                                         â”‚â”‚
â”‚  â”‚ - Max positions not exceeded                                         â”‚â”‚
â”‚  â”‚ - Daily loss limit not reached                                       â”‚â”‚
â”‚  â”‚ - Within trading hours                                               â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                          â”‚
â”‚  Layer 3: User Confirmation                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ - Display signal details                                             â”‚â”‚
â”‚  â”‚ - Show estimated cost/proceeds                                       â”‚â”‚
â”‚  â”‚ - Require explicit confirmation (unless auto-mode)                   â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                          â”‚
â”‚  Layer 4: Order Validation                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ - Broker rate limit check                                            â”‚â”‚
â”‚  â”‚ - Account balance verification                                       â”‚â”‚
â”‚  â”‚ - Symbol tradability check                                           â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. Domain Model

### 3.1 Live Trading Session

```python
@dataclass
class LiveTradingSession:
    """Live trading session entity"""
    id: str
    strategy: Strategy
    broker_id: str
    account_id: str
    symbols: list[str]
    risk_controls: RiskControls
    execution_mode: ExecutionMode
    status: SessionStatus
    started_at: Optional[datetime] = None
    stopped_at: Optional[datetime] = None
    created_at: datetime = field(default_factory=datetime.utcnow)

class ExecutionMode(Enum):
    MANUAL = "manual"  # User confirms each trade
    SEMI_AUTO = "semi_auto"  # User confirms, then auto-execute for N seconds
    AUTO = "auto"  # Fully automatic (requires explicit consent)

@dataclass
class RiskControls:
    """Risk control configuration"""
    max_position_size_pct: float = 10.0  # Max % of portfolio per trade
    max_positions: int = 5  # Max concurrent positions
    max_daily_loss_pct: float = 5.0  # Stop trading if reached
    max_daily_loss_amount: Optional[Decimal] = None
    trading_hours_start: Optional[time] = time(9, 0)  # 09:00
    trading_hours_end: Optional[time] = time(15, 30)  # 15:30
    require_backtest_sharpe: Optional[float] = 1.0
    require_paper_trading_days: Optional[int] = 5
```

### 3.2 Live Order

```python
@dataclass
class LiveOrder:
    """Order for live trading"""
    id: str
    session_id: str
    symbol: str
    side: OrderSide  # BUY, SELL
    order_type: OrderType  # MARKET, LIMIT
    quantity: int
    price: Optional[Decimal] = None  # For limit orders
    status: OrderStatus = OrderStatus.PENDING
    broker_order_id: Optional[str] = None
    filled_quantity: int = 0
    filled_price: Optional[Decimal] = None
    commission: Decimal = Decimal(0)
    created_at: datetime = field(default_factory=datetime.utcnow)
    submitted_at: Optional[datetime] = None
    filled_at: Optional[datetime] = None
    error_message: Optional[str] = None

class OrderStatus(Enum):
    PENDING = "pending"  # Awaiting confirmation
    SUBMITTED = "submitted"  # Sent to broker
    PARTIAL = "partial"  # Partially filled
    FILLED = "filled"  # Fully filled
    CANCELLED = "cancelled"  # Cancelled by user
    REJECTED = "rejected"  # Rejected by broker
    FAILED = "failed"  # Submission failed
```

### 3.3 Pre-Requisite Check

```python
@dataclass
class PreRequisiteCheck:
    """Pre-requisites for live trading"""
    strategy_id: int
    backtest_passed: bool
    backtest_sharpe: Optional[float]
    paper_trading_passed: bool
    paper_trading_days: Optional[int]
    risk_parameters_set: bool
    broker_connected: bool
    account_verified: bool

    @property
    def all_passed(self) -> bool:
        return all([
            self.backtest_passed,
            self.paper_trading_passed,
            self.risk_parameters_set,
            self.broker_connected,
            self.account_verified
        ])
```

---

## 4. Live Trading Engine

### 4.1 Session Manager

```python
class LiveTradingSessionManager:
    """Manage live trading sessions"""

    def __init__(
        self,
        broker_registry: IBrokerRegistry,
        processing_engine: ProcessingEngine,
        session_repo: ILiveTradingSessionRepository,
        order_repo: IOrderRepository
    ):
        self._broker_registry = broker_registry
        self._engine = processing_engine
        self._session_repo = session_repo
        self._order_repo = order_repo
        self._active_sessions: dict[str, LiveTradingRunner] = {}

    async def check_prerequisites(
        self,
        strategy: Strategy
    ) -> PreRequisiteCheck:
        """Check all prerequisites for live trading"""
        # Check backtest history
        backtest = await self._get_latest_backtest(strategy.id)
        backtest_passed = backtest and backtest.metrics.sharpe_ratio >= 1.0

        # Check paper trading history
        paper_sessions = await self._get_paper_trading_sessions(strategy.id)
        paper_passed = len(paper_sessions) >= 5

        return PreRequisiteCheck(
            strategy_id=strategy.id,
            backtest_passed=backtest_passed,
            backtest_sharpe=backtest.metrics.sharpe_ratio if backtest else None,
            paper_trading_passed=paper_passed,
            paper_trading_days=len(paper_sessions),
            risk_parameters_set=strategy.risk_config is not None,
            broker_connected=len(self._broker_registry.get_healthy()) > 0,
            account_verified=True  # TODO: Implement account verification
        )

    async def start_session(
        self,
        config: LiveSessionConfig
    ) -> LiveTradingSession:
        """Start a live trading session"""
        # Verify prerequisites
        prereq = await self.check_prerequisites(config.strategy)
        if not prereq.all_passed:
            raise PreRequisiteNotMetError(prereq)

        # Get broker
        broker = self._broker_registry.get(config.broker_id)
        if not broker:
            raise BrokerNotFoundError(config.broker_id)

        session = LiveTradingSession(
            id=str(uuid.uuid4()),
            strategy=config.strategy,
            broker_id=config.broker_id,
            account_id=config.account_id,
            symbols=config.symbols,
            risk_controls=config.risk_controls,
            execution_mode=config.execution_mode,
            status=SessionStatus.RUNNING,
            started_at=datetime.utcnow()
        )

        await self._session_repo.save(session)

        # Create and start runner
        runner = LiveTradingRunner(
            session=session,
            broker=broker,
            engine=self._engine,
            order_repo=self._order_repo
        )
        self._active_sessions[session.id] = runner

        asyncio.create_task(runner.run())

        return session
```

### 4.2 Live Trading Runner

```python
class LiveTradingRunner:
    """Execute live trading logic"""

    def __init__(
        self,
        session: LiveTradingSession,
        broker: IBrokerGateway,
        engine: ProcessingEngine,
        order_repo: IOrderRepository
    ):
        self._session = session
        self._broker = broker
        self._engine = engine
        self._order_repo = order_repo
        self._is_running = False
        self._daily_pnl = Decimal(0)
        self._positions: dict[str, Position] = {}
        self._order_handlers: list[Callable[[LiveOrder], None]] = []
        self._signal_handlers: list[Callable[[TradingSignal], None]] = []

    async def run(self):
        """Main trading loop"""
        self._is_running = True

        # Load existing positions
        await self._load_positions()

        while self._is_running:
            # Check if within trading hours
            if not self._is_within_trading_hours():
                await asyncio.sleep(60)
                continue

            # Check daily loss limit
            if self._is_daily_limit_reached():
                logging.warning("Daily loss limit reached, pausing trading")
                await asyncio.sleep(60)
                continue

            # Process each symbol
            for symbol in self._session.symbols:
                await self._process_symbol(symbol)

            await asyncio.sleep(1)

    async def _process_symbol(self, symbol: str):
        """Process a single symbol"""
        quote = await self._broker.get_latest_quote(symbol)
        if not quote:
            return

        # Update position prices
        if symbol in self._positions:
            self._positions[symbol].current_price = quote.price
            await self._check_exit(symbol, quote)
        else:
            await self._check_entry(symbol, quote)

    async def _check_entry(self, symbol: str, quote: Quote):
        """Check entry conditions and generate signal"""
        # Get recent candles
        candles = await self._get_recent_candles(symbol)
        if not candles:
            return

        # Evaluate entry rule
        df = pd.DataFrame([asdict(c) for c in candles])
        result = self._engine._formula_service.evaluate(
            self._session.strategy.entry_rule.to_formula(),
            df
        )

        if not result.iloc[-1]:
            return

        # Risk check
        if not self._passes_risk_check(quote):
            return

        # Generate signal
        quantity = self._calculate_position_size(quote.price)
        signal = TradingSignal(
            id=str(uuid.uuid4()),
            session_id=self._session.id,
            symbol=symbol,
            symbol_name=quote.symbol_name,
            signal_type=SignalType.ENTRY,
            direction=TradeDirection.BUY,
            price=quote.price,
            quantity=quantity,
            reason="Entry rule triggered"
        )

        # Emit signal
        await self._emit_signal(signal)

        # Handle based on execution mode
        if self._session.execution_mode == ExecutionMode.AUTO:
            await self._execute_order(signal)

    async def _execute_order(self, signal: TradingSignal) -> LiveOrder:
        """Execute order through broker"""
        order = LiveOrder(
            id=str(uuid.uuid4()),
            session_id=self._session.id,
            symbol=signal.symbol,
            side=OrderSide.BUY if signal.direction == TradeDirection.BUY else OrderSide.SELL,
            order_type=OrderType.MARKET,
            quantity=signal.quantity
        )

        try:
            # Submit to broker
            order.status = OrderStatus.SUBMITTED
            order.submitted_at = datetime.utcnow()
            await self._order_repo.save(order)

            result = await self._broker.place_order(
                account_id=self._session.account_id,
                order=order
            )

            order.broker_order_id = result.order_id
            order.status = OrderStatus.FILLED
            order.filled_quantity = result.filled_quantity
            order.filled_price = result.filled_price
            order.commission = result.commission
            order.filled_at = datetime.utcnow()

            # Update position
            if signal.direction == TradeDirection.BUY:
                await self._open_position(order)
            else:
                await self._close_position(order)

        except Exception as e:
            order.status = OrderStatus.FAILED
            order.error_message = str(e)
            logging.error(f"Order failed: {e}")

        await self._order_repo.save(order)
        await self._emit_order_update(order)

        return order

    def _passes_risk_check(self, quote: Quote) -> bool:
        """Check if trade passes risk controls"""
        controls = self._session.risk_controls

        # Max positions check
        if len(self._positions) >= controls.max_positions:
            return False

        # Position size check
        position_value = quote.price * self._calculate_position_size(quote.price)
        portfolio_value = self._get_portfolio_value()
        if position_value / portfolio_value > controls.max_position_size_pct / 100:
            return False

        # Daily loss check
        if self._is_daily_limit_reached():
            return False

        return True

    def _is_within_trading_hours(self) -> bool:
        """Check if current time is within trading hours"""
        controls = self._session.risk_controls
        if not controls.trading_hours_start or not controls.trading_hours_end:
            return True

        now = datetime.now().time()
        return controls.trading_hours_start <= now <= controls.trading_hours_end

    def _is_daily_limit_reached(self) -> bool:
        """Check if daily loss limit is reached"""
        controls = self._session.risk_controls
        if not controls.max_daily_loss_pct:
            return False

        portfolio_value = self._get_portfolio_value()
        max_loss = portfolio_value * Decimal(controls.max_daily_loss_pct / 100)

        return self._daily_pnl <= -max_loss
```

---

## 5. UI Components

### 5.1 Account Selection (PRD 5.8.1)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Live Trading Setup                                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚ Strategy: RSI Momentum Strategy                                          â”‚
â”‚                                                                          â”‚
â”‚ Select Broker & Account:                                                 â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ â—‹ KIS - 50012345-01 (ì‹¤ì „íˆ¬ìž)     ìž”ê³ : â‚©52,340,000                â”‚ â”‚
â”‚ â”‚ â— KIS - 50012345-02 (ëª¨ì˜íˆ¬ìž)     ìž”ê³ : â‚©100,000,000               â”‚ â”‚
â”‚ â”‚ â—‹ Creon - 12345678 (ìœ„íƒ)          ìž”ê³ : â‚©28,500,000                â”‚ â”‚
â”‚ â”‚ â—‹ Kiwoom - 8012345678 (ìœ„íƒ)       ìž”ê³ : â‚©15,200,000                â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                          â”‚
â”‚ Rate Limit Status: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘ 16/20 req/s   [ì •ìƒ]                      â”‚
â”‚                                                                          â”‚
â”‚ Prerequisites:                                                           â”‚
â”‚ â”œâ”€ [âœ“] Strategy backtested (Sharpe: 1.85)                               â”‚
â”‚ â”œâ”€ [âœ“] Paper trading (7 days)                                           â”‚
â”‚ â”œâ”€ [âœ“] Risk parameters configured                                       â”‚
â”‚ â””â”€ [âœ“] Broker connected                                                  â”‚
â”‚                                                                          â”‚
â”‚                                                       [â–¶ ì‹¤ì „ ë§¤ë§¤ ì‹œìž‘] â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 Order Confirmation Dialog

```python
class OrderConfirmationDialog(QDialog):
    """Confirm order before execution"""

    def __init__(
        self,
        signal: TradingSignal,
        account_balance: Decimal,
        parent=None
    ):
        super().__init__(parent)
        self._signal = signal
        self._balance = account_balance
        self._setup_ui()

    def _setup_ui(self):
        self.setWindowTitle("Order Confirmation")
        layout = QVBoxLayout(self)

        # Signal details
        details_group = QGroupBox("Order Details")
        details_layout = QFormLayout(details_group)

        details_layout.addRow("Symbol:", QLabel(f"{self._signal.symbol} {self._signal.symbol_name}"))
        details_layout.addRow("Direction:", QLabel(self._signal.direction.value.upper()))
        details_layout.addRow("Quantity:", QLabel(str(self._signal.quantity)))
        details_layout.addRow("Price:", QLabel(f"â‚©{self._signal.price:,.0f}"))

        total_value = self._signal.price * self._signal.quantity
        details_layout.addRow("Total Value:", QLabel(f"â‚©{total_value:,.0f}"))

        layout.addWidget(details_group)

        # Warning for large orders
        if total_value > self._balance * Decimal("0.1"):
            warning = QLabel("âš ï¸ This order is more than 10% of your balance")
            warning.setStyleSheet("color: orange; font-weight: bold;")
            layout.addWidget(warning)

        # Buttons
        buttons = QDialogButtonBox()

        confirm_btn = QPushButton("Confirm Order")
        confirm_btn.setStyleSheet("background: #4CAF50; color: white;")
        confirm_btn.clicked.connect(self.accept)
        buttons.addButton(confirm_btn, QDialogButtonBox.AcceptRole)

        cancel_btn = QPushButton("Cancel")
        cancel_btn.clicked.connect(self.reject)
        buttons.addButton(cancel_btn, QDialogButtonBox.RejectRole)

        layout.addWidget(buttons)
```

### 5.3 Live Trading Dashboard

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Live Trading: RSI Momentum Strategy                                      â”‚
â”‚ Account: KIS 50012345-01 (ì‹¤ì „íˆ¬ìž)          Status: Running  [ì¤‘ì§€]    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚ Account Summary                                                          â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚ â”‚ Balance: â‚©52,340,000  Positions: 3  Daily P&L: +â‚©1,250,000      â”‚    â”‚
â”‚ â”‚ Rate: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘ 16/20 req/s                                     â”‚    â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                          â”‚
â”‚ Open Positions                                                           â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚ â”‚ 005930 ì‚¼ì„±ì „ìž  500ì£¼  @â‚©71,000  â‚©72,500 (+2.1%)  [ì²­ì‚°]        â”‚    â”‚
â”‚ â”‚ 000660 SKí•˜ì´ë‹‰ìŠ¤ 100ì£¼ @â‚©125,000 â‚©128,000 (+2.4%) [ì²­ì‚°]        â”‚    â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                          â”‚
â”‚ Pending Signals                                                          â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚ â”‚ 10:32 ðŸŸ¢ BUY 035720 ì¹´ì¹´ì˜¤ @â‚©52,300 x 100ì£¼      [í™•ì¸] [ë¬´ì‹œ]   â”‚    â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                          â”‚
â”‚ Order History                                                            â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚ â”‚ 09:15 005930 BUY  500ì£¼ @â‚©71,000 âœ“ Filled                        â”‚    â”‚
â”‚ â”‚ 09:45 000660 BUY  100ì£¼ @â‚©125,000 âœ“ Filled                       â”‚    â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 6. Tasks Breakdown

| Task ID | Title | Effort | Dependencies |
|---------|-------|--------|--------------|
| E13-F01-T01 | Define LiveTradingSession entity | M | E12 |
| E13-F01-T02 | Define LiveOrder and OrderStatus | M | T01 |
| E13-F01-T03 | Define RiskControls | M | T01 |
| E13-F01-T04 | Define PreRequisiteCheck | S | T01 |
| E13-F02-T01 | Implement LiveTradingSessionManager | L | F01, E03 |
| E13-F02-T02 | Implement prerequisite checking | M | F02-T01 |
| E13-F02-T03 | Implement LiveTradingRunner | L | F01, E03 |
| E13-F02-T04 | Implement risk control checks | M | F02-T03 |
| E13-F03-T01 | Implement order submission to broker | L | E03 |
| E13-F03-T02 | Implement order status tracking | M | F03-T01 |
| E13-F03-T03 | Implement order retry logic | M | F03-T01 |
| E13-F04-T01 | Create LiveTradingSetupView | M | E01 |
| E13-F04-T02 | Create AccountSelectionWidget | M | F04-T01 |
| E13-F04-T03 | Create PreRequisiteWidget | M | F04-T01 |
| E13-F04-T04 | Create LiveTradingDashboard | L | F04-T01 |
| E13-F04-T05 | Create OrderConfirmationDialog | M | F04-T01 |
| E13-F04-T06 | Create OrderHistoryWidget | M | F04-T04 |

---

## 7. Acceptance Criteria (PRD 8.6)

### 7.1 Functional

- [ ] ì¦ê¶Œì‚¬ ì—°ë™ (KIS, Creon, Kiwoom via gRPC)
- [ ] ê³„ì¢Œ ì„ íƒ ê°€ëŠ¥
- [ ] ì£¼ë¬¸ ì „ í™•ì¸ ë‹¨ê³„
- [ ] ì¼ì¼ ì†ì‹¤ í•œë„ ì„¤ì •
- [ ] ì£¼ë¬¸ ì²´ê²° í™•ì¸

### 7.2 Safety

- [ ] Prerequisites enforced before trading
- [ ] Risk limits prevent excessive trading
- [ ] All orders logged for audit

### 7.3 Testing

- [ ] Unit tests with mock broker
- [ ] Integration tests for order flow
- [ ] Test coverage > 85%
- [ ] NEVER use real money in tests

---

## 8. Risk Considerations

### 8.1 Critical Safety Measures

1. **No Auto-Trading by Default**: Manual confirmation required
2. **Paper Trading First**: Require minimum paper trading period
3. **Daily Limits**: Automatic stop on excessive loss
4. **Clear UI**: Obvious distinction from paper trading
5. **Audit Trail**: Log all orders with timestamps

### 8.2 Error Handling

- Broker connection failure â†’ Alert user, pause session
- Order rejection â†’ Display error, don't retry automatically
- Partial fill â†’ Track and display clearly
- Rate limit â†’ Queue orders, notify user

---

## 9. References

- PRD Section 5.8: Live Trading
- E03: Broker Integration
- E12: Paper Trading
- [KRX Trading Hours](https://www.krx.co.kr/)
