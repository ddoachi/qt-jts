---
# ============================================================================
# SPEC METADATA
# ============================================================================

# === IDENTIFICATION ===
id: E04-F05
clickup_task_id: ''
title: UI Components
type: feature

# === HIERARCHY ===
parent: E04
children: [E04-F05-T01, E04-F05-T02, E04-F05-T03]
epic: E04
feature: F05
domain: data-collection

# === WORKFLOW ===
status: draft
priority: medium

# === TRACKING ===
created: '2025-01-15'
updated: '2025-01-15'
due_date: ''
estimated_hours: 24
actual_hours: 0

# === METADATA ===
tags: [ui, qt, pyside6, widgets]
effort: large
risk: medium
---

# Spec: E04-F05 - UI Components

**Status**: Draft
**Type**: Feature
**Parent**: E04
**Created**: 2025-01-15
**Updated**: 2025-01-15

## Executive Summary

Build the Qt/PySide6 user interface components for configuring, monitoring, and managing historical data collection. These widgets provide an intuitive interface for job setup, real-time progress monitoring, and data browsing with filtering, validation status display, and export functionality.

## Execution Flow

```
1. CollectionConfigWidget
   → Display broker selector
   → Show market/sector checkboxes
   → Update symbol count on selection change
   → Show timeframe and date range pickers
   → Display estimated candles and duration
   → On start click: emit collection_requested signal

2. CollectionProgressWidget
   → Subscribe to progress events
   → Update progress bar every 1 second
   → Show current symbol and statistics
   → Handle pause/resume button clicks
   → Handle stop button click

3. DataManagementView
   → Load coverage data from service
   → Display in sortable table
   → Apply filters (timeframe, market)
   → Show validation status icons
   → Handle export button click
```

## User Stories

### Primary User Story
**As a** trader
**I want to** configure and start data collection through a visual interface
**So that** I don't need to use command line or write code

### Additional Stories
- **As a** trader, **I want to** see progress visually, **So that** I know collection is working
- **As a** trader, **I want to** browse downloaded data, **So that** I can verify coverage
- **As a** trader, **I want to** export data from UI, **So that** I can analyze in other tools

## Acceptance Scenarios

### Scenario 1: Start Collection from UI
**Given** user has selected KOSPI market and daily timeframe
**When** user clicks Start button
**Then** collection job starts and progress widget appears

### Scenario 2: Progress Updates
**Given** collection is running
**When** 1 second passes
**Then** progress bar and statistics update

### Scenario 3: Pause Collection
**Given** collection is running
**When** user clicks Pause button
**Then** button text changes to Resume and progress stops

### Scenario 4: Export Data
**Given** user is viewing downloaded data
**When** user clicks Export CSV button
**Then** file dialog opens and CSV is generated

## Requirements

### Functional Requirements
- **FR-001**: Config widget MUST show broker selection from registry
- **FR-002**: Config widget MUST update symbol count on filter change
- **FR-003**: Progress widget MUST update every 1 second
- **FR-004**: Progress widget MUST have pause/resume/stop buttons
- **FR-005**: Data view MUST support filtering and sorting
- **FR-006**: Data view MUST show validation status icons

### Non-Functional Requirements
- **NFR-001**: UI remains responsive during updates (no blocking)
- **NFR-002**: Table loads < 1 second for 10,000 rows
- **NFR-003**: Follows application style guide from E01

### Technical Constraints
- **TC-001**: Must use PySide6 (Qt 6.5+)
- **TC-002**: Must follow MVVM pattern from E01
- **TC-003**: Must use signals for async updates

## Key Entities

### Entity: CollectionConfigWidget
- **Description**: Form widget for collection job configuration
- **Key Attributes**: broker_combo, market_checks, timeframe_combo, date_pickers, start_button
- **Signals**: collection_requested(StartCollectionRequest)

### Entity: CollectionProgressWidget
- **Description**: Real-time progress display widget
- **Key Attributes**: progress_bar, time_labels, stats_labels, control_buttons
- **Signals**: pause_requested(), resume_requested(), stop_requested()

### Entity: DataManagementView
- **Description**: Data browser with filtering and export
- **Key Attributes**: table_view, filter_combos, export_button
- **Signals**: validation_requested(), export_requested(format)

## Dependencies

### Upstream Dependencies
- [x] E01: Application Framework - Widget patterns, styling
- [x] E04-F03: Progress Monitoring - ViewModel integration

### Downstream Impact
- None (presentation layer)

## Gate Checks

### Pre-Implementation Gates
- [x] UI mockups defined
- [x] Widget hierarchy documented

### Quality Gates
- [ ] Accessibility reviewed (keyboard nav, labels)
- [ ] Style guide compliance verified

## Tasks Preview

### Implementation Tasks
- [ ] E04-F05-T01 [P] Create CollectionConfigWidget
- [ ] E04-F05-T02 [P] Create CollectionProgressWidget
- [ ] E04-F05-T03 [P] Create DataManagementView

**[P]** = Can be executed in parallel

## Success Criteria

### Acceptance Criteria
- [ ] Config widget validates all inputs before enabling start
- [ ] Progress widget updates smoothly every second
- [ ] Pause/resume buttons work correctly
- [ ] Data view filters and sorts correctly
- [ ] Export button generates valid file

### Definition of Done
- [ ] Widget unit tests with pytest-qt
- [ ] Integration tests for workflows
- [ ] Visual regression tests for key states
- [ ] Accessibility verified

## Risk Assessment

| Risk | Probability | Impact | Mitigation |
|------|------------|--------|------------|
| UI blocking during updates | Low | Medium | Use Qt signals/slots correctly |
| Table slow with many rows | Low | Low | Use QAbstractTableModel |
| Style inconsistency | Low | Low | Use shared stylesheets from E01 |

## Notes and Clarifications

### Decisions Made
- 2025-01-15: Using MVVM pattern from E01
- 2025-01-15: Progress updates via Signal/Slot, not polling

## Artifacts

### Input Documents
- [E04 Epic](../E04.spec.md) - UI mockups
- [E01 Framework](../../E01/E01.spec.md) - Widget patterns

### Output Artifacts
- [ ] `E04-F05.context.md` - Implementation progress
- [ ] `E04-F05.pre-docs.md` - Pre-implementation planning

### Children Specs
| ID | Title | Effort |
|----|-------|--------|
| [E04-F05-T01](T01/E04-F05-T01.spec.md) | Create CollectionConfigWidget | L |
| [E04-F05-T02](T02/E04-F05-T02.spec.md) | Create CollectionProgressWidget | L |
| [E04-F05-T03](T03/E04-F05-T03.spec.md) | Create DataManagementView | L |

---
*Template Version: 2.0.0 - Enhanced with Speckit features*
