---
# ============================================================================
# SPEC METADATA
# ============================================================================

# === IDENTIFICATION ===
id: E04-F05-T01
clickup_task_id: '86ew020du'
title: Create CollectionConfigWidget
type: task

# === HIERARCHY ===
parent: E04-F05
children: []
epic: E04
feature: F05
task: T01
domain: data-collection

# === WORKFLOW ===
status: draft
priority: medium

# === TRACKING ===
created: '2025-01-15'
updated: '2025-01-15'
due_date: ''
estimated_hours: 8
actual_hours: 0

# === METADATA ===
tags: [ui, widget, pyside6, configuration]
effort: large
risk: low
---

# Spec: E04-F05-T01 - Create CollectionConfigWidget

**Status**: Draft
**Type**: Task
**Parent**: E04-F05
**Created**: 2025-01-15
**Updated**: 2025-01-15

## Executive Summary

Create the Qt/PySide6 configuration widget for setting up historical data collection jobs. This widget provides an intuitive interface for broker selection, symbol filtering, timeframe configuration, and collection options with estimation display.

## Execution Flow

```
1. Initialize widget with dependencies
   → Inject broker registry and symbol service
   → Setup UI components

2. User configures broker
   → Select from available brokers
   → Display rate limit indicator

3. User selects symbols
   → Filter by market (KOSPI, KOSDAQ, ETF)
   → Filter by sector
   → Preview symbol count

4. User configures timeframe and period
   → Select timeframe (1m to 1w)
   → Set date range
   → Display estimated candle count

5. User sets options
   → Incremental mode toggle
   → Retry failed toggle
   → Include delisted toggle

6. Start collection
   → Build StartCollectionRequest
   → Emit collection_requested signal
```

## User Stories

### Primary User Story
**As a** trader
**I want to** configure data collection with an intuitive UI
**So that** I can easily start downloading historical data

## Acceptance Scenarios

### Scenario 1: Broker Selection
**Given** widget is displayed
**When** broker dropdown is clicked
**Then** all registered brokers are shown

### Scenario 2: Symbol Count Update
**Given** KOSPI and KOSDAQ are checked
**When** market selection changes
**Then** symbol count label updates immediately

### Scenario 3: Valid Request Emitted
**Given** all configuration is set
**When** start button is clicked
**Then** collection_requested signal emits valid request

## Requirements

### Functional Requirements
- **FR-001**: Widget MUST populate brokers from registry
- **FR-002**: Widget MUST filter symbols by market checkboxes
- **FR-003**: Widget MUST have calendar popup for date pickers
- **FR-004**: Widget MUST update estimate on configuration change
- **FR-005**: Widget MUST emit valid request on start

### Non-Functional Requirements
- **NFR-001**: Widget renders within 100ms
- **NFR-002**: Symbol count updates within 200ms

### Technical Constraints
- **TC-001**: Must use PySide6 widgets
- **TC-002**: Must follow Qt signal/slot pattern
- **TC-003**: Must be testable with pytest-qt

## Key Entities

### Entity: CollectionConfigWidget
- **Key Attributes**: broker_registry, symbol_service
- **Signals**: collection_requested, symbol_list_requested
- **Methods**: _setup_ui(), _build_request()

### Entity: RateLimitIndicator
- **Description**: Visual indicator for broker rate limit status

## Dependencies

### Upstream Dependencies
- [x] E01: Application Framework (Widget patterns)
- [x] E03: Broker registry

### Downstream Impact
- [ ] E04-F02-T01: StartCollectionUseCase receives request

## Success Criteria

### Acceptance Criteria
- [ ] Broker selection populates from registry
- [ ] Market checkboxes filter symbol count
- [ ] Date pickers have calendar popup
- [ ] Estimate updates on configuration change
- [ ] Start button emits valid request

### Definition of Done
- [ ] Widget unit tests with pytest-qt
- [ ] Validation edge cases tested
- [ ] Signal emission tests
- [ ] Keyboard navigation works

## Artifacts

### Output Files
```
src/presentation/widgets/
├── collection_config_widget.py
└── rate_limit_indicator.py
```

---
*Template Version: 2.0.0 - Enhanced with Speckit features*
