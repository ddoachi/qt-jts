---
# ============================================================================
# SPEC METADATA
# ============================================================================

# === IDENTIFICATION ===
id: E04-F01-T02
clickup_task_id: '86ew020d2'
title: Create CollectionProgress Value Object
type: task

# === HIERARCHY ===
parent: E04-F01
children: []
epic: E04
feature: F01
task: T02
domain: data-collection

# === WORKFLOW ===
status: draft
priority: high

# === TRACKING ===
created: '2025-01-15'
updated: '2025-01-15'
due_date: ''
estimated_hours: 2
actual_hours: 0

# === METADATA ===
tags: [domain-model, value-object, immutable, progress]
effort: small
risk: low
---

# Spec: E04-F01-T02 - Create CollectionProgress Value Object

**Status**: Draft
**Type**: Task
**Parent**: E04-F01
**Created**: 2025-01-15
**Updated**: 2025-01-15

## Executive Summary

Implement the CollectionProgress immutable value object for tracking real-time progress of data collection jobs. This provides snapshot views of collection status with calculated metrics like progress percentage, processing rate, and estimated remaining time.

## Execution Flow

```
1. Create frozen dataclass
   → job_id: str
   → total_symbols: int
   → completed_symbols: int
   → failed_symbols: int
   → total_candles: int
   → elapsed_seconds: float
   → current_symbol: str | None

2. Implement validation
   → total_symbols >= 0
   → completed_symbols >= 0
   → completed_symbols <= total_symbols
   → If invalid: ERROR "Invalid progress value"

3. Implement calculated properties
   → progress_pct: (completed / total) * 100
   → symbols_per_second: completed / elapsed
   → candles_per_second: total_candles / elapsed
   → estimated_remaining_seconds: remaining / rate
   → Handle division by zero gracefully
```

## User Stories

### Primary User Story
**As a** developer implementing progress UI
**I want to** accurate progress calculations from an immutable snapshot
**So that** I can display reliable progress information

## Acceptance Scenarios

### Scenario 1: Progress Percentage
**Given** CollectionProgress with 50 of 100 symbols completed
**When** progress_pct is accessed
**Then** returns 50.0

### Scenario 2: Zero Total Symbols
**Given** CollectionProgress with 0 total symbols
**When** progress_pct is accessed
**Then** returns 0.0 (not division error)

### Scenario 3: Time Estimation
**Given** 50 symbols completed in 50 seconds, 50 remaining
**When** estimated_remaining_seconds is accessed
**Then** returns approximately 50.0 seconds

### Scenario 4: Immutability
**Given** a CollectionProgress instance
**When** attempting to modify completed_symbols
**Then** AttributeError is raised

## Requirements

### Functional Requirements
- **FR-001**: Object MUST be immutable (frozen dataclass)
- **FR-002**: progress_pct MUST return 0-100 range
- **FR-003**: Rate calculations MUST handle zero elapsed time
- **FR-004**: Time estimate MUST return infinity when rate is zero
- **FR-005**: Validation MUST reject invalid counts

### Technical Constraints
- **TC-001**: Must use frozen dataclass
- **TC-002**: No side effects in property calculations
- **TC-003**: Full type hints required

## Key Entities

### Entity: CollectionProgress
- **Description**: Immutable progress snapshot
- **Key Attributes**: job_id, total_symbols, completed_symbols, failed_symbols, total_candles, elapsed_seconds, current_symbol
- **Properties**: progress_pct, symbols_per_second, candles_per_second, estimated_remaining_seconds

## Dependencies

### Upstream Dependencies
- [x] E04-F01-T01: Uses with CollectionJob

### Downstream Impact
- [ ] E04-F03: Returns from GetProgressUseCase
- [ ] E04-F05: Displayed in ProgressWidget

## Success Criteria

### Acceptance Criteria
- [ ] Frozen dataclass (immutable)
- [ ] All calculated properties working
- [ ] Edge cases handled (zero values)
- [ ] Validation on creation

### Definition of Done
- [ ] Unit tests for all properties
- [ ] Edge case tests
- [ ] Immutability verified
- [ ] 100% type coverage

## Artifacts

### Output Files
```
src/domain/value_objects/
├── __init__.py
└── collection_progress.py
```

---
*Template Version: 2.0.0 - Enhanced with Speckit features*
