# Spec: E03-F01-T01 - Define Domain Entities

---
# ============================================================================
# SPEC METADATA
# ============================================================================

# === IDENTIFICATION ===
id: E03-F01-T01
clickup_task_id: '86ew01zyr'
title: Define Domain Entities (Balance, Position, Order)
type: task

# === HIERARCHY ===
parent: E03-F01
children: []
epic: E03
feature: F01
task: T01
domain: broker

# === WORKFLOW ===
status: draft
priority: high

# === TRACKING ===
created: '2025-12-28'
updated: '2025-12-28'
due_date: ''
estimated_hours: 4
actual_hours: 0

# === METADATA ===
tags:
  - domain
  - entities
  - dataclass
  - value-objects
effort: medium
risk: low
---

**Status**: Draft
**Type**: Task
**Parent**: E03-F01
**Created**: 2025-12-28
**Updated**: 2025-12-28

## Executive Summary

Create immutable value objects for financial data: Balance (account balance and buying power), Position (stock holdings with P&L calculations), and Order (trading order with status tracking). All entities use Python dataclasses with frozen=True for immutability and Decimal for monetary values.

## Execution Flow

```
1. Create enums module
   → Define OrderSide (BUY, SELL)
   → Define OrderType (MARKET, LIMIT)
   → Define OrderStatus (PENDING, PARTIAL, FILLED, CANCELLED, REJECTED)
2. Create Balance value object
   → Frozen dataclass with account_id, total_equity, cash_balance, buying_power
   → Use Decimal for monetary values
3. Create Position value object
   → Frozen dataclass with symbol, quantity, avg_price, current_price
   → Add computed properties: market_value, unrealized_pnl, unrealized_pnl_pct
4. Create Order entity
   → Mutable dataclass for status updates
   → Add helper properties: is_filled, is_active
   → Return: SUCCESS with all entities defined
```

## User Stories

### Primary User Story
**As a** developer
**I want to** use type-safe financial entities
**So that** I can work with broker data without runtime errors

## Acceptance Scenarios

### Scenario 1: Create Balance
**Given** account data from broker
**When** Balance object is created
**Then** all fields are accessible and object is immutable

### Scenario 2: Calculate Position P&L
**Given** Position with avg_price=50000, current_price=52500, quantity=100
**When** unrealized_pnl is accessed
**Then** returns 250000 (5% gain)

### Scenario 3: Order Status Tracking
**Given** Order with status=PENDING
**When** is_active is checked
**Then** returns True

## Requirements

### Functional Requirements
- **FR-001**: Balance frozen dataclass with all required fields
- **FR-002**: Position frozen dataclass with computed P&L properties
- **FR-003**: Order entity with status enum and helper properties
- **FR-004**: All enums defined (OrderSide, OrderType, OrderStatus)

### Non-Functional Requirements
- **NFR-001**: Use Decimal for all monetary values
- **NFR-002**: Immutable (frozen) for value objects
- **NFR-003**: Type hints on all fields and methods

### Technical Constraints
- **TC-001**: Python 3.10+ dataclasses
- **TC-002**: Use decimal.Decimal for financial values

## Dependencies

### Upstream Dependencies
- None

### Downstream Impact
- [ ] E03-F01-T02: Uses these entities in interface
- [ ] All gateway implementations use these entities

## Gate Checks

### Pre-Implementation Gates
- [x] Entity fields defined
- [x] Type requirements clear

### Quality Gates
- [ ] Unit tests for all entities
- [ ] Edge case tests (zero values, negative P&L)
- [ ] Test coverage > 80%

## Success Criteria

### Acceptance Criteria
- [ ] All entities implemented
- [ ] Computed properties working
- [ ] Immutability verified
- [ ] Tests passing

### Definition of Done
- [ ] Code reviewed
- [ ] Unit tests passing
- [ ] Documentation complete

## Risk Assessment

| Risk | Probability | Impact | Mitigation |
|------|-------------|--------|------------|
| Decimal precision | Low | Medium | Proper Decimal operations |

## Artifacts

### Input Documents
- [Parent Feature](../E03-F01.spec.md)

### Output Artifacts
- `src/domain/entities/balance.py`
- `src/domain/entities/position.py`
- `src/domain/entities/order.py`
- `src/domain/entities/enums.py`

---
*Template Version: 2.0.0 - Enhanced with Speckit features*
