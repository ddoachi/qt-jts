---
# ============================================================================
# SPEC METADATA
# ============================================================================

# === IDENTIFICATION ===
id: E05-F04-T01-S01
clickup_task_id: '86ew020gu'
title: Create base widget layout and editor component
type: subtask

# === HIERARCHY ===
parent: E05-F04-T01
children: []
epic: E05
feature: F04
task: T01
subtask: S01
domain: ui

# === WORKFLOW ===
status: pending
priority: high

# === TRACKING ===
created: '2025-12-28'
updated: '2025-12-28'
due_date: ''
estimated_hours: 4
actual_hours: 0

# === METADATA ===
tags:
  - formula-editor
  - ui
  - widget
  - layout
effort: medium
risk: low
---

# Spec: E05-F04-T01-S01 - Create base widget layout and editor component

---

**Status**: Pending
**Type**: Subtask
**Parent**: E05-F04-T01
**Created**: 2025-12-28
**Updated**: 2025-12-28

## Executive Summary

Create the base `FormulaEditorWidget` class with the main layout structure and the code editor component (`QPlainTextEdit`) configured with monospace font. This subtask establishes the foundational UI structure that other subtasks will build upon.

## Scope

### In Scope
- Create `FormulaEditorWidget` class inheriting from `QWidget`
- Set up `QVBoxLayout` as main layout
- Create and configure `QPlainTextEdit` as the formula editor
- Apply monospace font (Consolas, 11pt) to the editor
- Add placeholder status label (gray "Enter formula...")
- Add placeholder "Functions Reference" button
- Define signals: `formula_changed` and `formula_valid`

### Out of Scope
- Validation logic (S02)
- Parameter editor panel (S03)
- Save/load functionality (S04)
- Syntax highlighting (T02)

## Acceptance Criteria

- [ ] `FormulaEditorWidget` class exists in `libs/ui/formula/editor_widget.py`
- [ ] Widget uses `QVBoxLayout` for component arrangement
- [ ] `QPlainTextEdit` editor is configured with Consolas 11pt font
- [ ] Status label displays "Enter formula..." in gray
- [ ] "Functions Reference" button is present and clickable
- [ ] `formula_changed` signal is defined and emits on text change
- [ ] `formula_valid` signal is defined (will be used by S02)
- [ ] Widget can be instantiated and displayed in a test window

## Technical Implementation

### File Location
`libs/ui/formula/editor_widget.py`

### Class Structure
```python
from PySide6.QtWidgets import QWidget, QVBoxLayout, QPlainTextEdit, QLabel, QPushButton
from PySide6.QtGui import QFont
from PySide6.QtCore import Signal

class FormulaEditorWidget(QWidget):
    """Formula editor widget with validation and parameter editing."""

    formula_changed = Signal(str)
    formula_valid = Signal(bool)

    def __init__(self, parent=None):
        super().__init__(parent)
        self._setup_ui()

    def _setup_ui(self):
        """Set up the widget layout and components."""
        layout = QVBoxLayout(self)

        # Code editor with monospace font
        self._editor = QPlainTextEdit()
        self._editor.setFont(QFont("Consolas", 11))
        self._editor.setPlaceholderText("Enter DSL formula here...")
        self._editor.textChanged.connect(self._on_text_changed)

        # Validation status label
        self._status_label = QLabel("Enter formula...")
        self._status_label.setStyleSheet("color: gray;")

        # Functions reference button
        self._help_button = QPushButton("Functions Reference")

        # Add widgets to layout
        layout.addWidget(self._editor)
        layout.addWidget(self._status_label)
        layout.addWidget(self._help_button)

    def _on_text_changed(self):
        """Handle text changes in the editor."""
        self.formula_changed.emit(self._editor.toPlainText())

    def get_formula(self) -> str:
        """Get the current formula text."""
        return self._editor.toPlainText()

    def set_formula(self, formula: str):
        """Set the formula text."""
        self._editor.setPlainText(formula)
```

## Dependencies

### Upstream
- PySide6 Qt bindings

### Downstream
- S02 will add validation timer and FormulaService integration
- S03 will add ParameterEditorPanel
- S04 will add save/load methods

## Testing Requirements

- [ ] Unit test: Widget instantiation succeeds
- [ ] Unit test: Font is Consolas 11pt
- [ ] Unit test: `formula_changed` signal emits on text change
- [ ] Unit test: `get_formula()` returns current text
- [ ] Unit test: `set_formula()` updates editor text

---
*Template Version: 2.0.0 - Subtask Specification*
