# Spec: E12-F01 - Domain Entities & Value Objects

---
# ============================================================================
# SPEC METADATA
# ============================================================================

# === IDENTIFICATION ===
id: E12-F01
clickup_task_id: ''
title: Domain Entities & Value Objects
type: feature

# === HIERARCHY ===
parent: E12
children:
  - E12-F01-T01
  - E12-F01-T02
  - E12-F01-T03
epic: E12
feature: F01
task: null
domain: paper-trading

# === WORKFLOW ===
status: draft
priority: high

# === TRACKING ===
created: '2025-12-30'
updated: '2025-12-30'
due_date: ''
estimated_hours: 12
actual_hours: 0

# === METADATA ===
tags:
  - domain
  - entities
  - value-objects
  - paper-trading
effort: medium
risk: low
---

**Status**: Draft
**Type**: Feature
**Parent**: E12
**Created**: 2025-12-30
**Updated**: 2025-12-30

## Executive Summary

Define the core domain model for paper trading, including `PaperTradingSession` (session configuration and lifecycle), `VirtualPortfolio` (virtual cash and positions), `VirtualPosition` (individual holdings with P&L), and `TradingSignal` (entry/exit signal events). These entities form the foundation for simulating trades without real money.

## Execution Flow

```
1. Define session-related entities
   → Create PaperTradingSession dataclass
   → Create SessionConfig dataclass
   → Define SessionStatus enum
2. Define portfolio entities
   → Create VirtualPortfolio dataclass
   → Create VirtualPosition dataclass with P&L properties
3. Define trading signal entities
   → Create TradingSignal dataclass
   → Define SignalType, SignalStatus enums
   → Return: SUCCESS with domain model ready
```

## User Stories

### Primary User Story
**As a** developer
**I want to** use well-defined domain entities for paper trading
**So that** I can simulate trades with type-safe, immutable data structures

### Additional Stories
- **As a** developer, **I want to** track virtual positions, **So that** I can calculate unrealized P&L
- **As a** developer, **I want to** manage trading signals, **So that** users can act on entry/exit opportunities

## Acceptance Scenarios

### Scenario 1: Create Paper Trading Session
**Given** strategy and broker configuration
**When** PaperTradingSession is created
**Then** session has unique ID, PENDING status, and configured capital

### Scenario 2: Calculate Position P&L
**Given** VirtualPosition with avg_price=71000, current_price=72500, quantity=500
**When** unrealized_pnl is accessed
**Then** returns 750000 (2.1% gain)

### Scenario 3: Create Trading Signal
**Given** entry conditions are met
**When** TradingSignal is created
**Then** signal has PENDING status and correct direction

## Requirements

### Functional Requirements
- **FR-001**: PaperTradingSession with id, strategy, symbols, virtual_capital, status
- **FR-002**: VirtualPortfolio with cash, positions, computed total_value
- **FR-003**: VirtualPosition with unrealized_pnl computed properties
- **FR-004**: TradingSignal with execution status tracking

### Non-Functional Requirements
- **NFR-001**: Use Decimal for all monetary values
- **NFR-002**: Immutable entities where appropriate
- **NFR-003**: Type hints on all fields and methods

### Technical Constraints
- **TC-001**: Python 3.10+ dataclasses
- **TC-002**: Use decimal.Decimal for financial values
- **TC-003**: Use UUID for entity identifiers

## Key Entities

### Entity: PaperTradingSession
- **Description**: Paper trading session with lifecycle management
- **Key Attributes**: id, strategy, data_source, symbols, virtual_capital, status
- **Relationships**: Contains VirtualPortfolio, generates TradingSignals

### Entity: VirtualPortfolio
- **Description**: Virtual portfolio tracking cash and positions
- **Key Attributes**: session_id, cash, positions, total_pnl, day_pnl
- **Relationships**: Contains VirtualPositions, belongs to Session

### Entity: VirtualPosition
- **Description**: Virtual stock position with P&L calculations
- **Key Attributes**: symbol, quantity, avg_price, current_price, entry_time
- **Relationships**: Belongs to VirtualPortfolio

### Entity: TradingSignal
- **Description**: Trading signal event for user action
- **Key Attributes**: id, session_id, symbol, signal_type, direction, price, quantity, status
- **Relationships**: Belongs to Session

## Dependencies

### Upstream Dependencies
- [ ] E09: Strategy entity for session configuration
- [ ] E03: BrokerConfig for data source

### Downstream Impact
- [ ] E12-F02: Engine uses these entities
- [ ] E12-F04: UI components display these entities
- [ ] E12-F05: Persistence stores these entities

## Gate Checks

### Pre-Implementation Gates
- [x] No [NEEDS CLARIFICATION] markers remain
- [x] Entity fields defined in PRD 5.7.1
- [x] All requirements testable

### Quality Gates
- [ ] Unit tests for all entities
- [ ] Test coverage > 80%
- [ ] Property tests for P&L calculations

## Tasks Preview

| ID | Title | Effort | Wave | Dependencies |
|----|-------|--------|------|--------------|
| [E12-F01-T01](T01/E12-F01-T01.spec.md) | Define Session Entities | M | 1 | - |
| [E12-F01-T02](T02/E12-F01-T02.spec.md) | Define Portfolio Entities | M | 1 | - |
| [E12-F01-T03](T03/E12-F01-T03.spec.md) | Define Signal Entities | M | 1 | - |

**[P]** = T01, T02, T03 can be executed in parallel (Wave 1)

## Success Criteria

### Acceptance Criteria
- [ ] All domain entities implemented
- [ ] P&L calculations verified
- [ ] Enum values complete
- [ ] 80% test coverage

### Definition of Done
- [ ] Code reviewed and approved
- [ ] Unit tests passing
- [ ] Documentation updated

## Risk Assessment

| Risk | Probability | Impact | Mitigation |
|------|-------------|--------|------------|
| Decimal precision issues | Low | Medium | Use proper Decimal operations |
| Missing enum values | Low | Low | Review PRD requirements |

## Notes and Clarifications

### Decisions Made
- 2025-12-30: Use frozen dataclasses for value objects
- 2025-12-30: VirtualPosition mutable for price updates
- 2025-12-30: Signal status mutable for execution tracking

## Artifacts

### Input Documents
- [Parent Epic](../E12.spec.md)
- PRD Section 5.7.1

### Output Artifacts
- [ ] `E12-F01.pre-docs.md` - Pre-implementation documentation
- [ ] `E12-F01.post-docs.md` - Post-implementation learnings

## References

- PRD Section 5.7: Paper Trading
- E03: Broker Integration entities
- E09: Strategy Builder entities

---
*Template Version: 2.0.0 - Enhanced with Speckit features*
