# Spec: E12-F01-T02 - Define Portfolio Entities

---
# ============================================================================
# SPEC METADATA
# ============================================================================

# === IDENTIFICATION ===
id: E12-F01-T02
clickup_task_id: ''
title: Define Portfolio Entities (VirtualPortfolio, VirtualPosition)
type: task

# === HIERARCHY ===
parent: E12-F01
children: []
epic: E12
feature: F01
task: T02
domain: paper-trading

# === WORKFLOW ===
status: draft
priority: high

# === TRACKING ===
created: '2025-12-30'
updated: '2025-12-30'
due_date: ''
estimated_hours: 4
actual_hours: 0

# === METADATA ===
tags:
  - domain
  - entities
  - portfolio
  - position
effort: medium
risk: low
---

**Status**: Draft
**Type**: Task
**Parent**: E12-F01
**Created**: 2025-12-30
**Updated**: 2025-12-30

## Executive Summary

Create `VirtualPortfolio` and `VirtualPosition` dataclasses for tracking virtual holdings in paper trading. VirtualPosition includes computed properties for market_value and unrealized P&L calculations. VirtualPortfolio aggregates positions and tracks total portfolio value.

## Execution Flow

```
1. Create VirtualPosition dataclass
   → symbol, symbol_name, quantity
   → avg_price, current_price, entry_time
   → Computed: market_value, unrealized_pnl, unrealized_pnl_pct
2. Create VirtualPortfolio dataclass
   → session_id, cash
   → positions: dict[str, VirtualPosition]
   → total_pnl, day_pnl
   → Computed: total_value
   → Return: SUCCESS with portfolio entities defined
```

## User Stories

### Primary User Story
**As a** developer
**I want to** track virtual positions with P&L
**So that** I can display accurate portfolio performance

## Acceptance Scenarios

### Scenario 1: Calculate Market Value
**Given** VirtualPosition with quantity=500, current_price=72500
**When** market_value is accessed
**Then** returns 36,250,000

### Scenario 2: Calculate Unrealized P&L
**Given** VirtualPosition with avg_price=71000, current_price=72500, quantity=500
**When** unrealized_pnl is accessed
**Then** returns 750,000

### Scenario 3: Calculate P&L Percentage
**Given** same position as Scenario 2
**When** unrealized_pnl_pct is accessed
**Then** returns 2.11%

### Scenario 4: Portfolio Total Value
**Given** portfolio with cash=50M and positions worth 50M
**When** total_value is accessed
**Then** returns 100M

## Requirements

### Functional Requirements
- **FR-001**: VirtualPosition with all required fields
- **FR-002**: VirtualPosition computed P&L properties
- **FR-003**: VirtualPortfolio with positions dict
- **FR-004**: VirtualPortfolio total_value computation

### Non-Functional Requirements
- **NFR-001**: Decimal for all monetary values
- **NFR-002**: Thread-safe for concurrent price updates
- **NFR-003**: Efficient P&L recalculation

### Technical Constraints
- **TC-001**: Python dataclasses
- **TC-002**: Decimal for financial values

## Dependencies

### Upstream Dependencies
- None (parallel with T01)

### Downstream Impact
- [ ] E12-F02: Runner manages portfolio
- [ ] E12-F04: UI displays portfolio

## Gate Checks

### Pre-Implementation Gates
- [x] P&L formulas defined
- [x] Field requirements clear

### Quality Gates
- [ ] Unit tests for all entities
- [ ] P&L edge case tests
- [ ] Test coverage > 80%

## Success Criteria

### Acceptance Criteria
- [ ] All entities implemented
- [ ] P&L calculations verified
- [ ] Edge cases handled (zero avg_price)
- [ ] Tests passing

### Definition of Done
- [ ] Code reviewed
- [ ] Unit tests passing
- [ ] Documentation complete

## Artifacts

### Input Documents
- [Parent Feature](../E12-F01.spec.md)

### Output Artifacts
- `src/domain/entities/virtual_portfolio.py`
- `src/domain/entities/virtual_position.py`

---
*Template Version: 2.0.0 - Enhanced with Speckit features*
