# Spec: E12-F02-T01 - Implement SessionManager

---
# ============================================================================
# SPEC METADATA
# ============================================================================

# === IDENTIFICATION ===
id: E12-F02-T01
clickup_task_id: ''
title: Implement PaperTradingSessionManager
type: task

# === HIERARCHY ===
parent: E12-F02
children: []
epic: E12
feature: F02
task: T01
domain: paper-trading

# === WORKFLOW ===
status: draft
priority: high

# === TRACKING ===
created: '2025-12-30'
updated: '2025-12-30'
due_date: ''
estimated_hours: 6
actual_hours: 0

# === METADATA ===
tags:
  - engine
  - session
  - manager
  - async
effort: large
risk: medium
---

**Status**: Draft
**Type**: Task
**Parent**: E12-F02
**Created**: 2025-12-30
**Updated**: 2025-12-30

## Executive Summary

Implement `PaperTradingSessionManager` class that manages the lifecycle of paper trading sessions. Provides methods to start, pause, resume, and stop sessions. Maintains registry of active session runners and handles persistence through repository.

## Execution Flow

```
1. Define class with dependencies
   → IBrokerGateway, ProcessingEngine, Repository
   → _active_sessions: dict[str, PaperTradingRunner]
2. Implement start_session
   → Create PaperTradingSession entity
   → Save to repository
   → Create and start runner
   → Return session
3. Implement pause_session
   → Call runner.pause()
   → Update session status
   → Save to repository
4. Implement resume_session
   → Call runner.resume()
   → Update session status
   → Save to repository
5. Implement stop_session
   → Call runner.stop()
   → Remove from active sessions
   → Update status and stopped_at
   → Save and return session
   → Return: SUCCESS with manager working
```

## User Stories

### Primary User Story
**As a** trader
**I want to** manage paper trading session lifecycle
**So that** I can start, pause, and stop my testing sessions

## Acceptance Scenarios

### Scenario 1: Start Session
**Given** valid session configuration
**When** start_session is called
**Then** session is created, persisted, and runner is started

### Scenario 2: Pause Active Session
**Given** running session
**When** pause_session is called
**Then** runner pauses and status becomes PAUSED

### Scenario 3: Resume Paused Session
**Given** paused session
**When** resume_session is called
**Then** runner resumes and status becomes RUNNING

### Scenario 4: Stop Session
**Given** active session
**When** stop_session is called
**Then** runner stops, removed from registry, status STOPPED

## Requirements

### Functional Requirements
- **FR-001**: start_session creates session and starts runner
- **FR-002**: pause_session pauses runner and updates status
- **FR-003**: resume_session resumes runner and updates status
- **FR-004**: stop_session stops runner and finalizes session

### Non-Functional Requirements
- **NFR-001**: Thread-safe session management
- **NFR-002**: Graceful error handling
- **NFR-003**: Async methods for non-blocking

### Technical Constraints
- **TC-001**: Dependency injection for testability
- **TC-002**: Async/await pattern

## Dependencies

### Upstream Dependencies
- [ ] E12-F01: Domain entities
- [ ] E03: IBrokerGateway
- [ ] E06: ProcessingEngine
- [ ] E12-F05-T01: IPaperTradingSessionRepository

### Downstream Impact
- [ ] E12-F02-T02: Runner is created by manager

## Gate Checks

### Pre-Implementation Gates
- [x] Dependencies available
- [x] Interface defined

### Quality Gates
- [ ] Unit tests with mocks
- [ ] Test coverage > 80%

## Success Criteria

### Acceptance Criteria
- [ ] All lifecycle methods work
- [ ] Persistence works correctly
- [ ] Error handling complete
- [ ] Tests passing

### Definition of Done
- [ ] Code reviewed
- [ ] Unit tests passing
- [ ] Documentation complete

## Artifacts

### Input Documents
- [Parent Feature](../E12-F02.spec.md)

### Output Artifacts
- `src/services/paper_trading/session_manager.py`

---
*Template Version: 2.0.0 - Enhanced with Speckit features*
