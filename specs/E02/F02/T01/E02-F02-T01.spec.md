# Spec: E02-F02-T01 - Define Repository Interfaces

---
# ============================================================================
# SPEC METADATA
# ============================================================================

# === IDENTIFICATION ===
id: E02-F02-T01
clickup_task_id: '86ew01yk4'
title: Define Repository Interfaces
type: task

# === HIERARCHY ===
parent: E02-F02
children: []
epic: E02
feature: F02
task: T01
domain: storage

# === WORKFLOW ===
status: draft
priority: high

# === TRACKING ===
created: '2025-12-28'
updated: '2025-12-28'
due_date: ''
estimated_hours: 4
actual_hours: 0

# === METADATA ===
tags: [repository, interfaces, abc, abstraction]
effort: medium
risk: low
---

**Status**: Draft
**Type**: Task
**Parent**: [E02-F02 - Repository Interfaces](../E02-F02.spec.md)
**Created**: 2025-12-28
**Updated**: 2025-12-28

## Executive Summary

Define the abstract repository interfaces for all domain entities. These interfaces establish the contract between the domain layer and infrastructure layer, enabling dependency inversion and testability.

## Execution Flow

```
1. Create ICandleRepository
   → Define all abstract methods with proper signatures
   → Document each method with docstring
   → Specify return types and parameter types

2. Create ISymbolRepository
   → Define CRUD and query methods
   → Support search and filtering

3. Create IFormulaRepository
   → Define CRUD methods
   → Support category and tag filtering
   → Support text search

4. Create IStrategyRepository
   → Define CRUD methods
   → Support formula reference queries
   → Return: SUCCESS with all interfaces defined
```

## User Stories

### Primary User Story
**As a** use case implementer
**I want to** depend on abstract interfaces
**So that** I can test without real databases

## Acceptance Scenarios

### Scenario 1: Interface is Abstract
**Given** ICandleRepository class
**When** attempting to instantiate directly
**Then** TypeError is raised

### Scenario 2: All Methods Abstract
**Given** ICandleRepository interface
**When** checking methods
**Then** all public methods are abstract

### Scenario 3: Type Hints Complete
**Given** any repository method
**When** inspecting signature
**Then** all parameters and return types are hinted

## Requirements

### Functional Requirements
- **FR-001**: All interfaces MUST inherit from ABC
- **FR-002**: All methods MUST be decorated with @abstractmethod
- **FR-003**: All methods MUST have complete type hints
- **FR-004**: All methods MUST have docstrings
- **FR-005**: ICandleRepository MUST have batch insert method
- **FR-006**: ISymbolRepository MUST have search by code and market

### Non-Functional Requirements
- **NFR-001**: Interfaces must be importable without side effects
- **NFR-002**: No implementation details in interfaces

### Technical Constraints
- **TC-001**: Use abc.ABC and abc.abstractmethod
- **TC-002**: Interfaces in src/domain/repositories/

## Key Entities

### ICandleRepository Methods
| Method | Parameters | Returns |
|--------|------------|---------|
| save_many | symbol_id, timeframe, candles | int |
| get_range | symbol_id, timeframe, start, end | list[Candle] |
| get_latest | symbol_id, timeframe, count | list[Candle] |
| get_coverage | symbol_id, timeframe | tuple[datetime, datetime] |
| count | symbol_id, timeframe | int |
| delete_range | symbol_id, timeframe, start, end | int |

### ISymbolRepository Methods
| Method | Parameters | Returns |
|--------|------------|---------|
| save | symbol | Symbol |
| get_by_id | symbol_id | Optional[Symbol] |
| get_by_code | code | Optional[Symbol] |
| get_by_market | market | list[Symbol] |
| get_all_active | - | list[Symbol] |
| search | query, limit | list[Symbol] |
| delete | symbol_id | bool |

## Dependencies

### Upstream Dependencies
- [ ] E02-F01: Domain entities for type hints

### Downstream Impact
- [ ] E02-F02-T02: In-memory implementations
- [ ] E02-F03: Database implementations

## Gate Checks

### Pre-Implementation Gates
- [x] All method signatures defined
- [x] Return types specified

### Quality Gates
- [ ] All methods are abstract
- [ ] Type hints complete
- [ ] Docstrings present

## Success Criteria

### Acceptance Criteria
- [ ] Cannot instantiate interface classes
- [ ] All methods documented
- [ ] Type hints pass mypy check
- [ ] Consistent naming conventions

### Definition of Done
- [ ] Code reviewed
- [ ] Documentation complete
- [ ] Interface tests written

## Artifacts

### Output Artifacts
- [ ] `src/domain/repositories/__init__.py`
- [ ] `src/domain/repositories/candle_repository.py`
- [ ] `src/domain/repositories/symbol_repository.py`
- [ ] `src/domain/repositories/formula_repository.py`
- [ ] `src/domain/repositories/strategy_repository.py`

---
*Template Version: 2.0.0 - Enhanced with Speckit features*
