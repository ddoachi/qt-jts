# Spec: E02-F01-T02 - Create Value Objects and Enums

---
# ============================================================================
# SPEC METADATA
# ============================================================================

# === IDENTIFICATION ===
id: E02-F01-T02
clickup_task_id: '86ew01yjv'
title: Create Value Objects and Enums
type: task

# === HIERARCHY ===
parent: E02-F01
children: []
epic: E02
feature: F01
task: T02
domain: storage

# === WORKFLOW ===
status: draft
priority: medium

# === TRACKING ===
created: '2025-12-28'
updated: '2025-12-28'
due_date: ''
estimated_hours: 2
actual_hours: 0

# === METADATA ===
tags: [domain, enums, value-objects, timeframe, market]
effort: small
risk: low
---

**Status**: Draft
**Type**: Task
**Parent**: [E02-F01 - Domain Entities](../E02-F01.spec.md)
**Created**: 2025-12-28
**Updated**: 2025-12-28

## Executive Summary

Create supporting value objects and enumeration types for the domain layer. This includes Market (exchange types), Timeframe (candle intervals), FormulaCategory (formula types), FormulaParameter (parameter definitions), and other domain enums. These provide type-safe representations of domain concepts.

## Execution Flow

```
1. Create Market enum
   → Define KOSPI, KOSDAQ, ETF, KONEX values
   → Add from_string() class method
   → If unknown value: ERROR "Unknown market: {value}"

2. Create Timeframe enum
   → Define all intervals (1m to 1M)
   → Add minutes property
   → Add is_intraday property

3. Create FormulaCategory enum
   → Define SCAN, ENTRY, EXIT, STOP_LOSS, TAKE_PROFIT, FILTER

4. Create FormulaParameter value object
   → Frozen dataclass with validation
   → Add validate() method for runtime checks
   → If invalid data_type: ERROR "Invalid data type"

5. Create supporting enums
   → OrderSide (BUY, SELL)
   → TradeStatus (OPEN, CLOSED, CANCELLED)
   → Return: SUCCESS with all enums and value objects
```

## User Stories

### Primary User Story
**As a** developer using domain entities
**I want to** type-safe enums and value objects
**So that** invalid values are caught at compile/runtime

### Additional Stories
- **As a** data engineer, **I want to** Timeframe with minutes property, **So that** I can calculate time intervals

## Acceptance Scenarios

### Scenario 1: Market from String
**Given** string "kospi" (lowercase)
**When** calling Market.from_string("kospi")
**Then** returns Market.KOSPI

### Scenario 2: Invalid Market
**Given** string "INVALID"
**When** calling Market.from_string("INVALID")
**Then** ValueError is raised with "Unknown market: INVALID"

### Scenario 3: Timeframe Properties
**Given** Timeframe.HOUR_1
**When** accessing minutes and is_intraday
**Then** minutes returns 60 and is_intraday returns True

### Scenario 4: FormulaParameter Validation
**Given** parameter with min_value=1, max_value=100
**When** calling validate(150)
**Then** returns False

## Requirements

### Functional Requirements
- **FR-001**: Market enum MUST support KOSPI, KOSDAQ, ETF, KONEX
- **FR-002**: Market.from_string() MUST be case-insensitive
- **FR-003**: Timeframe MUST support intervals from 1m to 1M
- **FR-004**: Timeframe MUST have minutes property
- **FR-005**: Timeframe MUST have is_intraday property
- **FR-006**: FormulaParameter MUST be immutable
- **FR-007**: FormulaParameter.validate() MUST check type and range

### Non-Functional Requirements
- **NFR-001**: All enums serializable to string
- **NFR-002**: Enum values consistent with database schemas

### Technical Constraints
- **TC-001**: Use (str, Enum) pattern for serialization
- **TC-002**: Use frozen dataclass for value objects

## Key Entities

### Enum: Market
```python
class Market(str, Enum):
    KOSPI = "KOSPI"
    KOSDAQ = "KOSDAQ"
    ETF = "ETF"
    KONEX = "KONEX"
```

### Enum: Timeframe
```python
class Timeframe(str, Enum):
    MINUTE_1 = "1m"
    MINUTE_5 = "5m"
    HOUR_1 = "1h"
    DAY_1 = "1d"
    WEEK_1 = "1w"
    MONTH_1 = "1M"
    # Properties: minutes, is_intraday
```

### Value Object: FormulaParameter
```python
@dataclass(frozen=True)
class FormulaParameter:
    name: str
    data_type: str  # "int", "float", "str", "bool"
    default_value: Any
    min_value: Optional[float] = None
    max_value: Optional[float] = None
    description: Optional[str] = None
```

## Dependencies

### Upstream Dependencies
- [ ] E02-F01-T01: Uses enums in entities

### Downstream Impact
- [ ] All domain entities use these enums
- [ ] Repository interfaces use Timeframe

## Gate Checks

### Pre-Implementation Gates
- [x] All enum values defined
- [x] Properties specified

### Quality Gates
- [ ] All enums serializable
- [ ] Test coverage > 95%

## Tasks Preview

### Implementation Tasks
- [ ] T001 [P] Create Market enum
- [ ] T002 [P] Create Timeframe enum
- [ ] T003 [P] Create FormulaCategory enum
- [ ] T004 Create FormulaParameter value object
- [ ] T005 Create OrderSide and TradeStatus enums
- [ ] T006 Create unit tests

**[P]** = Can be executed in parallel

## Success Criteria

### Acceptance Criteria
- [ ] All enums are string-serializable
- [ ] Timeframe.minutes returns correct values
- [ ] FormulaParameter validates correctly
- [ ] 95% test coverage

### Definition of Done
- [ ] Code reviewed
- [ ] Unit tests passing
- [ ] Type hints complete

## Risk Assessment

| Risk | Probability | Impact | Mitigation |
|------|------------|--------|------------|
| Enum value mismatch with DB | Low | High | Document enum-to-DB mapping |

## Artifacts

### Output Artifacts
- [ ] `src/domain/enums/market.py`
- [ ] `src/domain/enums/timeframe.py`
- [ ] `src/domain/enums/formula_category.py`
- [ ] `src/domain/value_objects/formula_parameter.py`
- [ ] `tests/unit/domain/enums/test_*.py`

---
*Template Version: 2.0.0 - Enhanced with Speckit features*
