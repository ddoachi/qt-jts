# Spec: E01-F01-T01 - Create MainWindow skeleton with QStackedWidget

---
# ============================================================================
# SPEC METADATA
# ============================================================================

# === IDENTIFICATION ===
id: E01-F01-T01
clickup_task_id: '86ew0209e'
title: Create MainWindow skeleton with QStackedWidget
type: task

# === HIERARCHY ===
parent: E01-F01
children: []
epic: E01
feature: F01
task: T01
domain: application-framework

# === WORKFLOW ===
status: draft
priority: high

# === TRACKING ===
created: '2025-12-28'
updated: '2025-12-28'
due_date: ''
estimated_hours: 2
actual_hours: 0

# === METADATA ===
tags: [ui, pyside6, main-window, qstackedwidget, parallel]
effort: small
risk: low
parallel: true
---

**Status**: Draft
**Type**: Task
**Parent**: E01-F01 (Main Window & Navigation)
**Created**: 2025-12-28
**Updated**: 2025-12-28
**Parallel**: [P] Can be executed in parallel with T02, T04, T06

## Executive Summary

Create the foundational `MainWindow` class structure using PySide6 QMainWindow as the base. Implement QStackedWidget for managing multiple views and establish the basic window layout structure (content area, navigation area, status bar area). This task provides the skeleton that other tasks will build upon.

## Execution Flow

```
1. Create MainWindow class inheriting from QMainWindow
   → Import PySide6.QtWidgets.QMainWindow
   → Define __init__ with dependency injection parameters
   → Accept SettingsService and Logger via constructor

2. Initialize QStackedWidget for view management
   → Create QStackedWidget instance as self._stack
   → Set central widget to QStackedWidget
   → Initialize empty view registry dict: self._views = {}

3. Setup basic window layout structure
   → Create QVBoxLayout for left sidebar area (reserved for NavigationBar)
   → Create QHBoxLayout combining sidebar and central widget
   → Set minimum window size to prevent unusable state (800x600)

4. Set default window properties
   → Set window title: "JTS Trading Platform"
   → Set default window size: 1280x800
   → Center window on screen using QDesktopWidget

5. Implement view registry infrastructure
   → Create register_view(view_id: str, widget: QWidget) method
   → Add validation for duplicate view_id
   → Store view mapping in self._views dict
   → Add widget to QStackedWidget
   → Log successful registration

6. Implement basic navigation method
   → Create navigate_to(view_id: str) method
   → Validate view_id exists in registry
   → Switch QStackedWidget to target widget
   → If view not found: Log error and return False
   → Return: SUCCESS (True) or FAILURE (False)
```

## User Stories

### Primary User Story
**As a** developer
**I want to** have a MainWindow skeleton with QStackedWidget
**So that** I can register and display different application views

## Acceptance Scenarios

### Scenario 1: Happy Path - MainWindow Initialization
**Given** the application is starting up
**When** MainWindow is instantiated with SettingsService and Logger
**Then** the window should be created with size 1280x800
**And** the window should be centered on screen
**And** QStackedWidget should be set as central widget
**And** the view registry should be empty

### Scenario 2: View Registration
**Given** MainWindow is initialized
**When** register_view("test_view", widget) is called
**Then** the view should be added to self._views dict
**And** the widget should be added to QStackedWidget
**And** a success log message should be generated

### Scenario 3: View Navigation
**Given** MainWindow has "view1" and "view2" registered
**When** navigate_to("view2") is called
**Then** QStackedWidget should switch to "view2" widget
**And** the method should return True

### Scenario 4: Error Case - Invalid View Navigation
**Given** MainWindow is initialized with no views registered
**When** navigate_to("nonexistent") is called
**Then** an error should be logged
**And** the method should return False
**And** no exception should be raised

## Requirements

### Functional Requirements
- **FR-001**: MainWindow MUST inherit from QMainWindow
- **FR-002**: MainWindow MUST use QStackedWidget for view management
- **FR-003**: MainWindow MUST provide register_view() method for view registration
- **FR-004**: MainWindow MUST provide navigate_to() method for view switching
- **FR-005**: MainWindow MUST validate view_id on registration and navigation
- **FR-006**: MainWindow MUST log registration and navigation events

### Non-Functional Requirements
- **NFR-001**: MainWindow initialization MUST complete in < 100ms
- **NFR-002**: All public methods MUST have type hints and docstrings
- **NFR-003**: Code MUST follow PEP 8 style guidelines

### Technical Constraints
- **TC-001**: Must use PySide6.QtWidgets.QMainWindow
- **TC-002**: Must use PySide6.QtWidgets.QStackedWidget
- **TC-003**: Must accept SettingsService and Logger via dependency injection
- **TC-004**: Must be compatible with Python 3.11+

## Key Entities

### Entity: MainWindow
- **Description**: Core application window class
- **Key Attributes**:
  - `_stack: QStackedWidget` - Widget for view management
  - `_views: dict[str, QWidget]` - View registry mapping view_id to widget
  - `_settings: SettingsService` - Settings service instance
  - `_logger: Logger` - Logger instance
- **Key Methods**:
  - `__init__(settings: SettingsService, logger: Logger)` - Constructor
  - `register_view(view_id: str, widget: QWidget) -> None` - Register a view
  - `navigate_to(view_id: str) -> bool` - Navigate to a view

## Dependencies

### Upstream Dependencies
- [ ] E01-F03: DI Container (for dependency injection)
- [ ] E01-F02: SettingsService (injected dependency)
- [ ] E01-F04: Logger (injected dependency)

### Downstream Impact
- [ ] T03: Depends on MainWindow skeleton and view registry
- [ ] T05: Depends on MainWindow structure for geometry persistence

## Implementation Details

### File Structure
```
src/presentation/main_window.py
tests/unit/presentation/test_main_window.py
```

### Code Skeleton
```python
from PySide6.QtWidgets import QMainWindow, QStackedWidget, QWidget
from PySide6.QtCore import QSize
from typing import Dict

class MainWindow(QMainWindow):
    """Main application window with view management."""

    def __init__(self, settings: SettingsService, logger: Logger):
        """Initialize main window.

        Args:
            settings: Settings service for configuration
            logger: Logger for event logging
        """
        super().__init__()
        self._settings = settings
        self._logger = logger
        self._stack = QStackedWidget()
        self._views: Dict[str, QWidget] = {}

        self._setup_ui()

    def _setup_ui(self) -> None:
        """Setup the user interface."""
        # Set window properties
        self.setWindowTitle("JTS Trading Platform")
        self.resize(QSize(1280, 800))
        self.setMinimumSize(QSize(800, 600))

        # Set central widget
        self.setCentralWidget(self._stack)

        # Center window on screen
        self._center_on_screen()

        self._logger.info("MainWindow initialized")

    def _center_on_screen(self) -> None:
        """Center the window on the screen."""
        # Implementation here
        pass

    def register_view(self, view_id: str, widget: QWidget) -> None:
        """Register a view widget.

        Args:
            view_id: Unique identifier for the view
            widget: Widget to register

        Raises:
            ValueError: If view_id already exists
        """
        if view_id in self._views:
            raise ValueError(f"View {view_id} already registered")

        self._views[view_id] = widget
        self._stack.addWidget(widget)
        self._logger.info(f"Registered view: {view_id}")

    def navigate_to(self, view_id: str) -> bool:
        """Navigate to a registered view.

        Args:
            view_id: ID of view to navigate to

        Returns:
            True if navigation successful, False otherwise
        """
        if view_id not in self._views:
            self._logger.error(f"View {view_id} not found")
            return False

        widget = self._views[view_id]
        self._stack.setCurrentWidget(widget)
        self._logger.debug(f"Navigated to view: {view_id}")
        return True
```

## Success Criteria

### Acceptance Criteria
- [ ] MainWindow class created with QMainWindow inheritance
- [ ] QStackedWidget created and set as central widget
- [ ] Window has default size 1280x800 and minimum size 800x600
- [ ] Window is centered on screen on first launch
- [ ] register_view() method validates and stores views
- [ ] navigate_to() method switches between registered views
- [ ] All methods have proper type hints and docstrings
- [ ] Error cases are handled gracefully without exceptions

### Definition of Done
- [ ] Code reviewed and approved
- [ ] Unit tests passing with 80%+ coverage
  - [ ] Test MainWindow initialization
  - [ ] Test view registration (happy path)
  - [ ] Test view registration (duplicate view_id)
  - [ ] Test view navigation (happy path)
  - [ ] Test view navigation (invalid view_id)
- [ ] Code follows PEP 8 style guidelines
- [ ] Docstrings complete for all public methods
- [ ] Integration with dependency injection verified

## Risk Assessment

| Risk | Probability | Impact | Mitigation |
|------|------------|--------|------------|
| QStackedWidget initialization failure | Very Low | Medium | Add error handling, fallback to basic layout |
| Center window calculation incorrect | Low | Low | Test on multiple screen sizes, use Qt built-in methods |
| View registry state inconsistency | Low | Medium | Use immutable keys, validate on all operations |

## Notes and Clarifications

### Design Decisions
- 2025-12-28: Use dict for view registry instead of list for O(1) lookup by view_id
- 2025-12-28: Return bool from navigate_to() to indicate success/failure for caller handling
- 2025-12-28: Raise ValueError on duplicate registration to catch errors early in development

### Implementation Notes
- Layout structure reserves space for NavigationBar (left sidebar) to be added by T02
- Status bar area reserved for T04 implementation
- Window geometry persistence will be added in T05

---
*Template Version: 2.0.0 - Task Level Spec*
